import{i as ep,j as tp,l as rp,H as ip,d as co,m as np,n as Ka,o as Ha,t as sp,f as Wa,p as op,e as zl,q as ap,v as cp,w as up,x as lp,y as hp,r as fp,h as dp,z as pp,g as gp,A as yp,B as jr}from"./8NJXV5Ny.js";import{ai as tn}from"./CIKIahH0.js";var rn={exports:{}},Ga;function wp(){if(Ga)return rn.exports;Ga=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(m,_,A){return Function.prototype.apply.call(m,_,A)},r;t&&typeof t.ownKeys=="function"?r=t.ownKeys:Object.getOwnPropertySymbols?r=function(m){return Object.getOwnPropertyNames(m).concat(Object.getOwnPropertySymbols(m))}:r=function(m){return Object.getOwnPropertyNames(m)};function i(b){console&&console.warn&&console.warn(b)}var n=Number.isNaN||function(m){return m!==m};function s(){s.init.call(this)}rn.exports=s,rn.exports.once=x,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(b){if(typeof b!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof b)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(b){if(typeof b!="number"||b<0||n(b))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+b+".");o=b}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(m){if(typeof m!="number"||m<0||n(m))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+m+".");return this._maxListeners=m,this};function c(b){return b._maxListeners===void 0?s.defaultMaxListeners:b._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(m){for(var _=[],A=1;A<arguments.length;A++)_.push(arguments[A]);var B=m==="error",$=this._events;if($!==void 0)B=B&&$.error===void 0;else if(!B)return!1;if(B){var N;if(_.length>0&&(N=_[0]),N instanceof Error)throw N;var U=new Error("Unhandled error."+(N?" ("+N.message+")":""));throw U.context=N,U}var C=$[m];if(C===void 0)return!1;if(typeof C=="function")e(C,this,_);else for(var D=C.length,T=d(C,D),A=0;A<D;++A)e(T[A],this,_);return!0};function u(b,m,_,A){var B,$,N;if(a(_),$=b._events,$===void 0?($=b._events=Object.create(null),b._eventsCount=0):($.newListener!==void 0&&(b.emit("newListener",m,_.listener?_.listener:_),$=b._events),N=$[m]),N===void 0)N=$[m]=_,++b._eventsCount;else if(typeof N=="function"?N=$[m]=A?[_,N]:[N,_]:A?N.unshift(_):N.push(_),B=c(b),B>0&&N.length>B&&!N.warned){N.warned=!0;var U=new Error("Possible EventEmitter memory leak detected. "+N.length+" "+String(m)+" listeners added. Use emitter.setMaxListeners() to increase limit");U.name="MaxListenersExceededWarning",U.emitter=b,U.type=m,U.count=N.length,i(U)}return b}s.prototype.addListener=function(m,_){return u(this,m,_,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(m,_){return u(this,m,_,!0)};function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(b,m,_){var A={fired:!1,wrapFn:void 0,target:b,type:m,listener:_},B=l.bind(A);return B.listener=_,A.wrapFn=B,B}s.prototype.once=function(m,_){return a(_),this.on(m,h(this,m,_)),this},s.prototype.prependOnceListener=function(m,_){return a(_),this.prependListener(m,h(this,m,_)),this},s.prototype.removeListener=function(m,_){var A,B,$,N,U;if(a(_),B=this._events,B===void 0)return this;if(A=B[m],A===void 0)return this;if(A===_||A.listener===_)--this._eventsCount===0?this._events=Object.create(null):(delete B[m],B.removeListener&&this.emit("removeListener",m,A.listener||_));else if(typeof A!="function"){for($=-1,N=A.length-1;N>=0;N--)if(A[N]===_||A[N].listener===_){U=A[N].listener,$=N;break}if($<0)return this;$===0?A.shift():g(A,$),A.length===1&&(B[m]=A[0]),B.removeListener!==void 0&&this.emit("removeListener",m,U||_)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(m){var _,A,B;if(A=this._events,A===void 0)return this;if(A.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):A[m]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete A[m]),this;if(arguments.length===0){var $=Object.keys(A),N;for(B=0;B<$.length;++B)N=$[B],N!=="removeListener"&&this.removeAllListeners(N);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(_=A[m],typeof _=="function")this.removeListener(m,_);else if(_!==void 0)for(B=_.length-1;B>=0;B--)this.removeListener(m,_[B]);return this};function f(b,m,_){var A=b._events;if(A===void 0)return[];var B=A[m];return B===void 0?[]:typeof B=="function"?_?[B.listener||B]:[B]:_?y(B):d(B,B.length)}s.prototype.listeners=function(m){return f(this,m,!0)},s.prototype.rawListeners=function(m){return f(this,m,!1)},s.listenerCount=function(b,m){return typeof b.listenerCount=="function"?b.listenerCount(m):p.call(b,m)},s.prototype.listenerCount=p;function p(b){var m=this._events;if(m!==void 0){var _=m[b];if(typeof _=="function")return 1;if(_!==void 0)return _.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]};function d(b,m){for(var _=new Array(m),A=0;A<m;++A)_[A]=b[A];return _}function g(b,m){for(;m+1<b.length;m++)b[m]=b[m+1];b.pop()}function y(b){for(var m=new Array(b.length),_=0;_<m.length;++_)m[_]=b[_].listener||b[_];return m}function x(b,m){return new Promise(function(_,A){function B(N){b.removeListener(m,$),A(N)}function $(){typeof b.removeListener=="function"&&b.removeListener("error",B),_([].slice.call(arguments))}w(b,m,$,{once:!0}),m!=="error"&&I(b,B,{once:!0})})}function I(b,m,_){typeof b.on=="function"&&w(b,"error",m,_)}function w(b,m,_,A){if(typeof b.on=="function")A.once?b.once(m,_):b.on(m,_);else if(typeof b.addEventListener=="function")b.addEventListener(m,function B($){A.once&&b.removeEventListener(m,B),_($)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof b)}return rn.exports}var Et=wp();const Vl=ep(Et);var ls={};var uo=function(t,e){return uo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},uo(t,e)};function bp(t,e){uo(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var lo=function(){return lo=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},lo.apply(this,arguments)};function mp(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function vp(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,r,s):o(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function Ep(t,e){return function(r,i){e(r,i,t)}}function xp(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function _p(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(i.next(l))}catch(h){o(h)}}function c(l){try{u(i.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):n(l.value).then(a,c)}u((i=i.apply(t,e||[])).next())})}function Ip(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=u[0]&2?n.return:u[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,u[1])).done)return s;switch(n=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,n=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(l){u=[6,l],n=0}finally{i=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Sp(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function Dp(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function ho(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Kl(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function Op(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Kl(arguments[e]));return t}function Ap(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,n++)i[n]=s[o];return i}function Ti(t){return this instanceof Ti?(this.v=t,this):new Ti(t)}function $p(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(f){i[f]&&(n[f]=function(p){return new Promise(function(d,g){s.push([f,p,d,g])>1||a(f,p)})})}function a(f,p){try{c(i[f](p))}catch(d){h(s[0][3],d)}}function c(f){f.value instanceof Ti?Promise.resolve(f.value.v).then(u,l):h(s[0][2],f)}function u(f){a("next",f)}function l(f){a("throw",f)}function h(f,p){f(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Bp(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(o){return(r=!r)?{value:Ti(t[n](o)),done:n==="return"}:s?s(o):o}:s}}function Pp(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof ho=="function"?ho(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),n(a,c,o.done,o.value)})}}function n(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function Tp(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Rp(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Cp(t){return t&&t.__esModule?t:{default:t}}function Np(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Up(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const kp=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return lo},__asyncDelegator:Bp,__asyncGenerator:$p,__asyncValues:Pp,__await:Ti,__awaiter:_p,__classPrivateFieldGet:Np,__classPrivateFieldSet:Up,__createBinding:Sp,__decorate:vp,__exportStar:Dp,__extends:bp,__generator:Ip,__importDefault:Cp,__importStar:Rp,__makeTemplateObject:Tp,__metadata:xp,__param:Ep,__read:Kl,__rest:mp,__spread:Op,__spreadArrays:Ap,__values:ho},Symbol.toStringTag,{value:"Module"})),Mi=tp(kp);var hs={},ui={},Ya;function Lp(){if(Ya)return ui;Ya=1,Object.defineProperty(ui,"__esModule",{value:!0}),ui.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return ui.delay=t,ui}var vr={},fs={},Er={},Za;function Fp(){return Za||(Za=1,Object.defineProperty(Er,"__esModule",{value:!0}),Er.ONE_THOUSAND=Er.ONE_HUNDRED=void 0,Er.ONE_HUNDRED=100,Er.ONE_THOUSAND=1e3),Er}var ds={},Xa;function Mp(){return Xa||(Xa=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365})(ds)),ds}var Ja;function Hl(){return Ja||(Ja=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Mi;e.__exportStar(Fp(),t),e.__exportStar(Mp(),t)})(fs)),fs}var Qa;function qp(){if(Qa)return vr;Qa=1,Object.defineProperty(vr,"__esModule",{value:!0}),vr.fromMiliseconds=vr.toMiliseconds=void 0;const t=Hl();function e(i){return i*t.ONE_THOUSAND}vr.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return vr.fromMiliseconds=r,vr}var ec;function jp(){return ec||(ec=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Mi;e.__exportStar(Lp(),t),e.__exportStar(qp(),t)})(hs)),hs}var zr={},tc;function zp(){if(tc)return zr;tc=1,Object.defineProperty(zr,"__esModule",{value:!0}),zr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const n=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:n})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return zr.Watch=t,zr.default=t,zr}var ps={},li={},rc;function Vp(){if(rc)return li;rc=1,Object.defineProperty(li,"__esModule",{value:!0}),li.IWatch=void 0;class t{}return li.IWatch=t,li}var ic;function Kp(){return ic||(ic=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),Mi.__exportStar(Vp(),t)})(ps)),ps}var nc;function Hp(){return nc||(nc=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Mi;e.__exportStar(jp(),t),e.__exportStar(zp(),t),e.__exportStar(Kp(),t),e.__exportStar(Hl(),t)})(ls)),ls}var M=Hp();class kr{}let Wp=class extends kr{constructor(e){super()}};const sc=M.FIVE_SECONDS,Lr={pulse:"heartbeat_pulse"};let Gp=class Wl extends Wp{constructor(e){super(e),this.events=new Et.EventEmitter,this.interval=sc,this.interval=e?.interval||sc}static async init(e){const r=new Wl(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),M.toMiliseconds(this.interval))}pulse(){this.events.emit(Lr.pulse)}};function Yp(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function xe(t,...e){try{return Yp(t(...e))}catch(r){return Promise.reject(r)}}function Zp(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function Xp(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function mn(t){if(Zp(t))return String(t);if(Xp(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return mn(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const fo="base64:";function Jp(t){return typeof t=="string"?t:fo+tg(t)}function Qp(t){return typeof t!="string"||!t.startsWith(fo)?t:eg(t.slice(fo.length))}function eg(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function tg(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Ve(t){return t&&t.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function rg(...t){return Ve(t.join(":"))}function nn(t){return t=Ve(t),t?t+":":""}function ig(t,e){if(e===void 0)return!0;let r=0,i=t.indexOf(":");for(;i>-1;)r++,i=t.indexOf(":",i+1);return r<=e}function ng(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const sg="memory",og=()=>{const t=new Map;return{name:sg,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function ag(t={}){const e={mounts:{"":t.driver||og()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=u=>{for(const l of e.mountpoints)if(u.startsWith(l))return{base:l,relativeKey:u.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:u,driver:e.mounts[""]}},i=(u,l)=>e.mountpoints.filter(h=>h.startsWith(u)||l&&u.startsWith(h)).map(h=>({relativeBase:u.length>h.length?u.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),n=(u,l)=>{if(e.watching){l=Ve(l);for(const h of e.watchListeners)h(u,l)}},s=async()=>{if(!e.watching){e.watching=!0;for(const u in e.mounts)e.unwatch[u]=await oc(e.mounts[u],n,u)}},o=async()=>{if(e.watching){for(const u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,l,h)=>{const f=new Map,p=d=>{let g=f.get(d.base);return g||(g={driver:d.driver,base:d.base,items:[]},f.set(d.base,g)),g};for(const d of u){const g=typeof d=="string",y=Ve(g?d:d.key),x=g?void 0:d.value,I=g||!d.options?l:{...l,...d.options},w=r(y);p(w).items.push({key:y,value:x,relativeKey:w.relativeKey,options:I})}return Promise.all([...f.values()].map(d=>h(d))).then(d=>d.flat())},c={hasItem(u,l={}){u=Ve(u);const{relativeKey:h,driver:f}=r(u);return xe(f.hasItem,h,l)},getItem(u,l={}){u=Ve(u);const{relativeKey:h,driver:f}=r(u);return xe(f.getItem,h,l).then(p=>tn(p))},getItems(u,l={}){return a(u,l,h=>h.driver.getItems?xe(h.driver.getItems,h.items.map(f=>({key:f.relativeKey,options:f.options})),l).then(f=>f.map(p=>({key:rg(h.base,p.key),value:tn(p.value)}))):Promise.all(h.items.map(f=>xe(h.driver.getItem,f.relativeKey,f.options).then(p=>({key:f.key,value:tn(p)})))))},getItemRaw(u,l={}){u=Ve(u);const{relativeKey:h,driver:f}=r(u);return f.getItemRaw?xe(f.getItemRaw,h,l):xe(f.getItem,h,l).then(p=>Qp(p))},async setItem(u,l,h={}){if(l===void 0)return c.removeItem(u);u=Ve(u);const{relativeKey:f,driver:p}=r(u);p.setItem&&(await xe(p.setItem,f,mn(l),h),p.watch||n("update",u))},async setItems(u,l){await a(u,l,async h=>{if(h.driver.setItems)return xe(h.driver.setItems,h.items.map(f=>({key:f.relativeKey,value:mn(f.value),options:f.options})),l);h.driver.setItem&&await Promise.all(h.items.map(f=>xe(h.driver.setItem,f.relativeKey,mn(f.value),f.options)))})},async setItemRaw(u,l,h={}){if(l===void 0)return c.removeItem(u,h);u=Ve(u);const{relativeKey:f,driver:p}=r(u);if(p.setItemRaw)await xe(p.setItemRaw,f,l,h);else if(p.setItem)await xe(p.setItem,f,Jp(l),h);else return;p.watch||n("update",u)},async removeItem(u,l={}){typeof l=="boolean"&&(l={removeMeta:l}),u=Ve(u);const{relativeKey:h,driver:f}=r(u);f.removeItem&&(await xe(f.removeItem,h,l),(l.removeMeta||l.removeMata)&&await xe(f.removeItem,h+"$",l),f.watch||n("remove",u))},async getMeta(u,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),u=Ve(u);const{relativeKey:h,driver:f}=r(u),p=Object.create(null);if(f.getMeta&&Object.assign(p,await xe(f.getMeta,h,l)),!l.nativeOnly){const d=await xe(f.getItem,h+"$",l).then(g=>tn(g));d&&typeof d=="object"&&(typeof d.atime=="string"&&(d.atime=new Date(d.atime)),typeof d.mtime=="string"&&(d.mtime=new Date(d.mtime)),Object.assign(p,d))}return p},setMeta(u,l,h={}){return this.setItem(u+"$",l,h)},removeMeta(u,l={}){return this.removeItem(u+"$",l)},async getKeys(u,l={}){u=nn(u);const h=i(u,!0);let f=[];const p=[];let d=!0;for(const y of h){y.driver.flags?.maxDepth||(d=!1);const x=await xe(y.driver.getKeys,y.relativeBase,l);for(const I of x){const w=y.mountpoint+Ve(I);f.some(b=>w.startsWith(b))||p.push(w)}f=[y.mountpoint,...f.filter(I=>!I.startsWith(y.mountpoint))]}const g=l.maxDepth!==void 0&&!d;return p.filter(y=>(!g||ig(y,l.maxDepth))&&ng(y,u))},async clear(u,l={}){u=nn(u),await Promise.all(i(u,!1).map(async h=>{if(h.driver.clear)return xe(h.driver.clear,h.relativeBase,l);if(h.driver.removeItem){const f=await h.driver.getKeys(h.relativeBase||"",l);return Promise.all(f.map(p=>h.driver.removeItem(p,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>ac(u)))},async watch(u){return await s(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,l){if(u=nn(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((h,f)=>f.length-h.length)),e.mounts[u]=l,e.watching&&Promise.resolve(oc(l,n,u)).then(h=>{e.unwatch[u]=h}).catch(console.error),c},async unmount(u,l=!0){u=nn(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&(e.unwatch[u]?.(),delete e.unwatch[u]),l&&await ac(e.mounts[u]),e.mountpoints=e.mountpoints.filter(h=>h!==u),delete e.mounts[u])},getMount(u=""){u=Ve(u)+":";const l=r(u);return{driver:l.driver,base:l.base}},getMounts(u="",l={}){return u=Ve(u),i(u,l.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(u,l={})=>c.getKeys(u,l),get:(u,l={})=>c.getItem(u,l),set:(u,l,h={})=>c.setItem(u,l,h),has:(u,l={})=>c.hasItem(u,l),del:(u,l={})=>c.removeItem(u,l),remove:(u,l={})=>c.removeItem(u,l)};return c}function oc(t,e,r){return t.watch?t.watch((i,n)=>e(i,r+n)):()=>{}}async function ac(t){typeof t.dispose=="function"&&await xe(t.dispose)}function Fr(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function Gl(t,e){let r;const i=()=>{if(r)return r;const n=indexedDB.open(t);return n.onupgradeneeded=()=>n.result.createObjectStore(e),r=Fr(n),r.then(s=>{s.onclose=()=>r=void 0},()=>{}),r};return(n,s)=>i().then(o=>s(o.transaction(e,n).objectStore(e)))}let gs;function qi(){return gs||(gs=Gl("keyval-store","keyval")),gs}function cc(t,e=qi()){return e("readonly",r=>Fr(r.get(t)))}function cg(t,e,r=qi()){return r("readwrite",i=>(i.put(e,t),Fr(i.transaction)))}function ug(t,e=qi()){return e("readwrite",r=>(r.delete(t),Fr(r.transaction)))}function lg(t=qi()){return t("readwrite",e=>(e.clear(),Fr(e.transaction)))}function hg(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Fr(t.transaction)}function fg(t=qi()){return t("readonly",e=>{if(e.getAllKeys)return Fr(e.getAllKeys());const r=[];return hg(e,i=>r.push(i.key)).then(()=>r)})}const dg=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),pg=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,n)=>typeof n=="string"&&n.match(/^\d+n$/)?BigInt(n.substring(0,n.length-1)):n)};function ri(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return pg(t)}catch{return t}}function ji(t){return typeof t=="string"?t:dg(t)||""}const gg="idb-keyval";var yg=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=n=>e+n;let i;return t.dbName&&t.storeName&&(i=Gl(t.dbName,t.storeName)),{name:gg,options:t,async hasItem(n){return!(typeof await cc(r(n),i)>"u")},async getItem(n){return await cc(r(n),i)??null},setItem(n,s){return cg(r(n),s,i)},removeItem(n){return ug(r(n),i)},getKeys(){return fg(i)},clear(){return lg(i)}}};const wg="WALLET_CONNECT_V2_INDEXED_DB",bg="keyvaluestorage";let mg=class{constructor(){this.indexedDb=ag({driver:yg({dbName:wg,storeName:bg})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,ji(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var ys=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},vn={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof ys<"u"&&ys.localStorage?vn.exports=ys.localStorage:typeof window<"u"&&window.localStorage?vn.exports=window.localStorage:vn.exports=new e})();function vg(t){var e;return[t[0],ri((e=t[1])!=null?e:"")]}let Eg=class{constructor(){this.localStorage=vn.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(vg)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return ri(r)}async setItem(e,r){this.localStorage.setItem(e,ji(r))}async removeItem(e){this.localStorage.removeItem(e)}};const xg="wc_storage_version",uc=1,_g=async(t,e,r)=>{const i=xg,n=await e.getItem(i);if(n&&n>=uc){r(e);return}const s=await t.getKeys();if(!s.length){r(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const u=await t.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(i,uc),r(e),Ig(t,o)},Ig=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};let Sg=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new Eg;this.storage=e;try{const r=new mg;_g(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};var Bt={exports:{}};function Dg(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var Og=Ag;function Ag(t,e,r){var i=r&&r.stringify||Dg,n=1;if(typeof t=="object"&&t!==null){var s=e.length+n;if(s===1)return t;var o=new Array(s);o[0]=i(t);for(var a=1;a<s;a++)o[a]=i(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var u="",l=1-n,h=-1,f=t&&t.length||0,p=0;p<f;){if(t.charCodeAt(p)===37&&p+1<f){switch(h=h>-1?h:0,t.charCodeAt(p+1)){case 100:case 102:if(l>=c||e[l]==null)break;h<p&&(u+=t.slice(h,p)),u+=Number(e[l]),h=p+2,p++;break;case 105:if(l>=c||e[l]==null)break;h<p&&(u+=t.slice(h,p)),u+=Math.floor(Number(e[l])),h=p+2,p++;break;case 79:case 111:case 106:if(l>=c||e[l]===void 0)break;h<p&&(u+=t.slice(h,p));var d=typeof e[l];if(d==="string"){u+="'"+e[l]+"'",h=p+2,p++;break}if(d==="function"){u+=e[l].name||"<anonymous>",h=p+2,p++;break}u+=i(e[l]),h=p+2,p++;break;case 115:if(l>=c)break;h<p&&(u+=t.slice(h,p)),u+=String(e[l]),h=p+2,p++;break;case 37:h<p&&(u+=t.slice(h,p)),u+="%",h=p+2,p++,l--;break}++l}++p}return h===-1?t:(h<f&&(u+=t.slice(h)),u)}const lc=Og;Bt.exports=Gt;const Ri=zg().console||{},$g={mapHttpRequest:sn,mapHttpResponse:sn,wrapRequestSerializer:ws,wrapResponseSerializer:ws,wrapErrorSerializer:ws,req:sn,res:sn,err:fc,errWithCause:fc};function dr(t,e){return t==="silent"?1/0:e.levels.values[t]}const ra=Symbol("pino.logFuncs"),po=Symbol("pino.hierarchy"),Bg={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function hc(t,e){const r={logger:e,parent:t[po]};e[po]=r}function Pg(t,e,r){const i={};e.forEach(n=>{i[n]=r[n]?r[n]:Ri[n]||Ri[Bg[n]||"log"]||Jr}),t[ra]=i}function Tg(t,e){return Array.isArray(t)?t.filter(function(r){return r!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function Gt(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||Ri;t.browser.write&&(t.browser.asObject=!0);const i=t.serializers||{},n=Tg(t.browser.serialize,i);let s=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=Object.keys(t.customLevels||{}),a=["error","fatal","warn","info","debug","trace"].concat(o);typeof r=="function"&&a.forEach(function(g){r[g]=r}),(t.enabled===!1||t.browser.disabled)&&(t.level="silent");const c=t.level||"info",u=Object.create(r);u.log||(u.log=Jr),Pg(u,a,r),hc({},u),Object.defineProperty(u,"levelVal",{get:h}),Object.defineProperty(u,"level",{get:f,set:p});const l={transmit:e,serialize:n,asObject:t.browser.asObject,asObjectBindingsOnly:t.browser.asObjectBindingsOnly,formatters:t.browser.formatters,levels:a,timestamp:Mg(t),messageKey:t.messageKey||"msg",onChild:t.onChild||Jr};u.levels=Rg(t),u.level=c,u.isLevelEnabled=function(g){return this.levels.values[g]?this.levels.values[g]>=this.levels.values[this.level]:!1},u.setMaxListeners=u.getMaxListeners=u.emit=u.addListener=u.on=u.prependListener=u.once=u.prependOnceListener=u.removeListener=u.removeAllListeners=u.listeners=u.listenerCount=u.eventNames=u.write=u.flush=Jr,u.serializers=i,u._serialize=n,u._stdErrSerialize=s,u.child=function(...g){return d.call(this,l,...g)},e&&(u._logEvent=go());function h(){return dr(this.level,this)}function f(){return this._level}function p(g){if(g!=="silent"&&!this.levels.values[g])throw Error("unknown level "+g);this._level=g,xr(this,l,u,"error"),xr(this,l,u,"fatal"),xr(this,l,u,"warn"),xr(this,l,u,"info"),xr(this,l,u,"debug"),xr(this,l,u,"trace"),o.forEach(y=>{xr(this,l,u,y)})}function d(g,y,x){if(!y)throw new Error("missing bindings for child Pino");x=x||{},n&&y.serializers&&(x.serializers=y.serializers);const I=x.serializers;if(n&&I){var w=Object.assign({},i,I),b=t.browser.serialize===!0?Object.keys(w):n;delete y.serializers,ia([y],b,w,this._stdErrSerialize)}function m(A){this._childLevel=(A._childLevel|0)+1,this.bindings=y,w&&(this.serializers=w,this._serialize=b),e&&(this._logEvent=go([].concat(A._logEvent.bindings,y)))}m.prototype=this;const _=new m(this);return hc(this,_),_.child=function(...A){return d.call(this,g,...A)},_.level=x.level||this.level,g.onChild(_),_}return u}function Rg(t){const e=t.customLevels||{},r=Object.assign({},Gt.levels.values,e),i=Object.assign({},Gt.levels.labels,Cg(e));return{values:r,labels:i}}function Cg(t){const e={};return Object.keys(t).forEach(function(r){e[t[r]]=r}),e}Gt.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},Gt.stdSerializers=$g,Gt.stdTimeFunctions=Object.assign({},{nullTime:Yl,epochTime:Zl,unixTime:qg,isoTime:jg});function Ng(t){const e=[];t.bindings&&e.push(t.bindings);let r=t[po];for(;r.parent;)r=r.parent,r.logger.bindings&&e.push(r.logger.bindings);return e.reverse()}function xr(t,e,r,i){if(Object.defineProperty(t,i,{value:dr(t.level,r)>dr(i,r)?Jr:r[ra][i],writable:!0,enumerable:!0,configurable:!0}),t[i]===Jr){if(!e.transmit)return;const s=e.transmit.level||t.level,o=dr(s,r);if(dr(i,r)<o)return}t[i]=kg(t,e,r,i);const n=Ng(t);n.length!==0&&(t[i]=Ug(n,t[i]))}function Ug(t,e){return function(){return e.apply(this,[...t,...arguments])}}function kg(t,e,r,i){return(function(n){return function(){const s=e.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Ri?Ri:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];var u=!1;if(e.serialize&&(ia(o,this._serialize,this.serializers,this._stdErrSerialize),u=!0),e.asObject||e.formatters?n.call(a,...Lg(this,i,o,s,e)):n.apply(a,o),e.transmit){const l=e.transmit.level||t._level,h=dr(l,r),f=dr(i,r);if(f<h)return;Fg(this,{ts:s,methodLevel:i,methodValue:f,transmitValue:r.levels.values[e.transmit.level||t._level],send:e.transmit.send,val:dr(t._level,r)},o,u)}}})(t[ra][i])}function Lg(t,e,r,i,n){const{level:s,log:o=h=>h}=n.formatters||{},a=r.slice();let c=a[0];const u={};let l=(t._childLevel|0)+1;if(l<1&&(l=1),i&&(u.time=i),s){const h=s(e,t.levels.values[e]);Object.assign(u,h)}else u.level=t.levels.values[e];if(n.asObjectBindingsOnly){if(c!==null&&typeof c=="object")for(;l--&&typeof a[0]=="object";)Object.assign(u,a.shift());return[o(u),...a]}else{if(c!==null&&typeof c=="object"){for(;l--&&typeof a[0]=="object";)Object.assign(u,a.shift());c=a.length?lc(a.shift(),a):void 0}else typeof c=="string"&&(c=lc(a.shift(),a));return c!==void 0&&(u[n.messageKey]=c),[o(u)]}}function ia(t,e,r,i){for(const n in t)if(i&&t[n]instanceof Error)t[n]=Gt.stdSerializers.err(t[n]);else if(typeof t[n]=="object"&&!Array.isArray(t[n])&&e)for(const s in t[n])e.indexOf(s)>-1&&s in r&&(t[n][s]=r[s](t[n][s]))}function Fg(t,e,r,i=!1){const n=e.send,s=e.ts,o=e.methodLevel,a=e.methodValue,c=e.val,u=t._logEvent.bindings;i||ia(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=s,t._logEvent.messages=r.filter(function(l){return u.indexOf(l)===-1}),t._logEvent.level.label=o,t._logEvent.level.value=a,n(o,t._logEvent,c),t._logEvent=go(u)}function go(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function fc(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function Mg(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Yl:Zl}function sn(){return{}}function ws(t){return t}function Jr(){}function Yl(){return!1}function Zl(){return Date.now()}function qg(){return Math.round(Date.now()/1e3)}function jg(){return new Date(Date.now()).toISOString()}function zg(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}Bt.exports.default=Gt;Bt.exports.pino=Gt;const Vg={level:"info"},Vn="custom_context",na=1e3*1024;var Kg=Object.defineProperty,Hg=(t,e,r)=>e in t?Kg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lr=(t,e,r)=>Hg(t,typeof e!="symbol"?e+"":e,r);let Wg=class{constructor(e){lr(this,"nodeValue"),lr(this,"sizeInBytes"),lr(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},dc=class{constructor(e){lr(this,"lengthInNodes"),lr(this,"sizeInBytes"),lr(this,"head"),lr(this,"tail"),lr(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new Wg(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}};const Gg=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r);function pc(t){return typeof t=="string"?t:Gg(t)||""}var Yg=Object.defineProperty,Zg=(t,e,r)=>e in t?Yg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,on=(t,e,r)=>Zg(t,typeof e!="symbol"?e+"":e,r);let Xl=class{constructor(e,r=na){on(this,"logs"),on(this,"level"),on(this,"levelValue"),on(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=Bt.exports.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new dc(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===Bt.exports.levels.values.error?console.error(e):r===Bt.exports.levels.values.warn?console.warn(e):r===Bt.exports.levels.values.debug?console.debug(e):r===Bt.exports.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(pc({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new dc(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(pc({extraMetadata:e})),new Blob(r,{type:"application/json"})}};var Xg=Object.defineProperty,Jg=(t,e,r)=>e in t?Xg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Qg=(t,e,r)=>Jg(t,e+"",r);let ey=class{constructor(e,r=na){Qg(this,"baseChunkLogger"),this.baseChunkLogger=new Xl(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=r,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}};var ty=Object.defineProperty,ry=(t,e,r)=>e in t?ty(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,iy=(t,e,r)=>ry(t,e+"",r);let ny=class{constructor(e,r=na){iy(this,"baseChunkLogger"),this.baseChunkLogger=new Xl(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var sy=Object.defineProperty,oy=Object.defineProperties,ay=Object.getOwnPropertyDescriptors,gc=Object.getOwnPropertySymbols,cy=Object.prototype.hasOwnProperty,uy=Object.prototype.propertyIsEnumerable,yc=(t,e,r)=>e in t?sy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,On=(t,e)=>{for(var r in e||(e={}))cy.call(e,r)&&yc(t,r,e[r]);if(gc)for(var r of gc(e))uy.call(e,r)&&yc(t,r,e[r]);return t},An=(t,e)=>oy(t,ay(e));function ly(t){return An(On({},t),{level:t?.level||Vg.level})}function hy(t,e,r=Vn){return t[r]=e,t}function Je(t,e=Vn){return t[e]||""}function fy(t,e,r=Vn){const i=Je(t,r);return i.trim()?`${i}/${e}`:e}function nt(t,e,r=Vn){const i=fy(t,e,r),n=t.child({context:i});return hy(n,i,r)}function dy(t){var e,r;const i=new ey((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Bt.exports(An(On({},t.opts),{level:"trace",browser:An(On({},(r=t.opts)==null?void 0:r.browser),{write:n=>i.write(n)})})),chunkLoggerController:i}}function py(t){var e;const r=new ny((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Bt.exports(An(On({},t.opts),{level:"trace"}),r),chunkLoggerController:r}}function Jl(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?dy(t):py(t)}var gy=Object.defineProperty,yy=(t,e,r)=>e in t?gy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wc=(t,e,r)=>yy(t,typeof e!="symbol"?e+"":e,r);let wy=class extends kr{constructor(e){super(),this.opts=e,wc(this,"protocol","wc"),wc(this,"version",2)}};var by=Object.defineProperty,my=(t,e,r)=>e in t?by(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vy=(t,e,r)=>my(t,e+"",r);class Ey extends kr{constructor(e,r){super(),this.core=e,this.logger=r,vy(this,"records",new Map)}}class xy{constructor(e,r){this.logger=e,this.core=r}}class _y extends kr{constructor(e,r){super(),this.relayer=e,this.logger=r}}let Iy=class extends kr{constructor(e){super()}},Sy=class{constructor(e,r,i,n){this.core=e,this.logger=r,this.name=i}},Dy=class extends kr{constructor(e,r){super(),this.relayer=e,this.logger=r}},Oy=class extends kr{constructor(e,r){super(),this.core=e,this.logger=r}},Ay=class{constructor(e,r,i){this.core=e,this.logger=r,this.store=i}};class $y{constructor(e,r){this.projectId=e,this.logger=r}}let By=class{constructor(e,r,i){this.core=e,this.logger=r,this.telemetryEnabled=i}};var Py=Object.defineProperty,Ty=(t,e,r)=>e in t?Py(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bc=(t,e,r)=>Ty(t,typeof e!="symbol"?e+"":e,r);let Ry=class{constructor(e){this.opts=e,bc(this,"protocol","wc"),bc(this,"version",2)}},Cy=class{constructor(e){this.client=e}};function Ny(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ql(t,...e){if(!Ny(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function mc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Uy(t,e){Ql(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const Vr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const bs=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function ky(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function eh(t){return typeof t=="string"&&(t=ky(t)),Ql(t),t}let Ly=class{clone(){return this._cloneInto()}};function Fy(t){const e=i=>t().update(eh(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function th(t=32){if(Vr&&typeof Vr.getRandomValues=="function")return Vr.getRandomValues(new Uint8Array(t));if(Vr&&typeof Vr.randomBytes=="function")return Vr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function My(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s),c=i?4:0,u=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+u,a,i)}let qy=class extends Ly{constructor(e,r,i,n){super(),this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=bs(this.buffer)}update(e){mc(this);const{view:r,buffer:i,blockLen:n}=this;e=eh(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(n-this.pos,s-o);if(a===n){const c=bs(e);for(;n<=s-o;o+=n)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){mc(this),Uy(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:n,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>n-o&&(this.process(i,0),o=0);for(let h=o;h<n;h++)r[h]=0;My(i,n-8,BigInt(this.length*8),s),this.process(i,0);const a=bs(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:n,finished:s,destroyed:o,pos:a}=this;return e.length=n,e.pos=a,e.finished=s,e.destroyed=o,n%r&&e.buffer.set(i),e}};const an=BigInt(2**32-1),yo=BigInt(32);function rh(t,e=!1){return e?{h:Number(t&an),l:Number(t>>yo&an)}:{h:Number(t>>yo&an)|0,l:Number(t&an)|0}}function jy(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let n=0;n<t.length;n++){const{h:s,l:o}=rh(t[n],e);[r[n],i[n]]=[s,o]}return[r,i]}const zy=(t,e)=>BigInt(t>>>0)<<yo|BigInt(e>>>0),Vy=(t,e,r)=>t>>>r,Ky=(t,e,r)=>t<<32-r|e>>>r,Hy=(t,e,r)=>t>>>r|e<<32-r,Wy=(t,e,r)=>t<<32-r|e>>>r,Gy=(t,e,r)=>t<<64-r|e>>>r-32,Yy=(t,e,r)=>t>>>r-32|e<<64-r,Zy=(t,e)=>e,Xy=(t,e)=>t,Jy=(t,e,r)=>t<<r|e>>>32-r,Qy=(t,e,r)=>e<<r|t>>>32-r,e0=(t,e,r)=>e<<r-32|t>>>64-r,t0=(t,e,r)=>t<<r-32|e>>>64-r;function r0(t,e,r,i){const n=(e>>>0)+(i>>>0);return{h:t+r+(n/2**32|0)|0,l:n|0}}const i0=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),n0=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,s0=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),o0=(t,e,r,i,n)=>e+r+i+n+(t/2**32|0)|0,a0=(t,e,r,i,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(n>>>0),c0=(t,e,r,i,n,s)=>e+r+i+n+s+(t/2**32|0)|0,Y={fromBig:rh,split:jy,toBig:zy,shrSH:Vy,shrSL:Ky,rotrSH:Hy,rotrSL:Wy,rotrBH:Gy,rotrBL:Yy,rotr32H:Zy,rotr32L:Xy,rotlSH:Jy,rotlSL:Qy,rotlBH:e0,rotlBL:t0,add:r0,add3L:i0,add3H:n0,add4L:s0,add4H:o0,add5H:c0,add5L:a0},[u0,l0]=Y.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Jt=new Uint32Array(80),Qt=new Uint32Array(80);let h0=class extends qy{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:i,Bl:n,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:f,Gh:p,Gl:d,Hh:g,Hl:y}=this;return[e,r,i,n,s,o,a,c,u,l,h,f,p,d,g,y]}set(e,r,i,n,s,o,a,c,u,l,h,f,p,d,g,y){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=n|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=y|0}process(e,r){for(let w=0;w<16;w++,r+=4)Jt[w]=e.getUint32(r),Qt[w]=e.getUint32(r+=4);for(let w=16;w<80;w++){const b=Jt[w-15]|0,m=Qt[w-15]|0,_=Y.rotrSH(b,m,1)^Y.rotrSH(b,m,8)^Y.shrSH(b,m,7),A=Y.rotrSL(b,m,1)^Y.rotrSL(b,m,8)^Y.shrSL(b,m,7),B=Jt[w-2]|0,$=Qt[w-2]|0,N=Y.rotrSH(B,$,19)^Y.rotrBH(B,$,61)^Y.shrSH(B,$,6),U=Y.rotrSL(B,$,19)^Y.rotrBL(B,$,61)^Y.shrSL(B,$,6),C=Y.add4L(A,U,Qt[w-7],Qt[w-16]),D=Y.add4H(C,_,N,Jt[w-7],Jt[w-16]);Jt[w]=D|0,Qt[w]=C|0}let{Ah:i,Al:n,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:f,Fh:p,Fl:d,Gh:g,Gl:y,Hh:x,Hl:I}=this;for(let w=0;w<80;w++){const b=Y.rotrSH(h,f,14)^Y.rotrSH(h,f,18)^Y.rotrBH(h,f,41),m=Y.rotrSL(h,f,14)^Y.rotrSL(h,f,18)^Y.rotrBL(h,f,41),_=h&p^~h&g,A=f&d^~f&y,B=Y.add5L(I,m,A,l0[w],Qt[w]),$=Y.add5H(B,x,b,_,u0[w],Jt[w]),N=B|0,U=Y.rotrSH(i,n,28)^Y.rotrBH(i,n,34)^Y.rotrBH(i,n,39),C=Y.rotrSL(i,n,28)^Y.rotrBL(i,n,34)^Y.rotrBL(i,n,39),D=i&s^i&a^s&a,T=n&o^n&c^o&c;x=g|0,I=y|0,g=p|0,y=d|0,p=h|0,d=f|0,{h,l:f}=Y.add(u|0,l|0,$|0,N|0),u=a|0,l=c|0,a=s|0,c=o|0,s=i|0,o=n|0;const E=Y.add3L(N,C,T);i=Y.add3H(E,$,U,D),n=E|0}({h:i,l:n}=Y.add(this.Ah|0,this.Al|0,i|0,n|0)),{h:s,l:o}=Y.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Y.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=Y.add(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:f}=Y.add(this.Eh|0,this.El|0,h|0,f|0),{h:p,l:d}=Y.add(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:y}=Y.add(this.Gh|0,this.Gl|0,g|0,y|0),{h:x,l:I}=Y.add(this.Hh|0,this.Hl|0,x|0,I|0),this.set(i,n,s,o,a,c,u,l,h,f,p,d,g,y,x,I)}roundClean(){Jt.fill(0),Qt.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const f0=Fy(()=>new h0);const sa=BigInt(0),ih=BigInt(1),d0=BigInt(2);function oa(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function aa(t){if(!oa(t))throw new Error("Uint8Array expected")}function ms(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const p0=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ca(t){aa(t);let e="";for(let r=0;r<t.length;r++)e+=p0[t[r]];return e}function nh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?sa:BigInt("0x"+t)}const Rt={_0:48,_9:57,A:65,F:70,a:97,f:102};function vc(t){if(t>=Rt._0&&t<=Rt._9)return t-Rt._0;if(t>=Rt.A&&t<=Rt.F)return t-(Rt.A-10);if(t>=Rt.a&&t<=Rt.f)return t-(Rt.a-10)}function sh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let n=0,s=0;n<r;n++,s+=2){const o=vc(t.charCodeAt(s)),a=vc(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[n]=o*16+a}return i}function g0(t){return nh(ca(t))}function En(t){return aa(t),nh(ca(Uint8Array.from(t).reverse()))}function oh(t,e){return sh(t.toString(16).padStart(e*2,"0"))}function wo(t,e){return oh(t,e).reverse()}function Ct(t,e,r){let i;if(typeof e=="string")try{i=sh(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(oa(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=i.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return i}function Ec(...t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];aa(n),e+=n.length}const r=new Uint8Array(e);for(let i=0,n=0;i<t.length;i++){const s=t[i];r.set(s,n),n+=s.length}return r}const vs=t=>typeof t=="bigint"&&sa<=t;function y0(t,e,r){return vs(t)&&vs(e)&&vs(r)&&e<=t&&t<r}function hi(t,e,r,i){if(!y0(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function w0(t){let e;for(e=0;t>sa;t>>=ih,e+=1);return e}const b0=t=>(d0<<BigInt(t-1))-ih,m0={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||oa(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function ua(t,e,r={}){const i=(n,s,o)=>{const a=m0[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[n];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(n)+" is invalid. Expected "+s+", got "+c)};for(const[n,s]of Object.entries(e))i(n,s,!1);for(const[n,s]of Object.entries(r))i(n,s,!0);return t}function xc(t){const e=new WeakMap;return(r,...i)=>{const n=e.get(r);if(n!==void 0)return n;const s=t(r,...i);return e.set(r,s),s}}const Se=BigInt(0),he=BigInt(1),Dr=BigInt(2),v0=BigInt(3),bo=BigInt(4),_c=BigInt(5),Ic=BigInt(8);function be(t,e){const r=t%e;return r>=Se?r:e+r}function E0(t,e,r){if(e<Se)throw new Error("invalid exponent, negatives unsupported");if(r<=Se)throw new Error("invalid modulus");if(r===he)return Se;let i=he;for(;e>Se;)e&he&&(i=i*t%r),t=t*t%r,e>>=he;return i}function _t(t,e,r){let i=t;for(;e-- >Se;)i*=i,i%=r;return i}function Sc(t,e){if(t===Se)throw new Error("invert: expected non-zero number");if(e<=Se)throw new Error("invert: expected positive modulus, got "+e);let r=be(t,e),i=e,n=Se,s=he;for(;r!==Se;){const o=i/r,a=i%r,c=n-s*o;i=r,r=a,n=s,s=c}if(i!==he)throw new Error("invert: does not exist");return be(n,e)}function x0(t){const e=(t-he)/Dr;let r,i,n;for(r=t-he,i=0;r%Dr===Se;r/=Dr,i++);for(n=Dr;n<t&&E0(n,e,t)!==t-he;n++)if(n>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(t+he)/bo;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(r+he)/Dr;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,u=o.pow(o.mul(o.ONE,n),r),l=o.pow(a,s),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let f=1;for(let d=o.sqr(h);f<c&&!o.eql(d,o.ONE);f++)d=o.sqr(d);const p=o.pow(u,he<<BigInt(c-f-1));u=o.sqr(p),l=o.mul(l,p),h=o.mul(h,u),c=f}return l}}function _0(t){if(t%bo===v0){const e=(t+he)/bo;return function(r,i){const n=r.pow(i,e);if(!r.eql(r.sqr(n),i))throw new Error("Cannot find square root");return n}}if(t%Ic===_c){const e=(t-_c)/Ic;return function(r,i){const n=r.mul(i,Dr),s=r.pow(n,e),o=r.mul(i,s),a=r.mul(r.mul(o,Dr),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return x0(t)}const I0=(t,e)=>(be(t,e)&he)===he,S0=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function D0(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=S0.reduce((i,n)=>(i[n]="function",i),e);return ua(t,r)}function O0(t,e,r){if(r<Se)throw new Error("invalid exponent, negatives unsupported");if(r===Se)return t.ONE;if(r===he)return e;let i=t.ONE,n=e;for(;r>Se;)r&he&&(i=t.mul(i,n)),n=t.sqr(n),r>>=he;return i}function A0(t,e){const r=new Array(e.length),i=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),n=t.inv(i);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),n),r}function ah(t,e){const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function ch(t,e,r=!1,i={}){if(t<=Se)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:n,nByteLength:s}=ah(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:n,BYTES:s,MASK:b0(n),ZERO:Se,ONE:he,create:c=>be(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Se<=c&&c<t},is0:c=>c===Se,isOdd:c=>(c&he)===he,neg:c=>be(-c,t),eql:(c,u)=>c===u,sqr:c=>be(c*c,t),add:(c,u)=>be(c+u,t),sub:(c,u)=>be(c-u,t),mul:(c,u)=>be(c*u,t),pow:(c,u)=>O0(a,c,u),div:(c,u)=>be(c*Sc(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Sc(c,t),sqrt:i.sqrt||(c=>(o||(o=_0(t)),o(a,c))),invertBatch:c=>A0(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>r?wo(c,s):oh(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?En(c):g0(c)}});return Object.freeze(a)}const Dc=BigInt(0),cn=BigInt(1);function Es(t,e){const r=e.negate();return t?r:e}function uh(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function xs(t,e){uh(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1);return{windows:r,windowSize:i}}function $0(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function B0(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const _s=new WeakMap,lh=new WeakMap;function Is(t){return lh.get(t)||1}function P0(t,e){return{constTimeNegate:Es,hasPrecomputes(r){return Is(r)!==1},unsafeLadder(r,i,n=t.ZERO){let s=r;for(;i>Dc;)i&cn&&(n=n.add(s)),s=s.double(),i>>=cn;return n},precomputeWindow(r,i){const{windows:n,windowSize:s}=xs(i,e),o=[];let a=r,c=a;for(let u=0;u<n;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,n){const{windows:s,windowSize:o}=xs(r,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let f=0;f<s;f++){const p=f*o;let d=Number(n&u);n>>=h,d>o&&(d-=l,n+=cn);const g=p,y=p+Math.abs(d)-1,x=f%2!==0,I=d<0;d===0?c=c.add(Es(x,i[g])):a=a.add(Es(I,i[y]))}return{p:a,f:c}},wNAFUnsafe(r,i,n,s=t.ZERO){const{windows:o,windowSize:a}=xs(r,e),c=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let h=0;h<o;h++){const f=h*a;if(n===Dc)break;let p=Number(n&c);if(n>>=l,p>a&&(p-=u,n+=cn),p===0)continue;let d=i[f+Math.abs(p)-1];p<0&&(d=d.negate()),s=s.add(d)}return s},getPrecomputes(r,i,n){let s=_s.get(i);return s||(s=this.precomputeWindow(i,r),r!==1&&_s.set(i,n(s))),s},wNAFCached(r,i,n){const s=Is(r);return this.wNAF(s,this.getPrecomputes(s,r,n),i)},wNAFCachedUnsafe(r,i,n,s){const o=Is(r);return o===1?this.unsafeLadder(r,i,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,n),i,s)},setWindowSize(r,i){uh(i,e),lh.set(r,i),_s.delete(r)}}}function T0(t,e,r,i){if($0(r,t),B0(i,e),r.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const n=t.ZERO,s=w0(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(n),u=Math.floor((e.BITS-1)/o)*o;let l=n;for(let h=u;h>=0;h-=o){c.fill(n);for(let p=0;p<i.length;p++){const d=i[p],g=Number(d>>BigInt(h)&BigInt(a));c[g]=c[g].add(r[p])}let f=n;for(let p=c.length-1,d=n;p>0;p--)d=d.add(c[p]),f=f.add(d);if(l=l.add(f),h!==0)for(let p=0;p<o;p++)l=l.double()}return l}function R0(t){return D0(t.Fp),ua(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...ah(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const pt=BigInt(0),je=BigInt(1),un=BigInt(2),C0=BigInt(8),N0={zip215:!0};function U0(t){const e=R0(t);return ua(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function k0(t){const e=U0(t),{Fp:r,n:i,prehash:n,hash:s,randomBytes:o,nByteLength:a,h:c}=e,u=un<<BigInt(a*8)-je,l=r.create,h=ch(e.n,e.nBitLength),f=e.uvRatio||((E,v)=>{try{return{isValid:!0,value:r.sqrt(E*r.inv(v))}}catch{return{isValid:!1,value:pt}}}),p=e.adjustScalarBytes||(E=>E),d=e.domain||((E,v,O)=>{if(ms("phflag",O),v.length||O)throw new Error("Contexts/pre-hash are not supported");return E});function g(E,v){hi("coordinate "+E,v,pt,u)}function y(E){if(!(E instanceof w))throw new Error("ExtendedPoint expected")}const x=xc((E,v)=>{const{ex:O,ey:R,ez:S}=E,P=E.is0();v==null&&(v=P?C0:r.inv(S));const k=l(O*v),L=l(R*v),K=l(S*v);if(P)return{x:pt,y:je};if(K!==je)throw new Error("invZ was invalid");return{x:k,y:L}}),I=xc(E=>{const{a:v,d:O}=e;if(E.is0())throw new Error("bad point: ZERO");const{ex:R,ey:S,ez:P,et:k}=E,L=l(R*R),K=l(S*S),z=l(P*P),j=l(z*z),H=l(L*v),G=l(z*l(H+K)),Z=l(j+l(O*l(L*K)));if(G!==Z)throw new Error("bad point: equation left != right (1)");const W=l(R*S),X=l(P*k);if(W!==X)throw new Error("bad point: equation left != right (2)");return!0});class w{constructor(v,O,R,S){this.ex=v,this.ey=O,this.ez=R,this.et=S,g("x",v),g("y",O),g("z",R),g("t",S),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(v){if(v instanceof w)throw new Error("extended point not allowed");const{x:O,y:R}=v||{};return g("x",O),g("y",R),new w(O,R,je,l(O*R))}static normalizeZ(v){const O=r.invertBatch(v.map(R=>R.ez));return v.map((R,S)=>R.toAffine(O[S])).map(w.fromAffine)}static msm(v,O){return T0(w,h,v,O)}_setWindowSize(v){_.setWindowSize(this,v)}assertValidity(){I(this)}equals(v){y(v);const{ex:O,ey:R,ez:S}=this,{ex:P,ey:k,ez:L}=v,K=l(O*L),z=l(P*S),j=l(R*L),H=l(k*S);return K===z&&j===H}is0(){return this.equals(w.ZERO)}negate(){return new w(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:v}=e,{ex:O,ey:R,ez:S}=this,P=l(O*O),k=l(R*R),L=l(un*l(S*S)),K=l(v*P),z=O+R,j=l(l(z*z)-P-k),H=K+k,G=H-L,Z=K-k,W=l(j*G),X=l(H*Z),ue=l(j*Z),ge=l(G*H);return new w(W,X,ge,ue)}add(v){y(v);const{a:O,d:R}=e,{ex:S,ey:P,ez:k,et:L}=this,{ex:K,ey:z,ez:j,et:H}=v;if(O===BigInt(-1)){const La=l((P-S)*(z+K)),Fa=l((P+S)*(z-K)),us=l(Fa-La);if(us===pt)return this.double();const Ma=l(k*un*H),qa=l(L*un*j),ja=qa+Ma,za=Fa+La,Va=qa-Ma,Zd=l(ja*us),Xd=l(za*Va),Jd=l(ja*Va),Qd=l(us*za);return new w(Zd,Xd,Qd,Jd)}const G=l(S*K),Z=l(P*z),W=l(L*R*H),X=l(k*j),ue=l((S+P)*(K+z)-G-Z),ge=X-W,me=X+W,Le=l(Z-O*G),xt=l(ue*ge),en=l(me*Le),Gd=l(ue*Le),Yd=l(ge*me);return new w(xt,en,Yd,Gd)}subtract(v){return this.add(v.negate())}wNAF(v){return _.wNAFCached(this,v,w.normalizeZ)}multiply(v){const O=v;hi("scalar",O,je,i);const{p:R,f:S}=this.wNAF(O);return w.normalizeZ([R,S])[0]}multiplyUnsafe(v,O=w.ZERO){const R=v;return hi("scalar",R,pt,i),R===pt?m:this.is0()||R===je?this:_.wNAFCachedUnsafe(this,R,w.normalizeZ,O)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return _.unsafeLadder(this,i).is0()}toAffine(v){return x(this,v)}clearCofactor(){const{h:v}=e;return v===je?this:this.multiplyUnsafe(v)}static fromHex(v,O=!1){const{d:R,a:S}=e,P=r.BYTES;v=Ct("pointHex",v,P),ms("zip215",O);const k=v.slice(),L=v[P-1];k[P-1]=L&-129;const K=En(k),z=O?u:r.ORDER;hi("pointHex.y",K,pt,z);const j=l(K*K),H=l(j-je),G=l(R*j-S);let{isValid:Z,value:W}=f(H,G);if(!Z)throw new Error("Point.fromHex: invalid y coordinate");const X=(W&je)===je,ue=(L&128)!==0;if(!O&&W===pt&&ue)throw new Error("Point.fromHex: x=0 and x_0=1");return ue!==X&&(W=l(-W)),w.fromAffine({x:W,y:K})}static fromPrivateKey(v){return $(v).point}toRawBytes(){const{x:v,y:O}=this.toAffine(),R=wo(O,r.BYTES);return R[R.length-1]|=v&je?128:0,R}toHex(){return ca(this.toRawBytes())}}w.BASE=new w(e.Gx,e.Gy,je,l(e.Gx*e.Gy)),w.ZERO=new w(pt,je,je,pt);const{BASE:b,ZERO:m}=w,_=P0(w,a*8);function A(E){return be(E,i)}function B(E){return A(En(E))}function $(E){const v=r.BYTES;E=Ct("private key",E,v);const O=Ct("hashed private key",s(E),2*v),R=p(O.slice(0,v)),S=O.slice(v,2*v),P=B(R),k=b.multiply(P),L=k.toRawBytes();return{head:R,prefix:S,scalar:P,point:k,pointBytes:L}}function N(E){return $(E).pointBytes}function U(E=new Uint8Array,...v){const O=Ec(...v);return B(s(d(O,Ct("context",E),!!n)))}function C(E,v,O={}){E=Ct("message",E),n&&(E=n(E));const{prefix:R,scalar:S,pointBytes:P}=$(v),k=U(O.context,R,E),L=b.multiply(k).toRawBytes(),K=U(O.context,L,P,E),z=A(k+K*S);hi("signature.s",z,pt,i);const j=Ec(L,wo(z,r.BYTES));return Ct("result",j,r.BYTES*2)}const D=N0;function T(E,v,O,R=D){const{context:S,zip215:P}=R,k=r.BYTES;E=Ct("signature",E,2*k),v=Ct("message",v),O=Ct("publicKey",O,k),P!==void 0&&ms("zip215",P),n&&(v=n(v));const L=En(E.slice(k,2*k));let K,z,j;try{K=w.fromHex(O,P),z=w.fromHex(E.slice(0,k),P),j=b.multiplyUnsafe(L)}catch{return!1}if(!P&&K.isSmallOrder())return!1;const H=U(S,z.toRawBytes(),K.toRawBytes(),v);return z.add(K.multiplyUnsafe(H)).subtract(j).clearCofactor().equals(w.ZERO)}return b._setWindowSize(8),{CURVE:e,getPublicKey:N,sign:C,verify:T,ExtendedPoint:w,utils:{getExtendedPublicKey:$,randomPrivateKey:()=>o(r.BYTES),precompute(E=8,v=w.BASE){return v._setWindowSize(E),v.multiply(BigInt(3)),v}}}}BigInt(0),BigInt(1);const la=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Oc=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const L0=BigInt(1),Ac=BigInt(2);BigInt(3);const F0=BigInt(5),M0=BigInt(8);function q0(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),n=BigInt(80),s=la,o=t*t%s*t%s,a=_t(o,Ac,s)*o%s,c=_t(a,L0,s)*t%s,u=_t(c,F0,s)*c%s,l=_t(u,e,s)*u%s,h=_t(l,r,s)*l%s,f=_t(h,i,s)*h%s,p=_t(f,n,s)*f%s,d=_t(p,n,s)*f%s,g=_t(d,e,s)*u%s;return{pow_p_5_8:_t(g,Ac,s)*t%s,b2:o}}function j0(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function z0(t,e){const r=la,i=be(e*e*e,r),n=be(i*i*e,r),s=q0(t*n).pow_p_5_8;let o=be(t*i*s,r);const a=be(e*o*o,r),c=o,u=be(o*Oc,r),l=a===t,h=a===be(-t,r),f=a===be(-t*Oc,r);return l&&(o=c),(h||f)&&(o=u),I0(o,r)&&(o=be(-o,r)),{isValid:l||h,value:o}}const V0=ch(la,void 0,!0),K0={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:V0,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:M0,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:f0,randomBytes:th,adjustScalarBytes:j0,uvRatio:z0},hh=k0(K0),H0="EdDSA",W0="JWT",$n=".",Kn="base64url",fh="utf8",dh="utf8",G0=":",Y0="did",Z0="key",$c="base58btc",X0="z",J0="K36",Q0=32;function ha(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function ph(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ha(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function gh(t,e){e||(e=t.reduce((n,s)=>n+s.length,0));const r=ph(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return ha(r)}function ew(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,y=0,x=0,I=d.length;x!==I&&d[x]===0;)x++,g++;for(var w=(I-x)*l+1>>>0,b=new Uint8Array(w);x!==I;){for(var m=d[x],_=0,A=w-1;(m!==0||_<y)&&A!==-1;A--,_++)m+=256*b[A]>>>0,b[A]=m%a>>>0,m=m/a>>>0;if(m!==0)throw new Error("Non-zero carry");y=_,x++}for(var B=w-y;B!==w&&b[B]===0;)B++;for(var $=c.repeat(g);B<w;++B)$+=t.charAt(b[B]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var y=0,x=0;d[g]===c;)y++,g++;for(var I=(d.length-g)*u+1>>>0,w=new Uint8Array(I);d[g];){var b=r[d.charCodeAt(g)];if(b===255)return;for(var m=0,_=I-1;(b!==0||m<x)&&_!==-1;_--,m++)b+=a*w[_]>>>0,w[_]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");x=m,g++}if(d[g]!==" "){for(var A=I-x;A!==I&&w[A]===0;)A++;for(var B=new Uint8Array(y+(I-A)),$=y;A!==I;)B[$++]=w[A++];return B}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var tw=ew,rw=tw;const yh=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},iw=t=>new TextEncoder().encode(t),nw=t=>new TextDecoder().decode(t);let sw=class{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},ow=class{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return wh(this,e)}},aw=class{constructor(e){this.decoders=e}or(e){return wh(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const wh=(t,e)=>new aw({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let cw=class{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new sw(e,r,i),this.decoder=new ow(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Hn=({name:t,prefix:e,encode:r,decode:i})=>new cw(t,e,r,i),zi=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=rw(r,e);return Hn({prefix:t,name:e,encode:i,decode:s=>yh(n(s))})},uw=(t,e,r,i)=>{const n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=n[t[l]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},lw=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[n&a>>o];if(o&&(s+=e[n&a<<r-o]),i)for(;s.length*r&7;)s+="=";return s},Be=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Hn({prefix:e,name:t,encode(n){return lw(n,i,r)},decode(n){return uw(n,i,r,t)}}),hw=Hn({prefix:"\0",name:"identity",encode:t=>nw(t),decode:t=>iw(t)});var fw=Object.freeze({__proto__:null,identity:hw});const dw=Be({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var pw=Object.freeze({__proto__:null,base2:dw});const gw=Be({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var yw=Object.freeze({__proto__:null,base8:gw});const ww=zi({prefix:"9",name:"base10",alphabet:"0123456789"});var bw=Object.freeze({__proto__:null,base10:ww});const mw=Be({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),vw=Be({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Ew=Object.freeze({__proto__:null,base16:mw,base16upper:vw});const xw=Be({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),_w=Be({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Iw=Be({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Sw=Be({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Dw=Be({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ow=Be({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Aw=Be({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),$w=Be({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Bw=Be({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Pw=Object.freeze({__proto__:null,base32:xw,base32upper:_w,base32pad:Iw,base32padupper:Sw,base32hex:Dw,base32hexupper:Ow,base32hexpad:Aw,base32hexpadupper:$w,base32z:Bw});const Tw=zi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Rw=zi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Cw=Object.freeze({__proto__:null,base36:Tw,base36upper:Rw});const Nw=zi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Uw=zi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var kw=Object.freeze({__proto__:null,base58btc:Nw,base58flickr:Uw});const Lw=Be({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Fw=Be({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Mw=Be({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),qw=Be({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var jw=Object.freeze({__proto__:null,base64:Lw,base64pad:Fw,base64url:Mw,base64urlpad:qw});const bh=Array.from(""),zw=bh.reduce((t,e,r)=>(t[r]=e,t),[]),Vw=bh.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Kw(t){return t.reduce((e,r)=>(e+=zw[r],e),"")}function Hw(t){const e=[];for(const r of t){const i=Vw[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Ww=Hn({prefix:"",name:"base256emoji",encode:Kw,decode:Hw});var Gw=Object.freeze({__proto__:null,base256emoji:Ww}),Yw=mh,Bc=128,Zw=-128,Xw=Math.pow(2,31);function mh(t,e,r){e=e||[],r=r||0;for(var i=r;t>=Xw;)e[r++]=t&255|Bc,t/=128;for(;t&Zw;)e[r++]=t&255|Bc,t>>>=7;return e[r]=t|0,mh.bytes=r-i+1,e}var Jw=mo,Qw=128,Pc=127;function mo(t,i){var r=0,i=i||0,n=0,s=i,o,a=t.length;do{if(s>=a)throw mo.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=n<28?(o&Pc)<<n:(o&Pc)*Math.pow(2,n),n+=7}while(o>=Qw);return mo.bytes=s-i,r}var eb=Math.pow(2,7),tb=Math.pow(2,14),rb=Math.pow(2,21),ib=Math.pow(2,28),nb=Math.pow(2,35),sb=Math.pow(2,42),ob=Math.pow(2,49),ab=Math.pow(2,56),cb=Math.pow(2,63),ub=function(t){return t<eb?1:t<tb?2:t<rb?3:t<ib?4:t<nb?5:t<sb?6:t<ob?7:t<ab?8:t<cb?9:10},lb={encode:Yw,decode:Jw,encodingLength:ub},vh=lb;const Tc=(t,e,r=0)=>(vh.encode(t,e,r),e),Rc=t=>vh.encodingLength(t),vo=(t,e)=>{const r=e.byteLength,i=Rc(t),n=i+Rc(r),s=new Uint8Array(n+r);return Tc(t,s,0),Tc(r,s,i),s.set(e,n),new hb(t,r,e,s)};let hb=class{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}};const Eh=({name:t,code:e,encode:r})=>new fb(t,e,r);let fb=class{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?vo(this.code,r):r.then(i=>vo(this.code,i))}else throw Error("Unknown type, must be binary type")}};const xh=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),db=Eh({name:"sha2-256",code:18,encode:xh("SHA-256")}),pb=Eh({name:"sha2-512",code:19,encode:xh("SHA-512")});var gb=Object.freeze({__proto__:null,sha256:db,sha512:pb});const _h=0,yb="identity",Ih=yh,wb=t=>vo(_h,Ih(t)),bb={code:_h,name:yb,encode:Ih,digest:wb};var mb=Object.freeze({__proto__:null,identity:bb});new TextEncoder,new TextDecoder;const Cc={...fw,...pw,...yw,...bw,...Ew,...Pw,...Cw,...kw,...jw,...Gw};({...gb,...mb});function Sh(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Nc=Sh("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Ss=Sh("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=ph(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Dh={utf8:Nc,"utf-8":Nc,hex:Cc.base16,latin1:Ss,ascii:Ss,binary:Ss,...Cc};function Wn(t,e="utf8"){const r=Dh[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function oi(t,e="utf8"){const r=Dh[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ha(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Uc(t){return ri(Wn(oi(t,Kn),fh))}function Bn(t){return Wn(oi(ji(t),fh),Kn)}function Oh(t){const e=oi(J0,$c),r=X0+Wn(gh([e,t]),$c);return[Y0,Z0,r].join(G0)}function vb(t){return Wn(t,Kn)}function Eb(t){return oi(t,Kn)}function xb(t){return oi([Bn(t.header),Bn(t.payload)].join($n),dh)}function _b(t){return[Bn(t.header),Bn(t.payload),vb(t.signature)].join($n)}function Eo(t){const e=t.split($n),r=Uc(e[0]),i=Uc(e[1]),n=Eb(e[2]),s=oi(e.slice(0,2).join($n),dh);return{header:r,payload:i,signature:n,data:s}}function kc(t=th(Q0)){const e=hh.getPublicKey(t);return{secretKey:gh([t,e]),publicKey:e}}async function Ib(t,e,r,i,n=M.fromMiliseconds(Date.now())){const s={alg:H0,typ:W0},o=Oh(i.publicKey),a=n+r,c={iss:o,sub:t,aud:e,iat:n,exp:a},u=xb({header:s,payload:c}),l=hh.sign(u,i.secretKey.slice(0,32));return _b({header:s,payload:c,signature:l})}var Lc=function(t,e,r){if(r||arguments.length===2)for(var i=0,n=e.length,s;i<n;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))},Sb=(function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t})(),Db=(function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t})(),Ob=(function(){function t(e,r,i,n){this.name=e,this.version=r,this.os=i,this.bot=n,this.type="bot-device"}return t})(),Ab=(function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t})(),$b=(function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t})(),Bb=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Pb=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Fc=3,Tb=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Bb]],Mc=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Rb(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new $b:typeof navigator<"u"?Nb(navigator.userAgent):kb()}function Cb(t){return t!==""&&Tb.reduce(function(e,r){var i=r[0],n=r[1];if(e)return e;var s=n.exec(t);return!!s&&[i,s]},!1)}function Nb(t){var e=Cb(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new Ab;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<Fc&&(n=Lc(Lc([],n,!0),Lb(Fc-n.length),!0)):n=[];var s=n.join("."),o=Ub(t),a=Pb.exec(t);return a&&a[1]?new Ob(r,s,o,a[1]):new Sb(r,s,o)}function Ub(t){for(var e=0,r=Mc.length;e<r;e++){var i=Mc[e],n=i[0],s=i[1],o=s.exec(t);if(o)return n}return null}function kb(){var t=typeof process<"u"&&process.version;return t?new Db(process.version.slice(1)):null}function Lb(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var ne={},qc;function Ah(){if(qc)return ne;qc=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.getLocalStorage=ne.getLocalStorageOrThrow=ne.getCrypto=ne.getCryptoOrThrow=ne.getLocation=ne.getLocationOrThrow=ne.getNavigator=ne.getNavigatorOrThrow=ne.getDocument=ne.getDocumentOrThrow=ne.getFromWindowOrThrow=ne.getFromWindow=void 0;function t(f){let p;return typeof window<"u"&&typeof window[f]<"u"&&(p=window[f]),p}ne.getFromWindow=t;function e(f){const p=t(f);if(!p)throw new Error(`${f} is not defined in Window`);return p}ne.getFromWindowOrThrow=e;function r(){return e("document")}ne.getDocumentOrThrow=r;function i(){return t("document")}ne.getDocument=i;function n(){return e("navigator")}ne.getNavigatorOrThrow=n;function s(){return t("navigator")}ne.getNavigator=s;function o(){return e("location")}ne.getLocationOrThrow=o;function a(){return t("location")}ne.getLocation=a;function c(){return e("crypto")}ne.getCryptoOrThrow=c;function u(){return t("crypto")}ne.getCrypto=u;function l(){return e("localStorage")}ne.getLocalStorageOrThrow=l;function h(){return t("localStorage")}return ne.getLocalStorage=h,ne}var Zt=Ah(),fi={},jc;function Fb(){if(jc)return fi;jc=1,Object.defineProperty(fi,"__esModule",{value:!0}),fi.getWindowMetadata=void 0;const t=Ah();function e(){let r,i;try{r=t.getDocumentOrThrow(),i=t.getLocationOrThrow()}catch{return null}function n(){const p=r.getElementsByTagName("link"),d=[];for(let g=0;g<p.length;g++){const y=p[g],x=y.getAttribute("rel");if(x&&x.toLowerCase().indexOf("icon")>-1){const I=y.getAttribute("href");if(I)if(I.toLowerCase().indexOf("https:")===-1&&I.toLowerCase().indexOf("http:")===-1&&I.indexOf("//")!==0){let w=i.protocol+"//"+i.host;if(I.indexOf("/")===0)w+=I;else{const b=i.pathname.split("/");b.pop();const m=b.join("/");w+=m+"/"+I}d.push(w)}else if(I.indexOf("//")===0){const w=i.protocol+I;d.push(w)}else d.push(I)}}return d}function s(...p){const d=r.getElementsByTagName("meta");for(let g=0;g<d.length;g++){const y=d[g],x=["itemprop","property","name"].map(I=>y.getAttribute(I)).filter(I=>I?p.includes(I):!1);if(x.length&&x){const I=y.getAttribute("content");if(I)return I}}return""}function o(){let p=s("name","og:site_name","og:title","twitter:title");return p||(p=r.title),p}function a(){return s("description","og:description","twitter:description","keywords")}const c=o(),u=a(),l=i.origin,h=n();return{description:u,url:l,icons:h,name:c}}return fi.getWindowMetadata=e,fi}var Mb=Fb();const qb="0.1.1";function jb(){return qb}class ce extends Error{constructor(e,r={}){const i=(()=>{if(r.cause instanceof ce){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:r.cause?.message?r.cause.message:r.details})(),n=r.cause instanceof ce&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${n??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...i||n?["",i?`Details: ${i}`:void 0,n?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${jb()}`}),this.cause=r.cause,this.details=i,this.docs=o,this.docsPath=n,this.shortMessage=e}walk(e){return $h(this,e)}}function $h(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?$h(t.cause,e):e?null:t}const zb=BigInt(0),di=BigInt(1),Vb=BigInt(2),Kb=BigInt(7),Hb=BigInt(256),Wb=BigInt(113),Bh=[],Ph=[],Th=[];for(let t=0,e=di,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],Bh.push(2*(5*i+r)),Ph.push((t+1)*(t+2)/2%64);let n=zb;for(let s=0;s<7;s++)e=(e<<di^(e>>Kb)*Wb)%Hb,e&Vb&&(n^=di<<(di<<BigInt(s))-di);Th.push(n)}const Rh=hp(Th,!0),Gb=Rh[0],Yb=Rh[1],zc=(t,e,r)=>r>32?up(t,e,r):ap(t,e,r),Vc=(t,e,r)=>r>32?lp(t,e,r):cp(t,e,r);function Zb(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],h=zc(u,l,1)^r[a],f=Vc(u,l,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=f}let n=t[2],s=t[3];for(let o=0;o<24;o++){const a=Ph[o],c=zc(n,s,a),u=Vc(n,s,a),l=Bh[o];n=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=Gb[i],t[1]^=Yb[i]}zl(r)}class fa extends ip{constructor(e,r,i,n=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=n,this.rounds=s,co(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=np(this.state)}clone(){return this._cloneInto()}keccak(){Ka(this.state32),Zb(this.state32,this.rounds),Ka(this.state32),this.posOut=0,this.pos=0}update(e){Ha(this),e=sp(e),Wa(e);const{blockLen:r,state:i}=this,n=e.length;for(let s=0;s<n;){const o=Math.min(r-this.pos,n-s);for(let a=0;a<o;a++)i[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:n}=this;e[i]^=r,(r&128)!==0&&i===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){Ha(this,!1),Wa(e),this.finish();const r=this.state,{blockLen:i}=this;for(let n=0,s=e.length;n<s;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,s-n);e.set(r.subarray(this.posOut,this.posOut+o),n),this.posOut+=o,n+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return co(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(op(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,zl(this.state)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:n,rounds:s,enableXOF:o}=this;return e||(e=new fa(r,i,n,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=i,e.outputLen=n,e.enableXOF=o,e.destroyed=this.destroyed,e}}const Xb=(t,e,r)=>rp(()=>new fa(e,t,r)),Jb=Xb(1,136,256/8);const da=BigInt(0),xo=BigInt(1);function Vi(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function pa(t){if(!Vi(t))throw new Error("Uint8Array expected")}function Ci(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function ln(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Ch(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?da:BigInt("0x"+t)}const Nh=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Qb=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ni(t){if(pa(t),Nh)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=Qb[t[r]];return e}const Nt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Kc(t){if(t>=Nt._0&&t<=Nt._9)return t-Nt._0;if(t>=Nt.A&&t<=Nt.F)return t-(Nt.A-10);if(t>=Nt.a&&t<=Nt.f)return t-(Nt.a-10)}function Pn(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Nh)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let n=0,s=0;n<r;n++,s+=2){const o=Kc(t.charCodeAt(s)),a=Kc(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[n]=o*16+a}return i}function Rr(t){return Ch(Ni(t))}function Uh(t){return pa(t),Ch(Ni(Uint8Array.from(t).reverse()))}function Ki(t,e){return Pn(t.toString(16).padStart(e*2,"0"))}function kh(t,e){return Ki(t,e).reverse()}function ut(t,e,r){let i;if(typeof e=="string")try{i=Pn(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Vi(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=i.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return i}function Tn(...t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];pa(n),e+=n.length}const r=new Uint8Array(e);for(let i=0,n=0;i<t.length;i++){const s=t[i];r.set(s,n),n+=s.length}return r}const Ds=t=>typeof t=="bigint"&&da<=t;function ga(t,e,r){return Ds(t)&&Ds(e)&&Ds(r)&&e<=t&&t<r}function Qr(t,e,r,i){if(!ga(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function em(t){let e;for(e=0;t>da;t>>=xo,e+=1);return e}const Gn=t=>(xo<<BigInt(t))-xo,Os=t=>new Uint8Array(t),Hc=t=>Uint8Array.from(t);function tm(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let i=Os(t),n=Os(t),s=0;const o=()=>{i.fill(1),n.fill(0),s=0},a=(...h)=>r(n,i,...h),c=(h=Os(0))=>{n=a(Hc([0]),h),i=a(),h.length!==0&&(n=a(Hc([1]),h),i=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const f=[];for(;h<e;){i=a();const p=i.slice();f.push(p),h+=i.length}return Tn(...f)};return(h,f)=>{o(),c(h);let p;for(;!(p=f(u()));)c();return o(),p}}const rm={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Vi(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Yn(t,e,r={}){const i=(n,s,o)=>{const a=rm[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[n];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(n)+" is invalid. Expected "+s+", got "+c)};for(const[n,s]of Object.entries(e))i(n,s,!1);for(const[n,s]of Object.entries(r))i(n,s,!0);return t}function Wc(t){const e=new WeakMap;return(r,...i)=>{const n=e.get(r);if(n!==void 0)return n;const s=t(r,...i);return e.set(r,s),s}}function im(t,e){if(Xc(t)>e)throw new Im({givenSize:Xc(t),maxSize:e})}const Ut={zero:48,nine:57,A:65,F:70,a:97,f:102};function Gc(t){if(t>=Ut.zero&&t<=Ut.nine)return t-Ut.zero;if(t>=Ut.A&&t<=Ut.F)return t-(Ut.A-10);if(t>=Ut.a&&t<=Ut.f)return t-(Ut.a-10)}function nm(t,e={}){const{dir:r,size:i=32}=e;if(i===0)return t;if(t.length>i)throw new Sm({size:t.length,targetSize:i,type:"Bytes"});const n=new Uint8Array(i);for(let s=0;s<i;s++){const o=r==="right";n[o?s:i-s-1]=t[o?s:t.length-s-1]}return n}function Lh(t,e){if(yr(t)>e)throw new pm({givenSize:yr(t),maxSize:e})}function sm(t,e){if(typeof e=="number"&&e>0&&e>yr(t)-1)throw new qh({offset:e,position:"start",size:yr(t)})}function om(t,e,r){if(typeof e=="number"&&typeof r=="number"&&yr(t)!==r-e)throw new qh({offset:r,position:"end",size:yr(t)})}function Fh(t,e={}){const{dir:r,size:i=32}=e;if(i===0)return t;const n=t.replace("0x","");if(n.length>i*2)throw new gm({size:Math.ceil(n.length/2),targetSize:i,type:"Hex"});return`0x${n[r==="right"?"padEnd":"padStart"](i*2,"0")}`}const am="#__bigint";function ya(t,e,r){return JSON.stringify(t,(i,n)=>typeof n=="bigint"?n.toString()+am:n,r)}const cm=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function um(t,e={}){const{strict:r=!1}=e;if(!t)throw new Yc(t);if(typeof t!="string")throw new Yc(t);if(r&&!/^0x[0-9a-fA-F]*$/.test(t))throw new Zc(t);if(!t.startsWith("0x"))throw new Zc(t)}function lm(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function wa(t){return t instanceof Uint8Array?Rn(t):Array.isArray(t)?Rn(new Uint8Array(t)):t}function Rn(t,e={}){let r="";for(let n=0;n<t.length;n++)r+=cm[t[n]];const i=`0x${r}`;return typeof e.size=="number"?(Lh(i,e.size),Mh(i,e.size)):i}function As(t,e={}){const{signed:r,size:i}=e,n=BigInt(t);let s;i?r?s=(1n<<BigInt(i)*8n-1n)-1n:s=2n**(BigInt(i)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&r?-s-1n:0;if(s&&n>s||n<o){const u=typeof t=="bigint"?"n":"";throw new dm({max:s?`${s}${u}`:void 0,min:`${o}${u}`,signed:r,size:i,value:`${t}${u}`})}const c=`0x${(r&&n<0?(1n<<BigInt(i*8))+BigInt(n):n).toString(16)}`;return i?hm(c,i):c}function hm(t,e){return Fh(t,{dir:"left",size:e})}function Mh(t,e){return Fh(t,{dir:"right",size:e})}function jt(t,e,r,i={}){const{strict:n}=i;sm(t,e);const s=`0x${t.replace("0x","").slice((e??0)*2,(r??t.length)*2)}`;return n&&om(s,e,r),s}function yr(t){return Math.ceil((t.length-2)/2)}function fm(t,e={}){const{strict:r=!1}=e;try{return um(t,{strict:r}),!0}catch{return!1}}class dm extends ce{constructor({max:e,min:r,signed:i,size:n,value:s}){super(`Number \`${s}\` is not in safe${n?` ${n*8}-bit`:""}${i?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class Yc extends ce{constructor(e){super(`Value \`${typeof e=="object"?ya(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class Zc extends ce{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}let pm=class extends ce{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}};class qh extends ce{constructor({offset:e,position:r,size:i}){super(`Slice ${r==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${i}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}let gm=class extends ce{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};const ym=new TextEncoder;function wm(t){if(!(t instanceof Uint8Array)){if(!t)throw new hn(t);if(typeof t!="object")throw new hn(t);if(!("BYTES_PER_ELEMENT"in t))throw new hn(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new hn(t)}}function bm(t){return t instanceof Uint8Array?t:typeof t=="string"?vm(t):mm(t)}function mm(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function vm(t,e={}){const{size:r}=e;let i=t;r&&(Lh(t,r),i=Mh(t,r));let n=i.slice(2);n.length%2&&(n=`0${n}`);const s=n.length/2,o=new Uint8Array(s);for(let a=0,c=0;a<s;a++){const u=Gc(n.charCodeAt(c++)),l=Gc(n.charCodeAt(c++));if(u===void 0||l===void 0)throw new ce(`Invalid byte sequence ("${n[c-2]}${n[c-1]}" in "${n}").`);o[a]=u*16+l}return o}function Em(t,e={}){const{size:r}=e,i=ym.encode(t);return typeof r=="number"?(im(i,r),xm(i,r)):i}function xm(t,e){return nm(t,{dir:"right",size:e})}function Xc(t){return t.length}function _m(t){try{return wm(t),!0}catch{return!1}}class hn extends ce{constructor(e){super(`Value \`${typeof e=="object"?ya(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class Im extends ce{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class Sm extends ce{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function jh(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,i=Jb(bm(t));return r==="Bytes"?i:Rn(i)}class Dm extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const Om={checksum:new Dm(8192)},$s=Om.checksum;function zh(t,e={}){const{compressed:r}=e,{prefix:i,x:n,y:s}=t;if(r===!1||typeof n=="bigint"&&typeof s=="bigint"){if(i!==4)throw new Jc({prefix:i,cause:new Rm});return}if(r===!0||typeof n=="bigint"&&typeof s>"u"){if(i!==3&&i!==2)throw new Jc({prefix:i,cause:new Tm});return}throw new Pm({publicKey:t})}function Am(t){const e=(()=>{if(fm(t))return Vh(t);if(_m(t))return $m(t);const{prefix:r,x:i,y:n}=t;return typeof i=="bigint"&&typeof n=="bigint"?{prefix:r??4,x:i,y:n}:{prefix:r,x:i}})();return zh(e),e}function $m(t){return Vh(Rn(t))}function Vh(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new Cm({publicKey:t});if(t.length===130){const i=BigInt(jt(t,0,32)),n=BigInt(jt(t,32,64));return{prefix:4,x:i,y:n}}if(t.length===132){const i=Number(jt(t,0,1)),n=BigInt(jt(t,1,33)),s=BigInt(jt(t,33,65));return{prefix:i,x:n,y:s}}const e=Number(jt(t,0,1)),r=BigInt(jt(t,1,33));return{prefix:e,x:r}}function Bm(t,e={}){zh(t);const{prefix:r,x:i,y:n}=t,{includePrefix:s=!0}=e;return lm(s?As(r,{size:1}):"0x",As(i,{size:32}),typeof n=="bigint"?As(n,{size:32}):"0x")}class Pm extends ce{constructor({publicKey:e}){super(`Value \`${ya(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class Jc extends ce{constructor({prefix:e,cause:r}){super(`Prefix "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class Tm extends ce{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class Rm extends ce{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}let Cm=class extends ce{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${yr(wa(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const Nm=/^0x[a-fA-F0-9]{40}$/;function Kh(t,e={}){const{strict:r=!0}=e;if(!Nm.test(t))throw new Qc({address:t,cause:new Lm});if(r){if(t.toLowerCase()===t)return;if(Hh(t)!==t)throw new Qc({address:t,cause:new Fm})}}function Hh(t){if($s.has(t))return $s.get(t);Kh(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=jh(Em(e),{as:"Bytes"}),i=e.split("");for(let s=0;s<40;s+=2)r[s>>1]>>4>=8&&i[s]&&(i[s]=i[s].toUpperCase()),(r[s>>1]&15)>=8&&i[s+1]&&(i[s+1]=i[s+1].toUpperCase());const n=`0x${i.join("")}`;return $s.set(t,n),n}function Um(t,e={}){const{checksum:r=!1}=e;return Kh(t),r?Hh(t):t}function km(t,e={}){const r=jh(`0x${Bm(t).slice(4)}`).substring(26);return Um(`0x${r}`,e)}class Qc extends ce{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class Lm extends ce{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class Fm extends ce{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}const Ye=BigInt(0),Fe=BigInt(1),Ar=BigInt(2),Mm=BigInt(3),Wh=BigInt(4),Gh=BigInt(5),Yh=BigInt(8);function He(t,e){const r=t%e;return r>=Ye?r:e+r}function st(t,e,r){let i=t;for(;e-- >Ye;)i*=i,i%=r;return i}function _o(t,e){if(t===Ye)throw new Error("invert: expected non-zero number");if(e<=Ye)throw new Error("invert: expected positive modulus, got "+e);let r=He(t,e),i=e,n=Ye,s=Fe;for(;r!==Ye;){const a=i/r,c=i%r,u=n-s*a;i=r,r=c,n=s,s=u}if(i!==Fe)throw new Error("invert: does not exist");return He(n,e)}function Zh(t,e){const r=(t.ORDER+Fe)/Wh,i=t.pow(e,r);if(!t.eql(t.sqr(i),e))throw new Error("Cannot find square root");return i}function qm(t,e){const r=(t.ORDER-Gh)/Yh,i=t.mul(e,Ar),n=t.pow(i,r),s=t.mul(e,n),o=t.mul(t.mul(s,Ar),n),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function jm(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Fe,r=0;for(;e%Ar===Ye;)e/=Ar,r++;let i=Ar;const n=ba(t);for(;eu(n,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Zh;let s=n.pow(i,e);const o=(e+Fe)/Ar;return function(c,u){if(c.is0(u))return u;if(eu(c,u)!==1)throw new Error("Cannot find square root");let l=r,h=c.mul(c.ONE,s),f=c.pow(u,e),p=c.pow(u,o);for(;!c.eql(f,c.ONE);){if(c.is0(f))return c.ZERO;let d=1,g=c.sqr(f);for(;!c.eql(g,c.ONE);)if(d++,g=c.sqr(g),d===l)throw new Error("Cannot find square root");const y=Fe<<BigInt(l-d-1),x=c.pow(h,y);l=d,h=c.sqr(x),f=c.mul(f,h),p=c.mul(p,x)}return p}}function zm(t){return t%Wh===Mm?Zh:t%Yh===Gh?qm:jm(t)}const Vm=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Km(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=Vm.reduce((i,n)=>(i[n]="function",i),e);return Yn(t,r)}function Hm(t,e,r){if(r<Ye)throw new Error("invalid exponent, negatives unsupported");if(r===Ye)return t.ONE;if(r===Fe)return e;let i=t.ONE,n=e;for(;r>Ye;)r&Fe&&(i=t.mul(i,n)),n=t.sqr(n),r>>=Fe;return i}function Xh(t,e,r=!1){const i=new Array(e.length).fill(r?t.ZERO:void 0),n=e.reduce((o,a,c)=>t.is0(a)?o:(i[c]=o,t.mul(o,a)),t.ONE),s=t.inv(n);return e.reduceRight((o,a,c)=>t.is0(a)?o:(i[c]=t.mul(o,i[c]),t.mul(o,a)),s),i}function eu(t,e){const r=(t.ORDER-Fe)/Ar,i=t.pow(e,r),n=t.eql(i,t.ONE),s=t.eql(i,t.ZERO),o=t.eql(i,t.neg(t.ONE));if(!n&&!s&&!o)throw new Error("invalid Legendre symbol result");return n?1:s?0:-1}function Jh(t,e){e!==void 0&&co(e);const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function ba(t,e,r=!1,i={}){if(t<=Ye)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:n,nByteLength:s}=Jh(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:n,BYTES:s,MASK:Gn(n),ZERO:Ye,ONE:Fe,create:c=>He(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ye<=c&&c<t},is0:c=>c===Ye,isOdd:c=>(c&Fe)===Fe,neg:c=>He(-c,t),eql:(c,u)=>c===u,sqr:c=>He(c*c,t),add:(c,u)=>He(c+u,t),sub:(c,u)=>He(c-u,t),mul:(c,u)=>He(c*u,t),pow:(c,u)=>Hm(a,c,u),div:(c,u)=>He(c*_o(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>_o(c,t),sqrt:i.sqrt||(c=>(o||(o=zm(t)),o(a,c))),toBytes:c=>r?kh(c,s):Ki(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?Uh(c):Rr(c)},invertBatch:c=>Xh(a,c),cmov:(c,u,l)=>l?u:c});return Object.freeze(a)}function Qh(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function ef(t){const e=Qh(t);return e+Math.ceil(e/2)}function Wm(t,e,r=!1){const i=t.length,n=Qh(e),s=ef(e);if(i<16||i<s||i>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+i);const o=r?Uh(t):Rr(t),a=He(o,e-Fe)+Fe;return r?kh(a,n):Ki(a,n)}const tu=BigInt(0),Io=BigInt(1);function Bs(t,e){const r=e.negate();return t?r:e}function tf(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Ps(t,e){tf(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1),n=2**t,s=Gn(t),o=BigInt(t);return{windows:r,windowSize:i,mask:s,maxNumber:n,shiftBy:o}}function ru(t,e,r){const{windowSize:i,mask:n,maxNumber:s,shiftBy:o}=r;let a=Number(t&n),c=t>>o;a>i&&(a-=s,c+=Io);const u=e*i,l=u+Math.abs(a)-1,h=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:f,isNegF:p,offsetF:u}}function Gm(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function Ym(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const Ts=new WeakMap,rf=new WeakMap;function Rs(t){return rf.get(t)||1}function Zm(t,e){return{constTimeNegate:Bs,hasPrecomputes(r){return Rs(r)!==1},unsafeLadder(r,i,n=t.ZERO){let s=r;for(;i>tu;)i&Io&&(n=n.add(s)),s=s.double(),i>>=Io;return n},precomputeWindow(r,i){const{windows:n,windowSize:s}=Ps(i,e),o=[];let a=r,c=a;for(let u=0;u<n;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,n){let s=t.ZERO,o=t.BASE;const a=Ps(r,e);for(let c=0;c<a.windows;c++){const{nextN:u,offset:l,isZero:h,isNeg:f,isNegF:p,offsetF:d}=ru(n,c,a);n=u,h?o=o.add(Bs(p,i[d])):s=s.add(Bs(f,i[l]))}return{p:s,f:o}},wNAFUnsafe(r,i,n,s=t.ZERO){const o=Ps(r,e);for(let a=0;a<o.windows&&n!==tu;a++){const{nextN:c,offset:u,isZero:l,isNeg:h}=ru(n,a,o);if(n=c,!l){const f=i[u];s=s.add(h?f.negate():f)}}return s},getPrecomputes(r,i,n){let s=Ts.get(i);return s||(s=this.precomputeWindow(i,r),r!==1&&Ts.set(i,n(s))),s},wNAFCached(r,i,n){const s=Rs(r);return this.wNAF(s,this.getPrecomputes(s,r,n),i)},wNAFCachedUnsafe(r,i,n,s){const o=Rs(r);return o===1?this.unsafeLadder(r,i,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,n),i,s)},setWindowSize(r,i){tf(i,e),rf.set(r,i),Ts.delete(r)}}}function Xm(t,e,r,i){Gm(r,t),Ym(i,e);const n=r.length,s=i.length;if(n!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=em(BigInt(n));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=Gn(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let p=h;p>=0;p-=c){l.fill(o);for(let g=0;g<s;g++){const y=i[g],x=Number(y>>BigInt(p)&u);l[x]=l[x].add(r[g])}let d=o;for(let g=l.length-1,y=o;g>0;g--)y=y.add(l[g]),d=d.add(y);if(f=f.add(d),p!==0)for(let g=0;g<c;g++)f=f.double()}return f}function nf(t){return Km(t.Fp),Yn(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Jh(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function iu(t){t.lowS!==void 0&&Ci("lowS",t.lowS),t.prehash!==void 0&&Ci("prehash",t.prehash)}function Jm(t){const e=nf(t);Yn(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:i,a:n}=e;if(r){if(!i.eql(n,i.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class Qm extends Error{constructor(e=""){super(e)}}const zt={Err:Qm,_tlv:{encode:(t,e)=>{const{Err:r}=zt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const i=e.length/2,n=ln(i);if(n.length/2&128)throw new r("tlv.encode: long form length too big");const s=i>127?ln(n.length/2|128):"";return ln(t)+s+n+e},decode(t,e){const{Err:r}=zt;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const n=e[i++],s=!!(n&128);let o=0;if(!s)o=n;else{const c=n&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(i,i+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(i+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=zt;if(t<Ht)throw new e("integer: negative integers are not allowed");let r=ln(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=zt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Rr(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=zt,n=ut("signature",t),{v:s,l:o}=i.decode(48,n);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,s),{v:u,l}=i.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=zt,i=e.encode(2,r.encode(t.r)),n=e.encode(2,r.encode(t.s)),s=i+n;return e.encode(48,s)}};function Cs(t,e){return Ni(Ki(t,e))}const Ht=BigInt(0),_e=BigInt(1);BigInt(2);const Ns=BigInt(3),e1=BigInt(4);function t1(t){const e=Jm(t),{Fp:r}=e,i=ba(e.n,e.nBitLength),n=e.toBytes||((w,b,m)=>{const _=b.toAffine();return Tn(Uint8Array.from([4]),r.toBytes(_.x),r.toBytes(_.y))}),s=e.fromBytes||(w=>{const b=w.subarray(1),m=r.fromBytes(b.subarray(0,r.BYTES)),_=r.fromBytes(b.subarray(r.BYTES,2*r.BYTES));return{x:m,y:_}});function o(w){const{a:b,b:m}=e,_=r.sqr(w),A=r.mul(_,w);return r.add(r.add(A,r.mul(w,b)),m)}function a(w,b){const m=r.sqr(b),_=o(w);return r.eql(m,_)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=r.mul(r.pow(e.a,Ns),e1),u=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,u)))throw new Error("bad curve params: a or b");function l(w){return ga(w,_e,e.n)}function h(w){const{allowedPrivateKeyLengths:b,nByteLength:m,wrapPrivateKey:_,n:A}=e;if(b&&typeof w!="bigint"){if(Vi(w)&&(w=Ni(w)),typeof w!="string"||!b.includes(w.length))throw new Error("invalid private key");w=w.padStart(m*2,"0")}let B;try{B=typeof w=="bigint"?w:Rr(ut("private key",w,m))}catch{throw new Error("invalid private key, expected hex or "+m+" bytes, got "+typeof w)}return _&&(B=He(B,A)),Qr("private key",B,_e,A),B}function f(w){if(!(w instanceof g))throw new Error("ProjectivePoint expected")}const p=Wc((w,b)=>{const{px:m,py:_,pz:A}=w;if(r.eql(A,r.ONE))return{x:m,y:_};const B=w.is0();b==null&&(b=B?r.ONE:r.inv(A));const $=r.mul(m,b),N=r.mul(_,b),U=r.mul(A,b);if(B)return{x:r.ZERO,y:r.ZERO};if(!r.eql(U,r.ONE))throw new Error("invZ was invalid");return{x:$,y:N}}),d=Wc(w=>{if(w.is0()){if(e.allowInfinityPoint&&!r.is0(w.py))return;throw new Error("bad point: ZERO")}const{x:b,y:m}=w.toAffine();if(!r.isValid(b)||!r.isValid(m))throw new Error("bad point: x or y not FE");if(!a(b,m))throw new Error("bad point: equation left != right");if(!w.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class g{constructor(b,m,_){if(b==null||!r.isValid(b))throw new Error("x required");if(m==null||!r.isValid(m)||r.is0(m))throw new Error("y required");if(_==null||!r.isValid(_))throw new Error("z required");this.px=b,this.py=m,this.pz=_,Object.freeze(this)}static fromAffine(b){const{x:m,y:_}=b||{};if(!b||!r.isValid(m)||!r.isValid(_))throw new Error("invalid affine point");if(b instanceof g)throw new Error("projective point not allowed");const A=B=>r.eql(B,r.ZERO);return A(m)&&A(_)?g.ZERO:new g(m,_,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(b){const m=Xh(r,b.map(_=>_.pz));return b.map((_,A)=>_.toAffine(m[A])).map(g.fromAffine)}static fromHex(b){const m=g.fromAffine(s(ut("pointHex",b)));return m.assertValidity(),m}static fromPrivateKey(b){return g.BASE.multiply(h(b))}static msm(b,m){return Xm(g,i,b,m)}_setWindowSize(b){I.setWindowSize(this,b)}assertValidity(){d(this)}hasEvenY(){const{y:b}=this.toAffine();if(r.isOdd)return!r.isOdd(b);throw new Error("Field doesn't support isOdd")}equals(b){f(b);const{px:m,py:_,pz:A}=this,{px:B,py:$,pz:N}=b,U=r.eql(r.mul(m,N),r.mul(B,A)),C=r.eql(r.mul(_,N),r.mul($,A));return U&&C}negate(){return new g(this.px,r.neg(this.py),this.pz)}double(){const{a:b,b:m}=e,_=r.mul(m,Ns),{px:A,py:B,pz:$}=this;let N=r.ZERO,U=r.ZERO,C=r.ZERO,D=r.mul(A,A),T=r.mul(B,B),E=r.mul($,$),v=r.mul(A,B);return v=r.add(v,v),C=r.mul(A,$),C=r.add(C,C),N=r.mul(b,C),U=r.mul(_,E),U=r.add(N,U),N=r.sub(T,U),U=r.add(T,U),U=r.mul(N,U),N=r.mul(v,N),C=r.mul(_,C),E=r.mul(b,E),v=r.sub(D,E),v=r.mul(b,v),v=r.add(v,C),C=r.add(D,D),D=r.add(C,D),D=r.add(D,E),D=r.mul(D,v),U=r.add(U,D),E=r.mul(B,$),E=r.add(E,E),D=r.mul(E,v),N=r.sub(N,D),C=r.mul(E,T),C=r.add(C,C),C=r.add(C,C),new g(N,U,C)}add(b){f(b);const{px:m,py:_,pz:A}=this,{px:B,py:$,pz:N}=b;let U=r.ZERO,C=r.ZERO,D=r.ZERO;const T=e.a,E=r.mul(e.b,Ns);let v=r.mul(m,B),O=r.mul(_,$),R=r.mul(A,N),S=r.add(m,_),P=r.add(B,$);S=r.mul(S,P),P=r.add(v,O),S=r.sub(S,P),P=r.add(m,A);let k=r.add(B,N);return P=r.mul(P,k),k=r.add(v,R),P=r.sub(P,k),k=r.add(_,A),U=r.add($,N),k=r.mul(k,U),U=r.add(O,R),k=r.sub(k,U),D=r.mul(T,P),U=r.mul(E,R),D=r.add(U,D),U=r.sub(O,D),D=r.add(O,D),C=r.mul(U,D),O=r.add(v,v),O=r.add(O,v),R=r.mul(T,R),P=r.mul(E,P),O=r.add(O,R),R=r.sub(v,R),R=r.mul(T,R),P=r.add(P,R),v=r.mul(O,P),C=r.add(C,v),v=r.mul(k,P),U=r.mul(S,U),U=r.sub(U,v),v=r.mul(S,O),D=r.mul(k,D),D=r.add(D,v),new g(U,C,D)}subtract(b){return this.add(b.negate())}is0(){return this.equals(g.ZERO)}wNAF(b){return I.wNAFCached(this,b,g.normalizeZ)}multiplyUnsafe(b){const{endo:m,n:_}=e;Qr("scalar",b,Ht,_);const A=g.ZERO;if(b===Ht)return A;if(this.is0()||b===_e)return this;if(!m||I.hasPrecomputes(this))return I.wNAFCachedUnsafe(this,b,g.normalizeZ);let{k1neg:B,k1:$,k2neg:N,k2:U}=m.splitScalar(b),C=A,D=A,T=this;for(;$>Ht||U>Ht;)$&_e&&(C=C.add(T)),U&_e&&(D=D.add(T)),T=T.double(),$>>=_e,U>>=_e;return B&&(C=C.negate()),N&&(D=D.negate()),D=new g(r.mul(D.px,m.beta),D.py,D.pz),C.add(D)}multiply(b){const{endo:m,n:_}=e;Qr("scalar",b,_e,_);let A,B;if(m){const{k1neg:$,k1:N,k2neg:U,k2:C}=m.splitScalar(b);let{p:D,f:T}=this.wNAF(N),{p:E,f:v}=this.wNAF(C);D=I.constTimeNegate($,D),E=I.constTimeNegate(U,E),E=new g(r.mul(E.px,m.beta),E.py,E.pz),A=D.add(E),B=T.add(v)}else{const{p:$,f:N}=this.wNAF(b);A=$,B=N}return g.normalizeZ([A,B])[0]}multiplyAndAddUnsafe(b,m,_){const A=g.BASE,B=(N,U)=>U===Ht||U===_e||!N.equals(A)?N.multiplyUnsafe(U):N.multiply(U),$=B(this,m).add(B(b,_));return $.is0()?void 0:$}toAffine(b){return p(this,b)}isTorsionFree(){const{h:b,isTorsionFree:m}=e;if(b===_e)return!0;if(m)return m(g,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:b,clearCofactor:m}=e;return b===_e?this:m?m(g,this):this.multiplyUnsafe(e.h)}toRawBytes(b=!0){return Ci("isCompressed",b),this.assertValidity(),n(g,this,b)}toHex(b=!0){return Ci("isCompressed",b),Ni(this.toRawBytes(b))}}g.BASE=new g(e.Gx,e.Gy,r.ONE),g.ZERO=new g(r.ZERO,r.ONE,r.ZERO);const{endo:y,nBitLength:x}=e,I=Zm(g,y?Math.ceil(x/2):x);return{CURVE:e,ProjectivePoint:g,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:l}}function r1(t){const e=nf(t);return Yn(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function i1(t){const e=r1(t),{Fp:r,n:i,nByteLength:n,nBitLength:s}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(E){return He(E,i)}function u(E){return _o(E,i)}const{ProjectivePoint:l,normPrivateKeyToScalar:h,weierstrassEquation:f,isWithinCurveOrder:p}=t1({...e,toBytes(E,v,O){const R=v.toAffine(),S=r.toBytes(R.x),P=Tn;return Ci("isCompressed",O),O?P(Uint8Array.from([v.hasEvenY()?2:3]),S):P(Uint8Array.from([4]),S,r.toBytes(R.y))},fromBytes(E){const v=E.length,O=E[0],R=E.subarray(1);if(v===o&&(O===2||O===3)){const S=Rr(R);if(!ga(S,_e,r.ORDER))throw new Error("Point is not on curve");const P=f(S);let k;try{k=r.sqrt(P)}catch(z){const j=z instanceof Error?": "+z.message:"";throw new Error("Point is not on curve"+j)}const L=(k&_e)===_e;return(O&1)===1!==L&&(k=r.neg(k)),{x:S,y:k}}else if(v===a&&O===4){const S=r.fromBytes(R.subarray(0,r.BYTES)),P=r.fromBytes(R.subarray(r.BYTES,2*r.BYTES));return{x:S,y:P}}else{const S=o,P=a;throw new Error("invalid Point, expected length of "+S+", or uncompressed "+P+", got "+v)}}});function d(E){const v=i>>_e;return E>v}function g(E){return d(E)?c(-E):E}const y=(E,v,O)=>Rr(E.slice(v,O));class x{constructor(v,O,R){Qr("r",v,_e,i),Qr("s",O,_e,i),this.r=v,this.s=O,R!=null&&(this.recovery=R),Object.freeze(this)}static fromCompact(v){const O=n;return v=ut("compactSignature",v,O*2),new x(y(v,0,O),y(v,O,2*O))}static fromDER(v){const{r:O,s:R}=zt.toSig(ut("DER",v));return new x(O,R)}assertValidity(){}addRecoveryBit(v){return new x(this.r,this.s,v)}recoverPublicKey(v){const{r:O,s:R,recovery:S}=this,P=A(ut("msgHash",v));if(S==null||![0,1,2,3].includes(S))throw new Error("recovery id invalid");const k=S===2||S===3?O+e.n:O;if(k>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const L=(S&1)===0?"02":"03",K=l.fromHex(L+Cs(k,r.BYTES)),z=u(k),j=c(-P*z),H=c(R*z),G=l.BASE.multiplyAndAddUnsafe(K,j,H);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new x(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Pn(this.toDERHex())}toDERHex(){return zt.hexFromSig(this)}toCompactRawBytes(){return Pn(this.toCompactHex())}toCompactHex(){const v=n;return Cs(this.r,v)+Cs(this.s,v)}}const I={isValidPrivateKey(E){try{return h(E),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const E=ef(e.n);return Wm(e.randomBytes(E),e.n)},precompute(E=8,v=l.BASE){return v._setWindowSize(E),v.multiply(BigInt(3)),v}};function w(E,v=!0){return l.fromPrivateKey(E).toRawBytes(v)}function b(E){if(typeof E=="bigint")return!1;if(E instanceof l)return!0;const O=ut("key",E).length,R=r.BYTES,S=R+1,P=2*R+1;if(!(e.allowedPrivateKeyLengths||n===S))return O===S||O===P}function m(E,v,O=!0){if(b(E)===!0)throw new Error("first arg must be private key");if(b(v)===!1)throw new Error("second arg must be public key");return l.fromHex(v).multiply(h(E)).toRawBytes(O)}const _=e.bits2int||function(E){if(E.length>8192)throw new Error("input is too large");const v=Rr(E),O=E.length*8-s;return O>0?v>>BigInt(O):v},A=e.bits2int_modN||function(E){return c(_(E))},B=Gn(s);function $(E){return Qr("num < 2^"+s,E,Ht,B),Ki(E,n)}function N(E,v,O=U){if(["recovered","canonical"].some(W=>W in O))throw new Error("sign() legacy options not supported");const{hash:R,randomBytes:S}=e;let{lowS:P,prehash:k,extraEntropy:L}=O;P==null&&(P=!0),E=ut("msgHash",E),iu(O),k&&(E=ut("prehashed msgHash",R(E)));const K=A(E),z=h(v),j=[$(z),$(K)];if(L!=null&&L!==!1){const W=L===!0?S(r.BYTES):L;j.push(ut("extraEntropy",W))}const H=Tn(...j),G=K;function Z(W){const X=_(W);if(!p(X))return;const ue=u(X),ge=l.BASE.multiply(X).toAffine(),me=c(ge.x);if(me===Ht)return;const Le=c(ue*c(G+me*z));if(Le===Ht)return;let xt=(ge.x===me?0:2)|Number(ge.y&_e),en=Le;return P&&d(Le)&&(en=g(Le),xt^=1),new x(me,en,xt)}return{seed:H,k2sig:Z}}const U={lowS:e.lowS,prehash:!1},C={lowS:e.lowS,prehash:!1};function D(E,v,O=U){const{seed:R,k2sig:S}=N(E,v,O),P=e;return tm(P.hash.outputLen,P.nByteLength,P.hmac)(R,S)}l.BASE._setWindowSize(8);function T(E,v,O,R=C){const S=E;v=ut("msgHash",v),O=ut("publicKey",O);const{lowS:P,prehash:k,format:L}=R;if(iu(R),"strict"in R)throw new Error("options.strict was renamed to lowS");if(L!==void 0&&L!=="compact"&&L!=="der")throw new Error("format must be compact or der");const K=typeof S=="string"||Vi(S),z=!K&&!L&&typeof S=="object"&&S!==null&&typeof S.r=="bigint"&&typeof S.s=="bigint";if(!K&&!z)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let j,H;try{if(z&&(j=new x(S.r,S.s)),K){try{L!=="compact"&&(j=x.fromDER(S))}catch(xt){if(!(xt instanceof zt.Err))throw xt}!j&&L!=="der"&&(j=x.fromCompact(S))}H=l.fromHex(O)}catch{return!1}if(!j||P&&j.hasHighS())return!1;k&&(v=e.hash(v));const{r:G,s:Z}=j,W=A(v),X=u(Z),ue=c(W*X),ge=c(G*X),me=l.BASE.multiplyAndAddUnsafe(H,ue,ge)?.toAffine();return me?c(me.x)===G:!1}return{CURVE:e,getPublicKey:w,getSharedSecret:m,sign:D,verify:T,ProjectivePoint:l,Signature:x,utils:I}}function n1(t){return{hash:t,hmac:(e,...r)=>dp(t,e,pp(...r)),randomBytes:fp}}function s1(t,e){const r=i=>i1({...t,...n1(i)});return{...r(e),create:r}}const sf=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),nu=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),o1=BigInt(0),a1=BigInt(1),So=BigInt(2),su=(t,e)=>(t+e/So)/e;function c1(t){const e=sf,r=BigInt(3),i=BigInt(6),n=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=t*t*t%e,l=u*u*t%e,h=st(l,r,e)*l%e,f=st(h,r,e)*l%e,p=st(f,So,e)*u%e,d=st(p,n,e)*p%e,g=st(d,s,e)*d%e,y=st(g,a,e)*g%e,x=st(y,c,e)*y%e,I=st(x,a,e)*g%e,w=st(I,r,e)*l%e,b=st(w,o,e)*d%e,m=st(b,i,e)*u%e,_=st(m,So,e);if(!Do.eql(Do.sqr(_),t))throw new Error("Cannot find square root");return _}const Do=ba(sf,void 0,void 0,{sqrt:c1}),u1=s1({a:o1,b:BigInt(7),Fp:Do,n:nu,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=nu,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-a1*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),n=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=su(s*t,e),c=su(-i*t,e);let u=He(t-a*r-c*n,e),l=He(-a*i-c*s,e);const h=u>o,f=l>o;if(h&&(u=e-u),f&&(l=e-l),u>o||l>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:u,k2neg:f,k2:l}}}},gp);function l1(t){if(t.length!==130&&t.length!==132)throw new f1({signature:t});const e=BigInt(jt(t,0,32)),r=BigInt(jt(t,32,64)),i=(()=>{const n=+`0x${t.slice(130)}`;if(!Number.isNaN(n))try{return h1(n)}catch{throw new d1({value:n})}})();return typeof i>"u"?{r:e,s:r}:{r:e,s:r,yParity:i}}function h1(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new p1({value:t})}class f1 extends ce{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${yr(wa(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class d1 extends ce{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class p1 extends ce{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}function g1(t){return km(y1(t))}function y1(t){const{payload:e,signature:r}=t,{r:i,s:n,yParity:s}=r,a=new u1.Signature(BigInt(i),BigInt(n)).addRecoveryBit(s).recoverPublicKey(wa(e).substring(2));return Am(a)}function w1(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<t.length;u++){const l=t.charAt(u),h=l.charCodeAt(0);if(e[h]!==255)throw new TypeError(l+" is ambiguous");e[h]=u}const r=t.length,i=t.charAt(0),n=Math.log(r)/Math.log(256),s=Math.log(256)/Math.log(r);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let l=0,h=0,f=0;const p=u.length;for(;f!==p&&u[f]===0;)f++,l++;const d=(p-f)*s+1>>>0,g=new Uint8Array(d);for(;f!==p;){let I=u[f],w=0;for(let b=d-1;(I!==0||w<h)&&b!==-1;b--,w++)I+=256*g[b]>>>0,g[b]=I%r>>>0,I=I/r>>>0;if(I!==0)throw new Error("Non-zero carry");h=w,f++}let y=d-h;for(;y!==d&&g[y]===0;)y++;let x=i.repeat(l);for(;y<d;++y)x+=t.charAt(g[y]);return x}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let l=0,h=0,f=0;for(;u[l]===i;)h++,l++;const p=(u.length-l)*n+1>>>0,d=new Uint8Array(p);for(;l<u.length;){const I=u.charCodeAt(l);if(I>255)return;let w=e[I];if(w===255)return;let b=0;for(let m=p-1;(w!==0||b<f)&&m!==-1;m--,b++)w+=r*d[m]>>>0,d[m]=w%256>>>0,w=w/256>>>0;if(w!==0)throw new Error("Non-zero carry");f=b,l++}let g=p-f;for(;g!==p&&d[g]===0;)g++;const y=new Uint8Array(h+(p-g));let x=h;for(;g!==p;)y[x++]=d[g++];return y}function c(u){const l=a(u);if(l)return l;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var b1="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const Hi=w1(b1);function m1(t){const e=t.length;let r=0,i=0;for(;i<e;){let n=t.charCodeAt(i++);if((n&4294967168)===0){r++;continue}else if((n&4294965248)===0)r+=2;else{if(n>=55296&&n<=56319&&i<e){const s=t.charCodeAt(i);(s&64512)===56320&&(++i,n=((n&1023)<<10)+(s&1023)+65536)}(n&4294901760)===0?r+=3:r+=4}}return r}function v1(t,e,r){const i=t.length;let n=r,s=0;for(;s<i;){let o=t.charCodeAt(s++);if((o&4294967168)===0){e[n++]=o;continue}else if((o&4294965248)===0)e[n++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<i){const a=t.charCodeAt(s);(a&64512)===56320&&(++s,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[n++]=o>>12&15|224,e[n++]=o>>6&63|128):(e[n++]=o>>18&7|240,e[n++]=o>>12&63|128,e[n++]=o>>6&63|128)}e[n++]=o&63|128}}const E1=new TextEncoder,x1=50;function _1(t,e,r){E1.encodeInto(t,e.subarray(r))}function I1(t,e,r){t.length>x1?_1(t,e,r):v1(t,e,r)}const S1=4096;function of(t,e,r){let i=e;const n=i+r,s=[];let o="";for(;i<n;){const a=t[i++];if((a&128)===0)s.push(a);else if((a&224)===192){const c=t[i++]&63;s.push((a&31)<<6|c)}else if((a&240)===224){const c=t[i++]&63,u=t[i++]&63;s.push((a&31)<<12|c<<6|u)}else if((a&248)===240){const c=t[i++]&63,u=t[i++]&63,l=t[i++]&63;let h=(a&7)<<18|c<<12|u<<6|l;h>65535&&(h-=65536,s.push(h>>>10&1023|55296),h=56320|h&1023),s.push(h)}else s.push(a);s.length>=S1&&(o+=String.fromCharCode(...s),s.length=0)}return s.length>0&&(o+=String.fromCharCode(...s)),o}const D1=new TextDecoder,O1=200;function A1(t,e,r){const i=t.subarray(e,e+r);return D1.decode(i)}function $1(t,e,r){return r>O1?A1(t,e,r):of(t,e,r)}class fn{constructor(e,r){this.type=e,this.data=r}}class tt extends Error{constructor(e){super(e);const r=Object.create(tt.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:tt.name})}}const pi=4294967295;function B1(t,e,r){const i=r/4294967296,n=r;t.setUint32(e,i),t.setUint32(e+4,n)}function af(t,e,r){const i=Math.floor(r/4294967296),n=r;t.setUint32(e,i),t.setUint32(e+4,n)}function cf(t,e){const r=t.getInt32(e),i=t.getUint32(e+4);return r*4294967296+i}function P1(t,e){const r=t.getUint32(e),i=t.getUint32(e+4);return r*4294967296+i}const T1=-1,R1=4294967296-1,C1=17179869184-1;function N1({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=C1)if(e===0&&t<=R1){const r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{const r=t/4294967296,i=t&4294967295,n=new Uint8Array(8),s=new DataView(n.buffer);return s.setUint32(0,e<<2|r&3),s.setUint32(4,i),n}else{const r=new Uint8Array(12),i=new DataView(r.buffer);return i.setUint32(0,e),af(i,4,t),r}}function U1(t){const e=t.getTime(),r=Math.floor(e/1e3),i=(e-r*1e3)*1e6,n=Math.floor(i/1e9);return{sec:r+n,nsec:i-n*1e9}}function k1(t){if(t instanceof Date){const e=U1(t);return N1(e)}else return null}function L1(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const r=e.getUint32(0),i=e.getUint32(4),n=(r&3)*4294967296+i,s=r>>>2;return{sec:n,nsec:s}}case 12:{const r=cf(e,4),i=e.getUint32(0);return{sec:r,nsec:i}}default:throw new tt(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function F1(t){const e=L1(t);return new Date(e.sec*1e3+e.nsec/1e6)}const M1={type:T1,encode:k1,decode:F1};class Cn{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(M1)}register({type:e,encode:r,decode:i}){if(e>=0)this.encoders[e]=r,this.decoders[e]=i;else{const n=-1-e;this.builtInEncoders[n]=r,this.builtInDecoders[n]=i}}tryToEncode(e,r){for(let i=0;i<this.builtInEncoders.length;i++){const n=this.builtInEncoders[i];if(n!=null){const s=n(e,r);if(s!=null){const o=-1-i;return new fn(o,s)}}}for(let i=0;i<this.encoders.length;i++){const n=this.encoders[i];if(n!=null){const s=n(e,r);if(s!=null){const o=i;return new fn(o,s)}}}return e instanceof fn?e:null}decode(e,r,i){const n=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return n?n(e,r,i):new fn(r,e)}}Cn.defaultCodec=new Cn;function q1(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function Oo(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):q1(t)?new Uint8Array(t):Uint8Array.from(t)}const j1=100,z1=2048;let V1=class uf{constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??Cn.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??j1,this.initialBufferSize=e?.initialBufferSize??z1,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new uf({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){const r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){const r=new ArrayBuffer(e),i=new Uint8Array(r),n=new DataView(r);i.set(this.bytes),this.view=n,this.bytes=i}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const i=m1(e);this.ensureBufferSizeToWrite(5+i),this.writeStringHeader(i),I1(e,this.bytes,this.pos),this.pos+=i}encodeObject(e,r){const i=this.extensionCodec.tryToEncode(e,this.context);if(i!=null)this.encodeExtension(i);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);const i=Oo(e);this.writeU8a(i)}encodeArray(e,r){const i=e.length;if(i<16)this.writeU8(144+i);else if(i<65536)this.writeU8(220),this.writeU16(i);else if(i<4294967296)this.writeU8(221),this.writeU32(i);else throw new Error(`Too large array: ${i}`);for(const n of e)this.doEncode(n,r+1)}countWithoutUndefined(e,r){let i=0;for(const n of r)e[n]!==void 0&&i++;return i}encodeMap(e,r){const i=Object.keys(e);this.sortKeys&&i.sort();const n=this.ignoreUndefined?this.countWithoutUndefined(e,i):i.length;if(n<16)this.writeU8(128+n);else if(n<65536)this.writeU8(222),this.writeU16(n);else if(n<4294967296)this.writeU8(223),this.writeU32(n);else throw new Error(`Too large map object: ${n}`);for(const s of i){const o=e[s];this.ignoreUndefined&&o===void 0||(this.encodeString(s),this.doEncode(o,r+1))}}encodeExtension(e){if(typeof e.data=="function"){const i=e.data(this.pos+6),n=i.length;if(n>=4294967296)throw new Error(`Too large extension object: ${n}`);this.writeU8(201),this.writeU32(n),this.writeI8(e.type),this.writeU8a(i);return}const r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),B1(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),af(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function K1(t,e){return new V1(e).encodeSharedRef(t)}function Us(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const H1=16,W1=16;class G1{constructor(e=H1,r=W1){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=r,this.caches=[];for(let i=0;i<this.maxKeyLength;i++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,r,i){const n=this.caches[i-1];e:for(const s of n){const o=s.bytes;for(let a=0;a<i;a++)if(o[a]!==e[r+a])continue e;return s.str}return null}store(e,r){const i=this.caches[e.length-1],n={bytes:e,str:r};i.length>=this.maxLengthPerKey?i[Math.random()*i.length|0]=n:i.push(n)}decode(e,r,i){const n=this.find(e,r,i);if(n!=null)return this.hit++,n;this.miss++;const s=of(e,r,i),o=Uint8Array.prototype.slice.call(e,r,r+i);return this.store(o,s),s}}const Ao="array",Di="map_key",lf="map_value",Y1=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new tt("The type of key must be string or number but "+typeof t)};class Z1{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const r=this.getUninitializedStateFromPool();r.type=Ao,r.position=0,r.size=e,r.array=new Array(e)}pushMapState(e){const r=this.getUninitializedStateFromPool();r.type=Di,r.readCount=0,r.size=e,r.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===Ao){const i=e;i.size=0,i.array=void 0,i.position=0,i.type=void 0}if(e.type===Di||e.type===lf){const i=e;i.size=0,i.map=void 0,i.readCount=0,i.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const gi=-1,ma=new DataView(new ArrayBuffer(0)),X1=new Uint8Array(ma.buffer);try{ma.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const ou=new RangeError("Insufficient data"),J1=new G1;let Q1=class hf{constructor(e){this.totalPos=0,this.pos=0,this.view=ma,this.bytes=X1,this.headByte=gi,this.stack=new Z1,this.entered=!1,this.extensionCodec=e?.extensionCodec??Cn.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??pi,this.maxBinLength=e?.maxBinLength??pi,this.maxArrayLength=e?.maxArrayLength??pi,this.maxMapLength=e?.maxMapLength??pi,this.maxExtLength=e?.maxExtLength??pi,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:J1,this.mapKeyConverter=e?.mapKeyConverter??Y1}clone(){return new hf({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=gi,this.stack.reset()}setBuffer(e){const r=Oo(e);this.bytes=r,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===gi&&!this.hasRemaining(1))this.setBuffer(e);else{const r=this.bytes.subarray(this.pos),i=Oo(e),n=new Uint8Array(r.length+i.length);n.set(r),n.set(i,r.length),this.setBuffer(n)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:r,pos:i}=this;return new RangeError(`Extra ${r.byteLength-i} of ${r.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const r=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return r}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let r=!1,i;for await(const a of e){if(r)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{i=this.doDecodeSync(),r=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(r){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return i}const{headByte:n,pos:s,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${Us(n)} at ${o} (${s} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,r){if(this.entered){yield*this.clone().decodeMultiAsync(e,r);return}try{this.entered=!0;let i=r,n=-1;for await(const s of e){if(r&&n===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),i&&(n=this.readArraySize(),i=!1,this.complete());try{for(;yield this.doDecodeSync(),--n!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let r;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){const n=e-128;if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e<160){const n=e-144;if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else{const n=e-160;r=this.decodeString(n,0)}else if(e===192)r=null;else if(e===194)r=!1;else if(e===195)r=!0;else if(e===202)r=this.readF32();else if(e===203)r=this.readF64();else if(e===204)r=this.readU8();else if(e===205)r=this.readU16();else if(e===206)r=this.readU32();else if(e===207)this.useBigInt64?r=this.readU64AsBigInt():r=this.readU64();else if(e===208)r=this.readI8();else if(e===209)r=this.readI16();else if(e===210)r=this.readI32();else if(e===211)this.useBigInt64?r=this.readI64AsBigInt():r=this.readI64();else if(e===217){const n=this.lookU8();r=this.decodeString(n,1)}else if(e===218){const n=this.lookU16();r=this.decodeString(n,2)}else if(e===219){const n=this.lookU32();r=this.decodeString(n,4)}else if(e===220){const n=this.readU16();if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else if(e===221){const n=this.readU32();if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else if(e===222){const n=this.readU16();if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e===223){const n=this.readU32();if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e===196){const n=this.lookU8();r=this.decodeBinary(n,1)}else if(e===197){const n=this.lookU16();r=this.decodeBinary(n,2)}else if(e===198){const n=this.lookU32();r=this.decodeBinary(n,4)}else if(e===212)r=this.decodeExtension(1,0);else if(e===213)r=this.decodeExtension(2,0);else if(e===214)r=this.decodeExtension(4,0);else if(e===215)r=this.decodeExtension(8,0);else if(e===216)r=this.decodeExtension(16,0);else if(e===199){const n=this.lookU8();r=this.decodeExtension(n,1)}else if(e===200){const n=this.lookU16();r=this.decodeExtension(n,2)}else if(e===201){const n=this.lookU32();r=this.decodeExtension(n,4)}else throw new tt(`Unrecognized type byte: ${Us(e)}`);this.complete();const i=this.stack;for(;i.length>0;){const n=i.top();if(n.type===Ao)if(n.array[n.position]=r,n.position++,n.position===n.size)r=n.array,i.release(n);else continue e;else if(n.type===Di){if(r==="__proto__")throw new tt("The key __proto__ is not allowed");n.key=this.mapKeyConverter(r),n.type=lf;continue e}else if(n.map[n.key]=r,n.readCount++,n.readCount===n.size)r=n.map,i.release(n);else{n.key=null,n.type=Di;continue e}}return r}}readHeadByte(){return this.headByte===gi&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=gi}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new tt(`Unrecognized array type byte: ${Us(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new tt(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new tt(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,r){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,r):this.decodeBinary(e,r)}decodeUtf8String(e,r){if(e>this.maxStrLength)throw new tt(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+r+e)throw ou;const i=this.pos+r;let n;return this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?n=this.keyDecoder.decode(this.bytes,i,e):n=$1(this.bytes,i,e),this.pos+=r+e,n}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===Di:!1}decodeBinary(e,r){if(e>this.maxBinLength)throw new tt(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+r))throw ou;const i=this.pos+r,n=this.bytes.subarray(i,i+e);return this.pos+=r+e,n}decodeExtension(e,r){if(e>this.maxExtLength)throw new tt(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const i=this.view.getInt8(this.pos+r),n=this.decodeBinary(e,r+1);return this.extensionCodec.decode(n,i,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=P1(this.view,this.pos);return this.pos+=8,e}readI64(){const e=cf(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function ev(t,e){return new Q1(e).decode(t)}function va(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function ff(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?va(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Oi(t,e){e||(e=t.reduce((n,s)=>n+s.length,0));const r=ff(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return va(r)}function tv(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,y=0,x=0,I=d.length;x!==I&&d[x]===0;)x++,g++;for(var w=(I-x)*l+1>>>0,b=new Uint8Array(w);x!==I;){for(var m=d[x],_=0,A=w-1;(m!==0||_<y)&&A!==-1;A--,_++)m+=256*b[A]>>>0,b[A]=m%a>>>0,m=m/a>>>0;if(m!==0)throw new Error("Non-zero carry");y=_,x++}for(var B=w-y;B!==w&&b[B]===0;)B++;for(var $=c.repeat(g);B<w;++B)$+=t.charAt(b[B]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var y=0,x=0;d[g]===c;)y++,g++;for(var I=(d.length-g)*u+1>>>0,w=new Uint8Array(I);d[g];){var b=r[d.charCodeAt(g)];if(b===255)return;for(var m=0,_=I-1;(b!==0||m<x)&&_!==-1;_--,m++)b+=a*w[_]>>>0,w[_]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");x=m,g++}if(d[g]!==" "){for(var A=I-x;A!==I&&w[A]===0;)A++;for(var B=new Uint8Array(y+(I-A)),$=y;A!==I;)B[$++]=w[A++];return B}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var rv=tv,iv=rv;const nv=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},sv=t=>new TextEncoder().encode(t),ov=t=>new TextDecoder().decode(t);class av{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class cv{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return df(this,e)}}class uv{constructor(e){this.decoders=e}or(e){return df(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const df=(t,e)=>new uv({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class lv{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new av(e,r,i),this.decoder=new cv(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Zn=({name:t,prefix:e,encode:r,decode:i})=>new lv(t,e,r,i),Wi=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=iv(r,e);return Zn({prefix:t,name:e,encode:i,decode:s=>nv(n(s))})},hv=(t,e,r,i)=>{const n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=n[t[l]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},fv=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[n&a>>o];if(o&&(s+=e[n&a<<r-o]),i)for(;s.length*r&7;)s+="=";return s},Pe=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Zn({prefix:e,name:t,encode(n){return fv(n,i,r)},decode(n){return hv(n,i,r,t)}}),dv=Zn({prefix:"\0",name:"identity",encode:t=>ov(t),decode:t=>sv(t)}),pv=Object.freeze(Object.defineProperty({__proto__:null,identity:dv},Symbol.toStringTag,{value:"Module"})),gv=Pe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),yv=Object.freeze(Object.defineProperty({__proto__:null,base2:gv},Symbol.toStringTag,{value:"Module"})),wv=Pe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),bv=Object.freeze(Object.defineProperty({__proto__:null,base8:wv},Symbol.toStringTag,{value:"Module"})),mv=Wi({prefix:"9",name:"base10",alphabet:"0123456789"}),vv=Object.freeze(Object.defineProperty({__proto__:null,base10:mv},Symbol.toStringTag,{value:"Module"})),Ev=Pe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),xv=Pe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),_v=Object.freeze(Object.defineProperty({__proto__:null,base16:Ev,base16upper:xv},Symbol.toStringTag,{value:"Module"})),Iv=Pe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Sv=Pe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Dv=Pe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ov=Pe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Av=Pe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),$v=Pe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Bv=Pe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Pv=Pe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Tv=Pe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Rv=Object.freeze(Object.defineProperty({__proto__:null,base32:Iv,base32hex:Av,base32hexpad:Bv,base32hexpadupper:Pv,base32hexupper:$v,base32pad:Dv,base32padupper:Ov,base32upper:Sv,base32z:Tv},Symbol.toStringTag,{value:"Module"})),Cv=Wi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Nv=Wi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Uv=Object.freeze(Object.defineProperty({__proto__:null,base36:Cv,base36upper:Nv},Symbol.toStringTag,{value:"Module"})),kv=Wi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Lv=Wi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Fv=Object.freeze(Object.defineProperty({__proto__:null,base58btc:kv,base58flickr:Lv},Symbol.toStringTag,{value:"Module"})),Mv=Pe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),qv=Pe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),jv=Pe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),zv=Pe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Vv=Object.freeze(Object.defineProperty({__proto__:null,base64:Mv,base64pad:qv,base64url:jv,base64urlpad:zv},Symbol.toStringTag,{value:"Module"})),pf=Array.from(""),Kv=pf.reduce((t,e,r)=>(t[r]=e,t),[]),Hv=pf.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Wv(t){return t.reduce((e,r)=>(e+=Kv[r],e),"")}function Gv(t){const e=[];for(const r of t){const i=Hv[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Yv=Zn({prefix:"",name:"base256emoji",encode:Wv,decode:Gv}),Zv=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Yv},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const au={...pv,...yv,...bv,...vv,..._v,...Rv,...Uv,...Fv,...Vv,...Zv};function gf(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const cu=gf("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),ks=gf("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=ff(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),yf={utf8:cu,"utf-8":cu,hex:au.base16,latin1:ks,ascii:ks,binary:ks,...au};function ft(t,e="utf8"){const r=yf[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?va(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Xe(t,e="utf8"){const r=yf[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const Xv={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var Ls,uu;function wf(){if(uu)return Ls;uu=1;const t="Input must be an string, Buffer or Uint8Array";function e(o){let a;if(o instanceof Uint8Array)a=o;else if(typeof o=="string")a=new TextEncoder().encode(o);else throw new Error(t);return a}function r(o){return Array.prototype.map.call(o,function(a){return(a<16?"0":"")+a.toString(16)}).join("")}function i(o){return(4294967296+o).toString(16).substring(1)}function n(o,a,c){let u=`
`+o+" = ";for(let l=0;l<a.length;l+=2){if(c===32)u+=i(a[l]).toUpperCase(),u+=" ",u+=i(a[l+1]).toUpperCase();else if(c===64)u+=i(a[l+1]).toUpperCase(),u+=i(a[l]).toUpperCase();else throw new Error("Invalid size "+c);l%6===4?u+=`
`+new Array(o.length+4).join(" "):l<a.length-2&&(u+=" ")}console.log(u)}function s(o,a,c){let u=new Date().getTime();const l=new Uint8Array(a);for(let f=0;f<a;f++)l[f]=f%256;const h=new Date().getTime();console.log("Generated random input in "+(h-u)+"ms"),u=h;for(let f=0;f<c;f++){const p=o(l),d=new Date().getTime(),g=d-u;u=d,console.log("Hashed in "+g+"ms: "+p.substring(0,20)+"..."),console.log(Math.round(a/(1<<20)/(g/1e3)*100)/100+" MB PER SECOND")}}return Ls={normalizeInput:e,toHex:r,debugPrint:n,testSpeed:s},Ls}var Fs,lu;function Jv(){if(lu)return Fs;lu=1;const t=wf();function e(x,I,w){const b=x[I]+x[w];let m=x[I+1]+x[w+1];b>=4294967296&&m++,x[I]=b,x[I+1]=m}function r(x,I,w,b){let m=x[I]+w;w<0&&(m+=4294967296);let _=x[I+1]+b;m>=4294967296&&_++,x[I]=m,x[I+1]=_}function i(x,I){return x[I]^x[I+1]<<8^x[I+2]<<16^x[I+3]<<24}function n(x,I,w,b,m,_){const A=u[m],B=u[m+1],$=u[_],N=u[_+1];e(c,x,I),r(c,x,A,B);let U=c[b]^c[x],C=c[b+1]^c[x+1];c[b]=C,c[b+1]=U,e(c,w,b),U=c[I]^c[w],C=c[I+1]^c[w+1],c[I]=U>>>24^C<<8,c[I+1]=C>>>24^U<<8,e(c,x,I),r(c,x,$,N),U=c[b]^c[x],C=c[b+1]^c[x+1],c[b]=U>>>16^C<<16,c[b+1]=C>>>16^U<<16,e(c,w,b),U=c[I]^c[w],C=c[I+1]^c[w+1],c[I]=C>>>31^U<<1,c[I+1]=U>>>31^C<<1}const s=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],a=new Uint8Array(o.map(function(x){return x*2})),c=new Uint32Array(32),u=new Uint32Array(32);function l(x,I){let w=0;for(w=0;w<16;w++)c[w]=x.h[w],c[w+16]=s[w];for(c[24]=c[24]^x.t,c[25]=c[25]^x.t/4294967296,I&&(c[28]=~c[28],c[29]=~c[29]),w=0;w<32;w++)u[w]=i(x.b,4*w);for(w=0;w<12;w++)n(0,8,16,24,a[w*16+0],a[w*16+1]),n(2,10,18,26,a[w*16+2],a[w*16+3]),n(4,12,20,28,a[w*16+4],a[w*16+5]),n(6,14,22,30,a[w*16+6],a[w*16+7]),n(0,10,20,30,a[w*16+8],a[w*16+9]),n(2,12,22,24,a[w*16+10],a[w*16+11]),n(4,14,16,26,a[w*16+12],a[w*16+13]),n(6,8,18,28,a[w*16+14],a[w*16+15]);for(w=0;w<16;w++)x.h[w]=x.h[w]^c[w]^c[w+16]}const h=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function f(x,I,w,b){if(x===0||x>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(I&&I.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(w&&w.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(b&&b.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const m={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:x};h.fill(0),h[0]=x,I&&(h[1]=I.length),h[2]=1,h[3]=1,w&&h.set(w,32),b&&h.set(b,48);for(let _=0;_<16;_++)m.h[_]=s[_]^i(h,_*4);return I&&(p(m,I),m.c=128),m}function p(x,I){for(let w=0;w<I.length;w++)x.c===128&&(x.t+=x.c,l(x,!1),x.c=0),x.b[x.c++]=I[w]}function d(x){for(x.t+=x.c;x.c<128;)x.b[x.c++]=0;l(x,!0);const I=new Uint8Array(x.outlen);for(let w=0;w<x.outlen;w++)I[w]=x.h[w>>2]>>8*(w&3);return I}function g(x,I,w,b,m){w=w||64,x=t.normalizeInput(x),b&&(b=t.normalizeInput(b)),m&&(m=t.normalizeInput(m));const _=f(w,I,b,m);return p(_,x),d(_)}function y(x,I,w,b,m){const _=g(x,I,w,b,m);return t.toHex(_)}return Fs={blake2b:g,blake2bHex:y,blake2bInit:f,blake2bUpdate:p,blake2bFinal:d},Fs}var Ms,hu;function Qv(){if(hu)return Ms;hu=1;const t=wf();function e(d,g){return d[g]^d[g+1]<<8^d[g+2]<<16^d[g+3]<<24}function r(d,g,y,x,I,w){o[d]=o[d]+o[g]+I,o[x]=i(o[x]^o[d],16),o[y]=o[y]+o[x],o[g]=i(o[g]^o[y],12),o[d]=o[d]+o[g]+w,o[x]=i(o[x]^o[d],8),o[y]=o[y]+o[x],o[g]=i(o[g]^o[y],7)}function i(d,g){return d>>>g^d<<32-g}const n=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),s=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),o=new Uint32Array(16),a=new Uint32Array(16);function c(d,g){let y=0;for(y=0;y<8;y++)o[y]=d.h[y],o[y+8]=n[y];for(o[12]^=d.t,o[13]^=d.t/4294967296,g&&(o[14]=~o[14]),y=0;y<16;y++)a[y]=e(d.b,4*y);for(y=0;y<10;y++)r(0,4,8,12,a[s[y*16+0]],a[s[y*16+1]]),r(1,5,9,13,a[s[y*16+2]],a[s[y*16+3]]),r(2,6,10,14,a[s[y*16+4]],a[s[y*16+5]]),r(3,7,11,15,a[s[y*16+6]],a[s[y*16+7]]),r(0,5,10,15,a[s[y*16+8]],a[s[y*16+9]]),r(1,6,11,12,a[s[y*16+10]],a[s[y*16+11]]),r(2,7,8,13,a[s[y*16+12]],a[s[y*16+13]]),r(3,4,9,14,a[s[y*16+14]],a[s[y*16+15]]);for(y=0;y<8;y++)d.h[y]^=o[y]^o[y+8]}function u(d,g){if(!(d>0&&d<=32))throw new Error("Incorrect output length, should be in [1, 32]");const y=g?g.length:0;if(g&&!(y>0&&y<=32))throw new Error("Incorrect key length, should be in [1, 32]");const x={h:new Uint32Array(n),b:new Uint8Array(64),c:0,t:0,outlen:d};return x.h[0]^=16842752^y<<8^d,y>0&&(l(x,g),x.c=64),x}function l(d,g){for(let y=0;y<g.length;y++)d.c===64&&(d.t+=d.c,c(d,!1),d.c=0),d.b[d.c++]=g[y]}function h(d){for(d.t+=d.c;d.c<64;)d.b[d.c++]=0;c(d,!0);const g=new Uint8Array(d.outlen);for(let y=0;y<d.outlen;y++)g[y]=d.h[y>>2]>>8*(y&3)&255;return g}function f(d,g,y){y=y||32,d=t.normalizeInput(d);const x=u(y,g);return l(x,d),h(x)}function p(d,g,y){const x=f(d,g,y);return t.toHex(x)}return Ms={blake2s:f,blake2sHex:p,blake2sInit:u,blake2sUpdate:l,blake2sFinal:h},Ms}var qs,fu;function e2(){if(fu)return qs;fu=1;const t=Jv(),e=Qv();return qs={blake2b:t.blake2b,blake2bHex:t.blake2bHex,blake2bInit:t.blake2bInit,blake2bUpdate:t.blake2bUpdate,blake2bFinal:t.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal},qs}var t2=e2(),r2={};const i2=":";function xn(t){const[e,r]=t.split(i2);return{namespace:e,reference:r}}function bf(t,e){return t.includes(":")?[t]:e.chains||[]}var n2=Object.defineProperty,s2=Object.defineProperties,o2=Object.getOwnPropertyDescriptors,du=Object.getOwnPropertySymbols,a2=Object.prototype.hasOwnProperty,c2=Object.prototype.propertyIsEnumerable,$o=(t,e,r)=>e in t?n2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,pu=(t,e)=>{for(var r in e||(e={}))a2.call(e,r)&&$o(t,r,e[r]);if(du)for(var r of du(e))c2.call(e,r)&&$o(t,r,e[r]);return t},u2=(t,e)=>s2(t,o2(e)),gu=(t,e,r)=>$o(t,typeof e!="symbol"?e+"":e,r);const l2="ReactNative",it={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},h2="js";function Nn(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function br(){return!Zt.getDocument()&&!!Zt.getNavigator()&&navigator.product===l2}function f2(){return br()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function d2(){return br()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function ai(){return!Nn()&&!!Zt.getNavigator()&&!!Zt.getDocument()}function Gi(){return br()?it.reactNative:Nn()?it.node:ai()?it.browser:it.unknown}function yu(){var t;try{return br()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function p2(t,e){const r=new URLSearchParams(t);return Object.entries(e).sort(([i],[n])=>i.localeCompare(n)).forEach(([i,n])=>{n!=null&&r.set(i,String(n))}),r.toString()}function g2(t){var e,r;const i=mf();try{return t!=null&&t.url&&i.url&&new URL(t.url).host!==new URL(i.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),t.url=i.url),(e=t?.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(n=>n!=="")),u2(pu(pu({},i),t),{url:t?.url||i.url,name:t?.name||i.name,description:t?.description||i.description,icons:(r=t?.icons)!=null&&r.length&&t.icons.length>0?t.icons:i.icons})}catch(n){return console.warn("Error populating app metadata",n),t||i}}function mf(){return Mb.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function y2(){if(Gi()===it.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:i}=global.Platform;return[r,i].join("-")}const t=Rb();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function w2(){var t;const e=Gi();return e===it.browser?[e,((t=Zt.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function vf(t,e,r){const i=y2(),n=w2();return[[t,e].join("-"),[h2,r].join("-"),i,n].join("/")}function b2({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:n,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const u=r.split("?"),l=vf(t,e,i),h={auth:n,ua:l,projectId:s,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},f=p2(u[1]||"",h);return u[0]+"?"+f}function $r(t,e){return t.filter(r=>e.includes(r)).length===t.length}function Bo(t){return Object.fromEntries(t.entries())}function Po(t){return new Map(Object.entries(t))}function Sr(t=M.FIVE_MINUTES,e){const r=M.toMiliseconds(t||M.FIVE_MINUTES);let i,n,s,o;return{resolve:a=>{s&&i&&(clearTimeout(s),i(a),o=Promise.resolve(a))},reject:a=>{s&&n&&(clearTimeout(s),n(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const u=new Error(e);o=Promise.reject(u),c(u)},r),i=a,n=c})}}function Pt(t,e,r){return new Promise(async(i,n)=>{const s=setTimeout(()=>n(new Error(r)),e);try{const o=await t;i(o)}catch(o){n(o)}clearTimeout(s)})}function Ef(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function m2(t){return Ef("topic",t)}function v2(t){return Ef("id",t)}function xf(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function we(t,e){return M.fromMiliseconds(Date.now()+M.toMiliseconds(t))}function or(t){return Date.now()>=M.toMiliseconds(t)}function ie(t,e){return`${t}${e?`:${e}`:""}`}function Cr(t=[],e=[]){return[...new Set([...t,...e])]}async function E2({id:t,topic:e,wcDeepLink:r}){var i;try{if(!r)return;const n=typeof r=="string"?JSON.parse(r):r,s=n?.href;if(typeof s!="string")return;const o=x2(s,t,e),a=Gi();if(a===it.browser){if(!((i=Zt.getDocument())!=null&&i.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}_2(o)}else a===it.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(n){console.error(n)}}function x2(t,e,r){const i=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let n=`${t}`;if(t.startsWith("https://t.me")){const s=t.includes("?")?"&startapp=":"?startapp=";n=`${n}${s}${O2(i,!0)}`}else n=`${n}/wc?${i}`;return n}function _2(t){let e="_self";D2()?e="_top":(S2()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function I2(t,e){let r="";try{if(ai()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(i){console.error(i)}return r}function wu(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),i=r.indexOf(e);return r[i+2]}function bu(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Ea(){return typeof process<"u"&&r2.IS_VITEST==="true"}function S2(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function D2(){try{return window.self!==window.top}catch{return!1}}function O2(t,e=!1){const r=Buffer.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function _f(t){return Buffer.from(t,"base64").toString("utf-8")}function A2(t){return new Promise(e=>setTimeout(e,t))}let $2=class{constructor({limit:e}){gu(this,"limit"),gu(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const r=this.set.values().next().value;r&&this.set.delete(r)}this.set.add(e)}}has(e){return this.set.has(e)}};const dn=BigInt(2**32-1),mu=BigInt(32);function If(t,e=!1){return e?{h:Number(t&dn),l:Number(t>>mu&dn)}:{h:Number(t>>mu&dn)|0,l:Number(t&dn)|0}}function Sf(t,e=!1){const r=t.length;let i=new Uint32Array(r),n=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=If(t[s],e);[i[s],n[s]]=[o,a]}return[i,n]}const vu=(t,e,r)=>t>>>r,Eu=(t,e,r)=>t<<32-r|e>>>r,ar=(t,e,r)=>t>>>r|e<<32-r,cr=(t,e,r)=>t<<32-r|e>>>r,_i=(t,e,r)=>t<<64-r|e>>>r-32,Ii=(t,e,r)=>t>>>r-32|e<<64-r,B2=(t,e)=>e,P2=(t,e)=>t,T2=(t,e,r)=>t<<r|e>>>32-r,R2=(t,e,r)=>e<<r|t>>>32-r,C2=(t,e,r)=>e<<r-32|t>>>64-r,N2=(t,e,r)=>t<<r-32|e>>>64-r;function bt(t,e,r,i){const n=(e>>>0)+(i>>>0);return{h:t+r+(n/2**32|0)|0,l:n|0}}const xa=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),_a=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,U2=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),k2=(t,e,r,i,n)=>e+r+i+n+(t/2**32|0)|0,L2=(t,e,r,i,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(n>>>0),F2=(t,e,r,i,n,s)=>e+r+i+n+s+(t/2**32|0)|0,Kr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Xn(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Xt(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function vt(t,...e){if(!Xn(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Jn(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Xt(t.outputLen),Xt(t.blockLen)}function wr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ia(t,e){vt(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Ui(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function dt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function js(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function It(t,e){return t<<32-e|t>>>e}const Df=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Of(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Mt=Df?t=>t:t=>Of(t);function M2(t){for(let e=0;e<t.length;e++)t[e]=Of(t[e]);return t}const ur=Df?t=>t:M2,Af=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",q2=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ei(t){if(vt(t),Af)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=q2[t[r]];return e}const kt={_0:48,_9:57,A:65,F:70,a:97,f:102};function xu(t){if(t>=kt._0&&t<=kt._9)return t-kt._0;if(t>=kt.A&&t<=kt.F)return t-(kt.A-10);if(t>=kt.a&&t<=kt.f)return t-(kt.a-10)}function Un(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Af)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let n=0,s=0;n<r;n++,s+=2){const o=xu(t.charCodeAt(s)),a=xu(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[n]=o*16+a}return i}function $f(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function mt(t){return typeof t=="string"&&(t=$f(t)),vt(t),t}function hr(...t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];vt(n),e+=n.length}const r=new Uint8Array(e);for(let i=0,n=0;i<t.length;i++){const s=t[i];r.set(s,n),n+=s.length}return r}let Qn=class{};function Yi(t){const e=i=>t().update(mt(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function j2(t){const e=(i,n)=>t(n).update(mt(i)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}function Mr(t=32){if(Kr&&typeof Kr.getRandomValues=="function")return Kr.getRandomValues(new Uint8Array(t));if(Kr&&typeof Kr.randomBytes=="function")return Uint8Array.from(Kr.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const z2=BigInt(0),yi=BigInt(1),V2=BigInt(2),K2=BigInt(7),H2=BigInt(256),W2=BigInt(113),Bf=[],Pf=[],Tf=[];for(let t=0,e=yi,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],Bf.push(2*(5*i+r)),Pf.push((t+1)*(t+2)/2%64);let n=z2;for(let s=0;s<7;s++)e=(e<<yi^(e>>K2)*W2)%H2,e&V2&&(n^=yi<<(yi<<BigInt(s))-yi);Tf.push(n)}const Rf=Sf(Tf,!0),G2=Rf[0],Y2=Rf[1],_u=(t,e,r)=>r>32?C2(t,e,r):T2(t,e,r),Iu=(t,e,r)=>r>32?N2(t,e,r):R2(t,e,r);function Z2(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],h=_u(u,l,1)^r[a],f=Iu(u,l,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=f}let n=t[2],s=t[3];for(let o=0;o<24;o++){const a=Pf[o],c=_u(n,s,a),u=Iu(n,s,a),l=Bf[o];n=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=G2[i],t[1]^=Y2[i]}dt(r)}let X2=class Cf extends Qn{constructor(e,r,i,n=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=n,this.rounds=s,Xt(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Ui(this.state)}clone(){return this._cloneInto()}keccak(){ur(this.state32),Z2(this.state32,this.rounds),ur(this.state32),this.posOut=0,this.pos=0}update(e){wr(this),e=mt(e),vt(e);const{blockLen:r,state:i}=this,n=e.length;for(let s=0;s<n;){const o=Math.min(r-this.pos,n-s);for(let a=0;a<o;a++)i[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:n}=this;e[i]^=r,(r&128)!==0&&i===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){wr(this,!1),vt(e),this.finish();const r=this.state,{blockLen:i}=this;for(let n=0,s=e.length;n<s;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,s-n);e.set(r.subarray(this.posOut,this.posOut+o),n),this.posOut+=o,n+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Xt(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Ia(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,dt(this.state)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:n,rounds:s,enableXOF:o}=this;return e||(e=new Cf(r,i,n,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=i,e.outputLen=n,e.enableXOF=o,e.destroyed=this.destroyed,e}};const J2=(t,e,r)=>Yi(()=>new X2(e,t,r)),Q2=J2(1,136,256/8);function eE(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s),c=i?4:0,u=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+u,a,i)}function tE(t,e,r){return t&e^~t&r}function rE(t,e,r){return t&e^t&r^e&r}let Nf=class extends Qn{constructor(e,r,i,n){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=n,this.buffer=new Uint8Array(e),this.view=js(this.buffer)}update(e){wr(this),e=mt(e),vt(e);const{view:r,buffer:i,blockLen:n}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(n-this.pos,s-o);if(a===n){const c=js(e);for(;n<=s-o;o+=n)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){wr(this),Ia(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:n,isLE:s}=this;let{pos:o}=this;r[o++]=128,dt(this.buffer.subarray(o)),this.padOffset>n-o&&(this.process(i,0),o=0);for(let h=o;h<n;h++)r[h]=0;eE(i,n-8,BigInt(this.length*8),s),this.process(i,0);const a=js(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:n,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=n,e.pos=a,n%r&&e.buffer.set(i),e}clone(){return this._cloneInto()}};const er=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Re=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Ce=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),iE=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),tr=new Uint32Array(64);class nE extends Nf{constructor(e=32){super(64,e,8,!1),this.A=er[0]|0,this.B=er[1]|0,this.C=er[2]|0,this.D=er[3]|0,this.E=er[4]|0,this.F=er[5]|0,this.G=er[6]|0,this.H=er[7]|0}get(){const{A:e,B:r,C:i,D:n,E:s,F:o,G:a,H:c}=this;return[e,r,i,n,s,o,a,c]}set(e,r,i,n,s,o,a,c){this.A=e|0,this.B=r|0,this.C=i|0,this.D=n|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)tr[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const f=tr[h-15],p=tr[h-2],d=It(f,7)^It(f,18)^f>>>3,g=It(p,17)^It(p,19)^p>>>10;tr[h]=g+tr[h-7]+d+tr[h-16]|0}let{A:i,B:n,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const f=It(a,6)^It(a,11)^It(a,25),p=l+f+tE(a,c,u)+iE[h]+tr[h]|0,d=(It(i,2)^It(i,13)^It(i,22))+rE(i,n,s)|0;l=u,u=c,c=a,a=o+p|0,o=s,s=n,n=i,i=p+d|0}i=i+this.A|0,n=n+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(i,n,s,o,a,c,u,l)}roundClean(){dt(tr)}destroy(){this.set(0,0,0,0,0,0,0,0),dt(this.buffer)}}const Uf=Sf(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),sE=Uf[0],oE=Uf[1],rr=new Uint32Array(80),ir=new Uint32Array(80);let Sa=class extends Nf{constructor(e=64){super(128,e,16,!1),this.Ah=Ce[0]|0,this.Al=Ce[1]|0,this.Bh=Ce[2]|0,this.Bl=Ce[3]|0,this.Ch=Ce[4]|0,this.Cl=Ce[5]|0,this.Dh=Ce[6]|0,this.Dl=Ce[7]|0,this.Eh=Ce[8]|0,this.El=Ce[9]|0,this.Fh=Ce[10]|0,this.Fl=Ce[11]|0,this.Gh=Ce[12]|0,this.Gl=Ce[13]|0,this.Hh=Ce[14]|0,this.Hl=Ce[15]|0}get(){const{Ah:e,Al:r,Bh:i,Bl:n,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:f,Gh:p,Gl:d,Hh:g,Hl:y}=this;return[e,r,i,n,s,o,a,c,u,l,h,f,p,d,g,y]}set(e,r,i,n,s,o,a,c,u,l,h,f,p,d,g,y){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=n|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=y|0}process(e,r){for(let w=0;w<16;w++,r+=4)rr[w]=e.getUint32(r),ir[w]=e.getUint32(r+=4);for(let w=16;w<80;w++){const b=rr[w-15]|0,m=ir[w-15]|0,_=ar(b,m,1)^ar(b,m,8)^vu(b,m,7),A=cr(b,m,1)^cr(b,m,8)^Eu(b,m,7),B=rr[w-2]|0,$=ir[w-2]|0,N=ar(B,$,19)^_i(B,$,61)^vu(B,$,6),U=cr(B,$,19)^Ii(B,$,61)^Eu(B,$,6),C=U2(A,U,ir[w-7],ir[w-16]),D=k2(C,_,N,rr[w-7],rr[w-16]);rr[w]=D|0,ir[w]=C|0}let{Ah:i,Al:n,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:f,Fh:p,Fl:d,Gh:g,Gl:y,Hh:x,Hl:I}=this;for(let w=0;w<80;w++){const b=ar(h,f,14)^ar(h,f,18)^_i(h,f,41),m=cr(h,f,14)^cr(h,f,18)^Ii(h,f,41),_=h&p^~h&g,A=f&d^~f&y,B=L2(I,m,A,oE[w],ir[w]),$=F2(B,x,b,_,sE[w],rr[w]),N=B|0,U=ar(i,n,28)^_i(i,n,34)^_i(i,n,39),C=cr(i,n,28)^Ii(i,n,34)^Ii(i,n,39),D=i&s^i&a^s&a,T=n&o^n&c^o&c;x=g|0,I=y|0,g=p|0,y=d|0,p=h|0,d=f|0,{h,l:f}=bt(u|0,l|0,$|0,N|0),u=a|0,l=c|0,a=s|0,c=o|0,s=i|0,o=n|0;const E=xa(N,C,T);i=_a(E,$,U,D),n=E|0}({h:i,l:n}=bt(this.Ah|0,this.Al|0,i|0,n|0)),{h:s,l:o}=bt(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=bt(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=bt(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:f}=bt(this.Eh|0,this.El|0,h|0,f|0),{h:p,l:d}=bt(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:y}=bt(this.Gh|0,this.Gl|0,g|0,y|0),{h:x,l:I}=bt(this.Hh|0,this.Hl|0,x|0,I|0),this.set(i,n,s,o,a,c,u,l,h,f,p,d,g,y,x,I)}roundClean(){dt(rr,ir)}destroy(){dt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};class aE extends Sa{constructor(){super(48),this.Ah=Re[0]|0,this.Al=Re[1]|0,this.Bh=Re[2]|0,this.Bl=Re[3]|0,this.Ch=Re[4]|0,this.Cl=Re[5]|0,this.Dh=Re[6]|0,this.Dl=Re[7]|0,this.Eh=Re[8]|0,this.El=Re[9]|0,this.Fh=Re[10]|0,this.Fl=Re[11]|0,this.Gh=Re[12]|0,this.Gl=Re[13]|0,this.Hh=Re[14]|0,this.Hl=Re[15]|0}}const Ne=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class cE extends Sa{constructor(){super(32),this.Ah=Ne[0]|0,this.Al=Ne[1]|0,this.Bh=Ne[2]|0,this.Bl=Ne[3]|0,this.Ch=Ne[4]|0,this.Cl=Ne[5]|0,this.Dh=Ne[6]|0,this.Dl=Ne[7]|0,this.Eh=Ne[8]|0,this.El=Ne[9]|0,this.Fh=Ne[10]|0,this.Fl=Ne[11]|0,this.Gh=Ne[12]|0,this.Gl=Ne[13]|0,this.Hh=Ne[14]|0,this.Hl=Ne[15]|0}}const es=Yi(()=>new nE),uE=Yi(()=>new Sa),lE=Yi(()=>new aE),hE=Yi(()=>new cE),fE=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),ye=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),V=new Uint32Array(32);function nr(t,e,r,i,n,s){const o=n[s],a=n[s+1];let c=V[2*t],u=V[2*t+1],l=V[2*e],h=V[2*e+1],f=V[2*r],p=V[2*r+1],d=V[2*i],g=V[2*i+1],y=xa(c,l,o);u=_a(y,u,h,a),c=y|0,{Dh:g,Dl:d}={Dh:g^u,Dl:d^c},{Dh:g,Dl:d}={Dh:B2(g,d),Dl:P2(g)},{h:p,l:f}=bt(p,f,g,d),{Bh:h,Bl:l}={Bh:h^p,Bl:l^f},{Bh:h,Bl:l}={Bh:ar(h,l,24),Bl:cr(h,l,24)},V[2*t]=c,V[2*t+1]=u,V[2*e]=l,V[2*e+1]=h,V[2*r]=f,V[2*r+1]=p,V[2*i]=d,V[2*i+1]=g}function sr(t,e,r,i,n,s){const o=n[s],a=n[s+1];let c=V[2*t],u=V[2*t+1],l=V[2*e],h=V[2*e+1],f=V[2*r],p=V[2*r+1],d=V[2*i],g=V[2*i+1],y=xa(c,l,o);u=_a(y,u,h,a),c=y|0,{Dh:g,Dl:d}={Dh:g^u,Dl:d^c},{Dh:g,Dl:d}={Dh:ar(g,d,16),Dl:cr(g,d,16)},{h:p,l:f}=bt(p,f,g,d),{Bh:h,Bl:l}={Bh:h^p,Bl:l^f},{Bh:h,Bl:l}={Bh:_i(h,l,63),Bl:Ii(h,l,63)},V[2*t]=c,V[2*t+1]=u,V[2*e]=l,V[2*e+1]=h,V[2*r]=f,V[2*r+1]=p,V[2*i]=d,V[2*i+1]=g}function dE(t,e={},r,i,n){if(Xt(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==i)throw new Error("salt must be undefined or "+i);if(a!==void 0&&a.length!==n)throw new Error("personalization must be undefined or "+n)}class pE extends Qn{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,Xt(e),Xt(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=Ui(this.buffer)}update(e){wr(this),e=mt(e),vt(e);const{blockLen:r,buffer:i,buffer32:n}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===r&&(ur(n),this.compress(n,0,!1),ur(n),this.pos=0);const u=Math.min(r-this.pos,s-c),l=o+c;if(u===r&&!(l%4)&&c+u<s){const h=new Uint32Array(a,l,Math.floor((s-c)/4));ur(h);for(let f=0;c+r<s;f+=n.length,c+=r)this.length+=r,this.compress(h,f,!1);ur(h);continue}i.set(e.subarray(c,c+u),this.pos),this.pos+=u,this.length+=u,c+=u}return this}digestInto(e){wr(this),Ia(e,this);const{pos:r,buffer32:i}=this;this.finished=!0,dt(this.buffer.subarray(r)),ur(i),this.compress(i,0,!0),ur(i);const n=Ui(e);this.get().forEach((s,o)=>n[o]=Mt(s))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){const{buffer:r,length:i,finished:n,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=s,e.finished=n,e.length=i,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class gE extends pE{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=ye[0]|0,this.v0h=ye[1]|0,this.v1l=ye[2]|0,this.v1h=ye[3]|0,this.v2l=ye[4]|0,this.v2h=ye[5]|0,this.v3l=ye[6]|0,this.v3h=ye[7]|0,this.v4l=ye[8]|0,this.v4h=ye[9]|0,this.v5l=ye[10]|0,this.v5h=ye[11]|0,this.v6l=ye[12]|0,this.v6h=ye[13]|0,this.v7l=ye[14]|0,this.v7h=ye[15]|0,dE(r,e,64,16,16);let{key:i,personalization:n,salt:s}=e,o=0;if(i!==void 0&&(i=mt(i),o=i.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=mt(s);const a=Ui(s);this.v4l^=Mt(a[0]),this.v4h^=Mt(a[1]),this.v5l^=Mt(a[2]),this.v5h^=Mt(a[3])}if(n!==void 0){n=mt(n);const a=Ui(n);this.v6l^=Mt(a[0]),this.v6h^=Mt(a[1]),this.v7l^=Mt(a[2]),this.v7h^=Mt(a[3])}if(i!==void 0){const a=new Uint8Array(this.blockLen);a.set(i),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:i,v1h:n,v2l:s,v2h:o,v3l:a,v3h:c,v4l:u,v4h:l,v5l:h,v5h:f,v6l:p,v6h:d,v7l:g,v7h:y}=this;return[e,r,i,n,s,o,a,c,u,l,h,f,p,d,g,y]}set(e,r,i,n,s,o,a,c,u,l,h,f,p,d,g,y){this.v0l=e|0,this.v0h=r|0,this.v1l=i|0,this.v1h=n|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=u|0,this.v4h=l|0,this.v5l=h|0,this.v5h=f|0,this.v6l=p|0,this.v6h=d|0,this.v7l=g|0,this.v7h=y|0}compress(e,r,i){this.get().forEach((c,u)=>V[u]=c),V.set(ye,16);let{h:n,l:s}=If(BigInt(this.length));V[24]=ye[8]^s,V[25]=ye[9]^n,i&&(V[28]=~V[28],V[29]=~V[29]);let o=0;const a=fE;for(let c=0;c<12;c++)nr(0,4,8,12,e,r+2*a[o++]),sr(0,4,8,12,e,r+2*a[o++]),nr(1,5,9,13,e,r+2*a[o++]),sr(1,5,9,13,e,r+2*a[o++]),nr(2,6,10,14,e,r+2*a[o++]),sr(2,6,10,14,e,r+2*a[o++]),nr(3,7,11,15,e,r+2*a[o++]),sr(3,7,11,15,e,r+2*a[o++]),nr(0,5,10,15,e,r+2*a[o++]),sr(0,5,10,15,e,r+2*a[o++]),nr(1,6,11,12,e,r+2*a[o++]),sr(1,6,11,12,e,r+2*a[o++]),nr(2,7,8,13,e,r+2*a[o++]),sr(2,7,8,13,e,r+2*a[o++]),nr(3,4,9,14,e,r+2*a[o++]),sr(3,4,9,14,e,r+2*a[o++]);this.v0l^=V[0]^V[16],this.v0h^=V[1]^V[17],this.v1l^=V[2]^V[18],this.v1h^=V[3]^V[19],this.v2l^=V[4]^V[20],this.v2h^=V[5]^V[21],this.v3l^=V[6]^V[22],this.v3h^=V[7]^V[23],this.v4l^=V[8]^V[24],this.v4h^=V[9]^V[25],this.v5l^=V[10]^V[26],this.v5h^=V[11]^V[27],this.v6l^=V[12]^V[28],this.v6h^=V[13]^V[29],this.v7l^=V[14]^V[30],this.v7h^=V[15]^V[31],dt(V)}destroy(){this.destroyed=!0,dt(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const yE=j2(t=>new gE(t)),wE="https://rpc.walletconnect.org/v1";function kf(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Buffer.from(Q2(r)).toString("hex")}async function bE(t,e,r,i,n,s){switch(r.t){case"eip191":return await mE(t,e,r.s);case"eip1271":return await vE(t,e,r.s,i,n,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}function mE(t,e,r){const i=l1(r);return g1({payload:kf(e),signature:i}).toLowerCase()===t.toLowerCase()}async function vE(t,e,r,i,n,s){const o=xn(i);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",u=r.substring(2),l=(u.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:kf(e)).substring(2),f=a+h+c+l+u,p=await fetch(`${s||wE}/?chainId=${i}&projectId=${n}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:EE(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:f},"latest"]})}),{result:d}=await p.json();return d?d.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function EE(){return Date.now()+Math.floor(Math.random()*1e3)}function xE(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const i=r[0];if(i===0)throw new Error("No signatures found");const n=1+i*64;if(r.length<n)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const s=Buffer.from(t,"base64").slice(1,65);return Hi.encode(s)}function _E(t){const e=new Uint8Array(Buffer.from(t,"base64")),r=Array.from("TransactionData::").map(s=>s.charCodeAt(0)),i=new Uint8Array(r.length+e.length);i.set(r),i.set(e,r.length);const n=yE(i,{dkLen:32});return Hi.encode(n)}function Su(t){const e=new Uint8Array(es(IE(t)));return Hi.encode(e)}function IE(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function Du(t){const e=Buffer.from(t,"base64"),r=ev(e).txn;if(!r)throw new Error("Invalid signed transaction: missing 'txn' field");const i=K1(r),n=Buffer.from("TX"),s=Buffer.concat([n,Buffer.from(i)]),o=hE(s);return yp.encode(o).replace(/=+$/,"")}function zs(t){const e=[];let r=BigInt(t);for(;r>=BigInt(128);)e.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return e.push(Number(r)),Buffer.from(e)}function SE(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),r=Buffer.from(t.signed.authInfoBytes,"base64"),i=Buffer.from(t.signature.signature,"base64"),n=[];n.push(Buffer.from([10])),n.push(zs(e.length)),n.push(e),n.push(Buffer.from([18])),n.push(zs(r.length)),n.push(r),n.push(Buffer.from([26])),n.push(zs(i.length)),n.push(i);const s=Buffer.concat(n),o=es(s);return Buffer.from(o).toString("hex").toUpperCase()}function DE(t){var e,r;const i=[];try{if(typeof t=="string")return i.push(t),i;if(typeof t!="object")return i;t!=null&&t.id&&i.push(t.id);const n=(r=(e=t?.capabilities)==null?void 0:e.caip345)==null?void 0:r.transactionHashes;n&&i.push(...n)}catch(n){console.warn("getWalletSendCallsHashes failed: ",n)}return i}var OE=Object.defineProperty,AE=Object.defineProperties,$E=Object.getOwnPropertyDescriptors,Ou=Object.getOwnPropertySymbols,BE=Object.prototype.hasOwnProperty,PE=Object.prototype.propertyIsEnumerable,Au=(t,e,r)=>e in t?OE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,TE=(t,e)=>{for(var r in e||(e={}))BE.call(e,r)&&Au(t,r,e[r]);if(Ou)for(var r of Ou(e))PE.call(e,r)&&Au(t,r,e[r]);return t},RE=(t,e)=>AE(t,$E(e));const Lf="did:pkh:",CE={eip155:"Ethereum",solana:"Solana",bip122:"Bitcoin"},NE=t=>t?CE[t]||t:"",ts=t=>t?.split(":"),UE=t=>{const e=t&&ts(t);if(e)return t.includes(Lf)?e[3]:e[1]},kE=t=>{const e=t&&ts(t);if(e)return t.includes(Lf)?e[2]:e[0]},To=t=>{const e=t&&ts(t);if(e)return e[2]+":"+e[3]},kn=t=>{const e=t&&ts(t);if(e)return e.pop()};async function $u(t){const{cacao:e,projectId:r}=t,{s:i,p:n}=e,s=Ff(n,n.iss),o=kn(n.iss);return await bE(o,s,i,To(n.iss),r)}const Ff=(t,e)=>{const r=kE(e);if(!r)throw new Error("Invalid issuer: "+e);const i=`${t.domain} wants you to sign in with your ${NE(r)} account:`,n=kn(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=t.statement||void 0;const o=`URI: ${t.aud||t.uri}`,a=`Version: ${t.version}`,c=`Chain ID: ${UE(e)}`,u=`Nonce: ${t.nonce}`,l=`Issued At: ${t.iat}`,h=t.exp?`Expiration Time: ${t.exp}`:void 0,f=t.nbf?`Not Before: ${t.nbf}`:void 0,p=t.requestId?`Request ID: ${t.requestId}`:void 0,d=t.resources?`Resources:${t.resources.map(y=>`
- ${y}`).join("")}`:void 0,g=_n(t.resources);if(g){const y=ki(g);s=HE(s,y)}return[i,n,"",s,"",o,a,c,u,l,h,f,p,d].filter(y=>y!=null).join(`
`)};function LE(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function FE(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function Nr(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const i=t.att[r];if(Array.isArray(i))throw new Error(`Resource must be an object: ${r}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(i).forEach(n=>{const s=i[n];if(!Array.isArray(s))throw new Error(`Ability limits ${n} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${n} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${n}) must be an array of objects, found: ${o}`)})})})}function ME(t,e,r,i={}){return r?.sort((n,s)=>n.localeCompare(s)),{att:{[t]:qE(e,r,i)}}}function qE(t,e,r={}){e=e?.sort((n,s)=>n.localeCompare(s));const i=e.map(n=>({[`${t}/${n}`]:[r]}));return Object.assign({},...i)}function Mf(t){return Nr(t),`urn:recap:${LE(t).replace(/=/g,"")}`}function ki(t){const e=FE(t.replace("urn:recap:",""));return Nr(e),e}function jE(t,e,r){const i=ME(t,e,r);return Mf(i)}function zE(t){return t&&t.includes("urn:recap:")}function VE(t,e){const r=ki(t),i=ki(e),n=KE(r,i);return Mf(n)}function KE(t,e){Nr(t),Nr(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((n,s)=>n.localeCompare(s)),i={att:{}};return r.forEach(n=>{var s,o;Object.keys(((s=t.att)==null?void 0:s[n])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[n])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,u;i.att[n]=RE(TE({},i.att[n]),{[a]:((c=t.att[n])==null?void 0:c[a])||((u=e.att[n])==null?void 0:u[a])})})}),i}function HE(t="",e){Nr(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const i=[];let n=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,f)=>h.action.localeCompare(f.action));const u={};c.forEach(h=>{u[h.ability]||(u[h.ability]=[]),u[h.ability].push(h.action)});const l=Object.keys(u).map(h=>(n++,`(${n}) '${h}': '${u[h].join("', '")}' for '${a}'.`));i.push(l.join(", ").replace(".,","."))});const s=i.join(" "),o=`${r}${s}`;return`${t?t+" ":""}${o}`}function Bu(t){var e;const r=ki(t);Nr(r);const i=(e=r.att)==null?void 0:e.eip155;return i?Object.keys(i).map(n=>n.split("/")[1]):[]}function Pu(t){const e=ki(t);Nr(e);const r=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(n=>{var s;(s=n?.[0])!=null&&s.chains&&r.push(n[0].chains)})}),[...new Set(r.flat())]}function _n(t){if(!t)return;const e=t?.[t.length-1];return zE(e)?e:void 0}function qf(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ro(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function Vs(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function We(t,...e){if(!qf(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Tu(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function WE(t,e){We(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function gr(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function ii(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function GE(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const YE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ZE(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Co(t){if(typeof t=="string")t=ZE(t);else if(qf(t))t=No(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function XE(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function JE(t,e){if(t.length!==e.length)return!1;let r=0;for(let i=0;i<t.length;i++)r|=t[i]^e[i];return r===0}const QE=(t,e)=>{function r(i,...n){if(We(i),!YE)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const u=n[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?We(u):We(u,t.nonceLength)}const s=t.tagLength;s&&n[1]!==void 0&&We(n[1]);const o=e(i,...n),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");We(l)}};let c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,We(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if(We(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(r,t),r};function Ru(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!tx(e))throw new Error("invalid output, must be aligned");return e}function Cu(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s);t.setUint32(e+4,o,i),t.setUint32(e+0,a,i)}function ex(t,e,r){Ro(r);const i=new Uint8Array(16),n=GE(i);return Cu(n,0,BigInt(e),r),Cu(n,8,BigInt(t),r),i}function tx(t){return t.byteOffset%4===0}function No(t){return Uint8Array.from(t)}const jf=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),rx=jf("expand 16-byte k"),ix=jf("expand 32-byte k"),nx=gr(rx),sx=gr(ix);function ee(t,e){return t<<e|t>>>32-e}function Uo(t){return t.byteOffset%4===0}const pn=64,ox=16,zf=2**32-1,Nu=new Uint32Array;function ax(t,e,r,i,n,s,o,a){const c=n.length,u=new Uint8Array(pn),l=gr(u),h=Uo(n)&&Uo(s),f=h?gr(n):Nu,p=h?gr(s):Nu;for(let d=0;d<c;o++){if(t(e,r,i,l,o,a),o>=zf)throw new Error("arx: counter overflow");const g=Math.min(pn,c-d);if(h&&g===pn){const y=d/4;if(d%4!==0)throw new Error("arx: invalid block position");for(let x=0,I;x<ox;x++)I=y+x,p[I]=f[I]^l[x];d+=pn;continue}for(let y=0,x;y<g;y++)x=d+y,s[x]=n[x]^u[y];d+=g}}function cx(t,e){const{allowShortKeys:r,extendNonceFn:i,counterLength:n,counterRight:s,rounds:o}=XE({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Vs(n),Vs(o),Ro(s),Ro(r),(a,c,u,l,h=0)=>{We(a),We(c),We(u);const f=u.length;if(l===void 0&&(l=new Uint8Array(f)),We(l),Vs(h),h<0||h>=zf)throw new Error("arx: counter overflow");if(l.length<f)throw new Error(`arx: output (${l.length}) is shorter than data (${f})`);const p=[];let d=a.length,g,y;if(d===32)p.push(g=No(a)),y=sx;else if(d===16&&r)g=new Uint8Array(32),g.set(a),g.set(a,16),y=nx,p.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${d}`);Uo(c)||p.push(c=No(c));const x=gr(g);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(y,x,gr(c.subarray(0,16)),x),c=c.subarray(16)}const I=16-n;if(I!==c.length)throw new Error(`arx: nonce must be ${I} or 16 bytes`);if(I!==12){const b=new Uint8Array(12);b.set(c,s?0:12-c.length),c=b,p.push(c)}const w=gr(c);return ax(t,y,x,w,u,l,h,o),ii(...p),l}}const De=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class ux{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Co(e),We(e,32);const r=De(e,0),i=De(e,2),n=De(e,4),s=De(e,6),o=De(e,8),a=De(e,10),c=De(e,12),u=De(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|i<<3)&8191,this.r[2]=(i>>>10|n<<6)&7939,this.r[3]=(n>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=De(e,16+2*l)}process(e,r,i=!1){const n=i?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],u=o[2],l=o[3],h=o[4],f=o[5],p=o[6],d=o[7],g=o[8],y=o[9],x=De(e,r+0),I=De(e,r+2),w=De(e,r+4),b=De(e,r+6),m=De(e,r+8),_=De(e,r+10),A=De(e,r+12),B=De(e,r+14);let $=s[0]+(x&8191),N=s[1]+((x>>>13|I<<3)&8191),U=s[2]+((I>>>10|w<<6)&8191),C=s[3]+((w>>>7|b<<9)&8191),D=s[4]+((b>>>4|m<<12)&8191),T=s[5]+(m>>>1&8191),E=s[6]+((m>>>14|_<<2)&8191),v=s[7]+((_>>>11|A<<5)&8191),O=s[8]+((A>>>8|B<<8)&8191),R=s[9]+(B>>>5|n),S=0,P=S+$*a+N*(5*y)+U*(5*g)+C*(5*d)+D*(5*p);S=P>>>13,P&=8191,P+=T*(5*f)+E*(5*h)+v*(5*l)+O*(5*u)+R*(5*c),S+=P>>>13,P&=8191;let k=S+$*c+N*a+U*(5*y)+C*(5*g)+D*(5*d);S=k>>>13,k&=8191,k+=T*(5*p)+E*(5*f)+v*(5*h)+O*(5*l)+R*(5*u),S+=k>>>13,k&=8191;let L=S+$*u+N*c+U*a+C*(5*y)+D*(5*g);S=L>>>13,L&=8191,L+=T*(5*d)+E*(5*p)+v*(5*f)+O*(5*h)+R*(5*l),S+=L>>>13,L&=8191;let K=S+$*l+N*u+U*c+C*a+D*(5*y);S=K>>>13,K&=8191,K+=T*(5*g)+E*(5*d)+v*(5*p)+O*(5*f)+R*(5*h),S+=K>>>13,K&=8191;let z=S+$*h+N*l+U*u+C*c+D*a;S=z>>>13,z&=8191,z+=T*(5*y)+E*(5*g)+v*(5*d)+O*(5*p)+R*(5*f),S+=z>>>13,z&=8191;let j=S+$*f+N*h+U*l+C*u+D*c;S=j>>>13,j&=8191,j+=T*a+E*(5*y)+v*(5*g)+O*(5*d)+R*(5*p),S+=j>>>13,j&=8191;let H=S+$*p+N*f+U*h+C*l+D*u;S=H>>>13,H&=8191,H+=T*c+E*a+v*(5*y)+O*(5*g)+R*(5*d),S+=H>>>13,H&=8191;let G=S+$*d+N*p+U*f+C*h+D*l;S=G>>>13,G&=8191,G+=T*u+E*c+v*a+O*(5*y)+R*(5*g),S+=G>>>13,G&=8191;let Z=S+$*g+N*d+U*p+C*f+D*h;S=Z>>>13,Z&=8191,Z+=T*l+E*u+v*c+O*a+R*(5*y),S+=Z>>>13,Z&=8191;let W=S+$*y+N*g+U*d+C*p+D*f;S=W>>>13,W&=8191,W+=T*h+E*l+v*u+O*c+R*a,S+=W>>>13,W&=8191,S=(S<<2)+S|0,S=S+P|0,P=S&8191,S=S>>>13,k+=S,s[0]=P,s[1]=k,s[2]=L,s[3]=K,s[4]=z,s[5]=j,s[6]=H,s[7]=G,s[8]=Z,s[9]=W}finalize(){const{h:e,pad:r}=this,i=new Uint16Array(10);let n=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=n,n=e[a]>>>13,e[a]&=8191;e[0]+=n*5,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,i[0]=e[0]+5,n=i[0]>>>13,i[0]&=8191;for(let a=1;a<10;a++)i[a]=e[a]+n,n=i[a]>>>13,i[a]&=8191;i[9]-=8192;let s=(n^1)-1;for(let a=0;a<10;a++)i[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|i[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;ii(i)}update(e){Tu(this),e=Co(e),We(e);const{buffer:r,blockLen:i}=this,n=e.length;for(let s=0;s<n;){const o=Math.min(i-this.pos,n-s);if(o===i){for(;i<=n-s;s+=i)this.process(e,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===i&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){ii(this.h,this.r,this.buffer,this.pad)}digestInto(e){Tu(this),WE(e,this),this.finished=!0;const{buffer:r,h:i}=this;let{pos:n}=this;if(n){for(r[n++]=1;n<16;n++)r[n]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=i[o]>>>0,e[s++]=i[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}}function lx(t){const e=(i,n)=>t(n).update(Co(i)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}const hx=lx(t=>new ux(t));function fx(t,e,r,i,n,s=20){let o=t[0],a=t[1],c=t[2],u=t[3],l=e[0],h=e[1],f=e[2],p=e[3],d=e[4],g=e[5],y=e[6],x=e[7],I=n,w=r[0],b=r[1],m=r[2],_=o,A=a,B=c,$=u,N=l,U=h,C=f,D=p,T=d,E=g,v=y,O=x,R=I,S=w,P=b,k=m;for(let K=0;K<s;K+=2)_=_+N|0,R=ee(R^_,16),T=T+R|0,N=ee(N^T,12),_=_+N|0,R=ee(R^_,8),T=T+R|0,N=ee(N^T,7),A=A+U|0,S=ee(S^A,16),E=E+S|0,U=ee(U^E,12),A=A+U|0,S=ee(S^A,8),E=E+S|0,U=ee(U^E,7),B=B+C|0,P=ee(P^B,16),v=v+P|0,C=ee(C^v,12),B=B+C|0,P=ee(P^B,8),v=v+P|0,C=ee(C^v,7),$=$+D|0,k=ee(k^$,16),O=O+k|0,D=ee(D^O,12),$=$+D|0,k=ee(k^$,8),O=O+k|0,D=ee(D^O,7),_=_+U|0,k=ee(k^_,16),v=v+k|0,U=ee(U^v,12),_=_+U|0,k=ee(k^_,8),v=v+k|0,U=ee(U^v,7),A=A+C|0,R=ee(R^A,16),O=O+R|0,C=ee(C^O,12),A=A+C|0,R=ee(R^A,8),O=O+R|0,C=ee(C^O,7),B=B+D|0,S=ee(S^B,16),T=T+S|0,D=ee(D^T,12),B=B+D|0,S=ee(S^B,8),T=T+S|0,D=ee(D^T,7),$=$+N|0,P=ee(P^$,16),E=E+P|0,N=ee(N^E,12),$=$+N|0,P=ee(P^$,8),E=E+P|0,N=ee(N^E,7);let L=0;i[L++]=o+_|0,i[L++]=a+A|0,i[L++]=c+B|0,i[L++]=u+$|0,i[L++]=l+N|0,i[L++]=h+U|0,i[L++]=f+C|0,i[L++]=p+D|0,i[L++]=d+T|0,i[L++]=g+E|0,i[L++]=y+v|0,i[L++]=x+O|0,i[L++]=I+R|0,i[L++]=w+S|0,i[L++]=b+P|0,i[L++]=m+k|0}const dx=cx(fx,{counterRight:!1,counterLength:4,allowShortKeys:!1}),px=new Uint8Array(16),Uu=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(px.subarray(r))},gx=new Uint8Array(32);function ku(t,e,r,i,n){const s=t(e,r,gx),o=hx.create(s);n&&Uu(o,n),Uu(o,i);const a=ex(i.length,n?n.length:0,!0);o.update(a);const c=o.digest();return ii(s,a),c}const yx=t=>(e,r,i)=>({encrypt(n,s){const o=n.length;s=Ru(o+16,s,!1),s.set(n);const a=s.subarray(0,-16);t(e,r,a,a,1);const c=ku(t,e,r,a,i);return s.set(c,o),ii(c),s},decrypt(n,s){s=Ru(n.length-16,s,!1);const o=n.subarray(0,-16),a=n.subarray(-16),c=ku(t,e,r,o,i);if(!JE(a,c))throw new Error("invalid tag");return s.set(n.subarray(0,-16)),t(e,r,s,s,1),ii(c),s}}),Vf=QE({blockSize:64,nonceLength:12,tagLength:16},yx(dx));let Kf=class extends Qn{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Jn(e);const i=mt(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,s=new Uint8Array(n);s.set(i.length>n?e.create().update(i).digest():i);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),dt(s)}update(e){return wr(this),this.iHash.update(e),this}digestInto(e){wr(this),vt(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:n,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=n,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const rs=(t,e,r)=>new Kf(t,e).update(r).digest();rs.create=(t,e)=>new Kf(t,e);function wx(t,e,r){return Jn(t),r===void 0&&(r=new Uint8Array(t.outputLen)),rs(t,mt(r),mt(e))}const Ks=Uint8Array.from([0]),Lu=Uint8Array.of();function bx(t,e,r,i=32){Jn(t),Xt(i);const n=t.outputLen;if(i>255*n)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(i/n);r===void 0&&(r=Lu);const o=new Uint8Array(s*n),a=rs.create(t,e),c=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let l=0;l<s;l++)Ks[0]=l+1,c.update(l===0?Lu:u).update(r).update(Ks).digestInto(u),o.set(u,n*l),a._cloneInto(c);return a.destroy(),c.destroy(),dt(u,Ks),o.slice(0,i)}const mx=(t,e,r,i,n)=>bx(t,wx(t,e,r),i,n),is=es,Da=BigInt(0),ko=BigInt(1);function Ln(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function Br(t,e,r=""){const i=Xn(t),n=t?.length,s=e!==void 0;if(!i||s&&n!==e){const o=r&&`"${r}" `,a=s?` of length ${e}`:"",c=i?`length=${n}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function gn(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Hf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Da:BigInt("0x"+t)}function ns(t){return Hf(ei(t))}function Fn(t){return vt(t),Hf(ei(Uint8Array.from(t).reverse()))}function Oa(t,e){return Un(t.toString(16).padStart(e*2,"0"))}function Aa(t,e){return Oa(t,e).reverse()}function ke(t,e,r){let i;if(typeof e=="string")try{i=Un(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Xn(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=i.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return i}const Hs=t=>typeof t=="bigint"&&Da<=t;function vx(t,e,r){return Hs(t)&&Hs(e)&&Hs(r)&&e<=t&&t<r}function Lo(t,e,r,i){if(!vx(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function Wf(t){let e;for(e=0;t>Da;t>>=ko,e+=1);return e}const Zi=t=>(ko<<BigInt(t))-ko;function Ex(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const i=f=>new Uint8Array(f),n=f=>Uint8Array.of(f);let s=i(t),o=i(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},u=(...f)=>r(o,s,...f),l=(f=i(0))=>{o=u(n(0),f),s=u(),f.length!==0&&(o=u(n(1),f),s=u())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const p=[];for(;f<e;){s=u();const d=s.slice();p.push(d),f+=s.length}return hr(...p)};return(f,p)=>{c(),l(f);let d;for(;!(d=p(h()));)l();return c(),d}}function ss(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function i(n,s,o){const a=t[n];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${n}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([n,s])=>i(n,s,!1)),Object.entries(r).forEach(([n,s])=>i(n,s,!0))}function Fu(t){const e=new WeakMap;return(r,...i)=>{const n=e.get(r);if(n!==void 0)return n;const s=t(r,...i);return e.set(r,s),s}}const Ze=BigInt(0),Me=BigInt(1),Pr=BigInt(2),Gf=BigInt(3),Yf=BigInt(4),Zf=BigInt(5),xx=BigInt(7),Xf=BigInt(8),_x=BigInt(9),Jf=BigInt(16);function rt(t,e){const r=t%e;return r>=Ze?r:e+r}function wt(t,e,r){let i=t;for(;e-- >Ze;)i*=i,i%=r;return i}function Mu(t,e){if(t===Ze)throw new Error("invert: expected non-zero number");if(e<=Ze)throw new Error("invert: expected positive modulus, got "+e);let r=rt(t,e),i=e,n=Ze,s=Me;for(;r!==Ze;){const o=i/r,a=i%r,c=n-s*o;i=r,r=a,n=s,s=c}if(i!==Me)throw new Error("invert: does not exist");return rt(n,e)}function $a(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function Qf(t,e){const r=(t.ORDER+Me)/Yf,i=t.pow(e,r);return $a(t,i,e),i}function Ix(t,e){const r=(t.ORDER-Zf)/Xf,i=t.mul(e,Pr),n=t.pow(i,r),s=t.mul(e,n),o=t.mul(t.mul(s,Pr),n),a=t.mul(s,t.sub(o,t.ONE));return $a(t,a,e),a}function Sx(t){const e=mr(t),r=ed(t),i=r(e,e.neg(e.ONE)),n=r(e,i),s=r(e,e.neg(i)),o=(t+xx)/Jf;return(a,c)=>{let u=a.pow(c,o),l=a.mul(u,i);const h=a.mul(u,n),f=a.mul(u,s),p=a.eql(a.sqr(l),c),d=a.eql(a.sqr(h),c);u=a.cmov(u,l,p),l=a.cmov(f,h,d);const g=a.eql(a.sqr(l),c),y=a.cmov(u,l,g);return $a(a,y,c),y}}function ed(t){if(t<Gf)throw new Error("sqrt is not defined for small field");let e=t-Me,r=0;for(;e%Pr===Ze;)e/=Pr,r++;let i=Pr;const n=mr(t);for(;qu(n,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Qf;let s=n.pow(i,e);const o=(e+Me)/Pr;return function(a,c){if(a.is0(c))return c;if(qu(a,c)!==1)throw new Error("Cannot find square root");let u=r,l=a.mul(a.ONE,s),h=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let p=1,d=a.sqr(h);for(;!a.eql(d,a.ONE);)if(p++,d=a.sqr(d),p===u)throw new Error("Cannot find square root");const g=Me<<BigInt(u-p-1),y=a.pow(l,g);u=p,l=a.sqr(y),h=a.mul(h,l),f=a.mul(f,y)}return f}}function Dx(t){return t%Yf===Gf?Qf:t%Xf===Zf?Ix:t%Jf===_x?Sx(t):ed(t)}const Ox=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Ax(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=Ox.reduce((i,n)=>(i[n]="function",i),e);return ss(t,r),t}function $x(t,e,r){if(r<Ze)throw new Error("invalid exponent, negatives unsupported");if(r===Ze)return t.ONE;if(r===Me)return e;let i=t.ONE,n=e;for(;r>Ze;)r&Me&&(i=t.mul(i,n)),n=t.sqr(n),r>>=Me;return i}function td(t,e,r=!1){const i=new Array(e.length).fill(r?t.ZERO:void 0),n=e.reduce((o,a,c)=>t.is0(a)?o:(i[c]=o,t.mul(o,a)),t.ONE),s=t.inv(n);return e.reduceRight((o,a,c)=>t.is0(a)?o:(i[c]=t.mul(o,i[c]),t.mul(o,a)),s),i}function qu(t,e){const r=(t.ORDER-Me)/Pr,i=t.pow(e,r),n=t.eql(i,t.ONE),s=t.eql(i,t.ZERO),o=t.eql(i,t.neg(t.ONE));if(!n&&!s&&!o)throw new Error("invalid Legendre symbol result");return n?1:s?0:-1}function rd(t,e){e!==void 0&&Xt(e);const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function mr(t,e,r=!1,i={}){if(t<=Ze)throw new Error("invalid field: expected ORDER > 0, got "+t);let n,s,o=!1,a;if(typeof e=="object"&&e!=null){if(i.sqrt||r)throw new Error("cannot specify opts in two arguments");const f=e;f.BITS&&(n=f.BITS),f.sqrt&&(s=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE),typeof f.modFromBytes=="boolean"&&(o=f.modFromBytes),a=f.allowedLengths}else typeof e=="number"&&(n=e),i.sqrt&&(s=i.sqrt);const{nBitLength:c,nByteLength:u}=rd(t,n);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l;const h=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:u,MASK:Zi(c),ZERO:Ze,ONE:Me,allowedLengths:a,create:f=>rt(f,t),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Ze<=f&&f<t},is0:f=>f===Ze,isValidNot0:f=>!h.is0(f)&&h.isValid(f),isOdd:f=>(f&Me)===Me,neg:f=>rt(-f,t),eql:(f,p)=>f===p,sqr:f=>rt(f*f,t),add:(f,p)=>rt(f+p,t),sub:(f,p)=>rt(f-p,t),mul:(f,p)=>rt(f*p,t),pow:(f,p)=>$x(h,f,p),div:(f,p)=>rt(f*Mu(p,t),t),sqrN:f=>f*f,addN:(f,p)=>f+p,subN:(f,p)=>f-p,mulN:(f,p)=>f*p,inv:f=>Mu(f,t),sqrt:s||(f=>(l||(l=Dx(t)),l(h,f))),toBytes:f=>r?Aa(f,u):Oa(f,u),fromBytes:(f,p=!0)=>{if(a){if(!a.includes(f.length)||f.length>u)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);const g=new Uint8Array(u);g.set(f,r?0:g.length-f.length),f=g}if(f.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+f.length);let d=r?Fn(f):ns(f);if(o&&(d=rt(d,t)),!p&&!h.isValid(d))throw new Error("invalid field element: outside of range 0..ORDER");return d},invertBatch:f=>td(h,f),cmov:(f,p,d)=>d?p:f});return Object.freeze(h)}function id(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function nd(t){const e=id(t);return e+Math.ceil(e/2)}function Bx(t,e,r=!1){const i=t.length,n=id(e),s=nd(e);if(i<16||i<s||i>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+i);const o=r?Fn(t):ns(t),a=rt(o,e-Me)+Me;return r?Aa(a,n):Oa(a,n)}const ni=BigInt(0),Tr=BigInt(1);function Mn(t,e){const r=e.negate();return t?r:e}function Ws(t,e){const r=td(t.Fp,e.map(i=>i.Z));return e.map((i,n)=>t.fromAffine(i.toAffine(r[n])))}function sd(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Gs(t,e){sd(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1),n=2**t,s=Zi(t),o=BigInt(t);return{windows:r,windowSize:i,mask:s,maxNumber:n,shiftBy:o}}function ju(t,e,r){const{windowSize:i,mask:n,maxNumber:s,shiftBy:o}=r;let a=Number(t&n),c=t>>o;a>i&&(a-=s,c+=Tr);const u=e*i,l=u+Math.abs(a)-1,h=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:f,isNegF:p,offsetF:u}}function Px(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function Tx(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const Ys=new WeakMap,od=new WeakMap;function Zs(t){return od.get(t)||1}function zu(t){if(t!==ni)throw new Error("invalid wNAF")}class Rx{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,i=this.ZERO){let n=e;for(;r>ni;)r&Tr&&(i=i.add(n)),n=n.double(),r>>=Tr;return i}precomputeWindow(e,r){const{windows:i,windowSize:n}=Gs(r,this.bits),s=[];let o=e,a=o;for(let c=0;c<i;c++){a=o,s.push(a);for(let u=1;u<n;u++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,r,i){if(!this.Fn.isValid(i))throw new Error("invalid scalar");let n=this.ZERO,s=this.BASE;const o=Gs(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:u,isZero:l,isNeg:h,isNegF:f,offsetF:p}=ju(i,a,o);i=c,l?s=s.add(Mn(f,r[p])):n=n.add(Mn(h,r[u]))}return zu(i),{p:n,f:s}}wNAFUnsafe(e,r,i,n=this.ZERO){const s=Gs(e,this.bits);for(let o=0;o<s.windows&&i!==ni;o++){const{nextN:a,offset:c,isZero:u,isNeg:l}=ju(i,o,s);if(i=a,!u){const h=r[c];n=n.add(l?h.negate():h)}}return zu(i),n}getPrecomputes(e,r,i){let n=Ys.get(r);return n||(n=this.precomputeWindow(r,e),e!==1&&(typeof i=="function"&&(n=i(n)),Ys.set(r,n))),n}cached(e,r,i){const n=Zs(e);return this.wNAF(n,this.getPrecomputes(n,e,i),r)}unsafe(e,r,i,n){const s=Zs(e);return s===1?this._unsafeLadder(e,r,n):this.wNAFUnsafe(s,this.getPrecomputes(s,e,i),r,n)}createCache(e,r){sd(r,this.bits),od.set(e,r),Ys.delete(e)}hasCache(e){return Zs(e)!==1}}function Cx(t,e,r,i){let n=e,s=t.ZERO,o=t.ZERO;for(;r>ni||i>ni;)r&Tr&&(s=s.add(n)),i&Tr&&(o=o.add(n)),n=n.double(),r>>=Tr,i>>=Tr;return{p1:s,p2:o}}function Nx(t,e,r,i){Px(r,t),Tx(i,e);const n=r.length,s=i.length;if(n!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Wf(BigInt(n));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=Zi(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let p=h;p>=0;p-=c){l.fill(o);for(let g=0;g<s;g++){const y=i[g],x=Number(y>>BigInt(p)&u);l[x]=l[x].add(r[g])}let d=o;for(let g=l.length-1,y=o;g>0;g--)y=y.add(l[g]),d=d.add(y);if(f=f.add(d),p!==0)for(let g=0;g<c;g++)f=f.double()}return f}function Vu(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Ax(e),e}else return mr(t,{isLE:r})}function Ux(t,e,r={},i){if(i===void 0&&(i=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>ni))throw new Error(`CURVE.${a} must be positive bigint`)}const n=Vu(e.p,r.Fp,i),s=Vu(e.n,r.Fn,i),o=["Gx","Gy","a","b"];for(const a of o)if(!n.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:n,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),$f("HashToScalar-");const wi=BigInt(0),Hr=BigInt(1),yn=BigInt(2);function kx(t){return ss(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function Lx(t){const e=kx(t),{P:r,type:i,adjustScalarBytes:n,powPminus2:s,randomBytes:o}=e,a=i==="x25519";if(!a&&i!=="x448")throw new Error("invalid type");const c=o||Mr,u=a?255:448,l=a?32:56,h=BigInt(a?9:5),f=BigInt(a?121665:39081),p=a?yn**BigInt(254):yn**BigInt(447),d=a?BigInt(8)*yn**BigInt(251)-Hr:BigInt(4)*yn**BigInt(445)-Hr,g=p+d+Hr,y=C=>rt(C,r),x=I(h);function I(C){return Aa(y(C),l)}function w(C){const D=ke("u coordinate",C,l);return a&&(D[31]&=127),y(Fn(D))}function b(C){return Fn(n(ke("scalar",C,l)))}function m(C,D){const T=B(w(D),b(C));if(T===wi)throw new Error("invalid private or public key received");return I(T)}function _(C){return m(C,x)}function A(C,D,T){const E=y(C*(D-T));return D=y(D-E),T=y(T+E),{x_2:D,x_3:T}}function B(C,D){Lo("u",C,wi,r),Lo("scalar",D,p,g);const T=D,E=C;let v=Hr,O=wi,R=C,S=Hr,P=wi;for(let L=BigInt(u-1);L>=wi;L--){const K=T>>L&Hr;P^=K,{x_2:v,x_3:R}=A(P,v,R),{x_2:O,x_3:S}=A(P,O,S),P=K;const z=v+O,j=y(z*z),H=v-O,G=y(H*H),Z=j-G,W=R+S,X=R-S,ue=y(X*z),ge=y(W*H),me=ue+ge,Le=ue-ge;R=y(me*me),S=y(E*y(Le*Le)),v=y(j*G),O=y(Z*(j+y(f*Z)))}({x_2:v,x_3:R}=A(P,v,R)),{x_2:O,x_3:S}=A(P,O,S);const k=s(O);return y(v*k)}const $={secretKey:l,publicKey:l,seed:l},N=(C=c(l))=>(vt(C,$.seed),C);function U(C){const D=N(C);return{secretKey:D,publicKey:_(D)}}return{keygen:U,getSharedSecret:(C,D)=>m(C,D),getPublicKey:C=>_(C),scalarMult:m,scalarMultBase:_,utils:{randomSecretKey:N,randomPrivateKey:N},GuBytes:x.slice(),lengths:$}}const Fx=BigInt(1),Ku=BigInt(2),Mx=BigInt(3),qx=BigInt(5);BigInt(8);const ad=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),jx={p:ad,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function zx(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),n=BigInt(80),s=ad,o=t*t%s*t%s,a=wt(o,Ku,s)*o%s,c=wt(a,Fx,s)*t%s,u=wt(c,qx,s)*c%s,l=wt(u,e,s)*u%s,h=wt(l,r,s)*l%s,f=wt(h,i,s)*h%s,p=wt(f,n,s)*f%s,d=wt(p,n,s)*f%s,g=wt(d,e,s)*u%s;return{pow_p_5_8:wt(g,Ku,s)*t%s,b2:o}}function Vx(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const Kx=mr(jx.p,{isLE:!0}),Fo=(()=>{const t=Kx.ORDER;return Lx({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:i}=zx(e);return rt(wt(r,Mx,t)*i,t)},adjustScalarBytes:Vx})})(),Hu=(t,e)=>(t+(t>=0?e:-e)/cd)/e;function Hx(t,e,r){const[[i,n],[s,o]]=e,a=Hu(o*t,r),c=Hu(-n*t,r);let u=t-a*i-c*s,l=-a*n-c*o;const h=u<Wt,f=l<Wt;h&&(u=-u),f&&(l=-l);const p=Zi(Math.ceil(Wf(r)/2))+ti;if(u<Wt||u>=p||l<Wt||l>=p)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:u,k2neg:f,k2:l}}function Mo(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function Xs(t,e){const r={};for(let i of Object.keys(e))r[i]=t[i]===void 0?e[i]:t[i];return Ln(r.lowS,"lowS"),Ln(r.prehash,"prehash"),r.format!==void 0&&Mo(r.format),r}class Wx extends Error{constructor(e=""){super(e)}}const Vt={Err:Wx,_tlv:{encode:(t,e)=>{const{Err:r}=Vt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const i=e.length/2,n=gn(i);if(n.length/2&128)throw new r("tlv.encode: long form length too big");const s=i>127?gn(n.length/2|128):"";return gn(t)+s+n+e},decode(t,e){const{Err:r}=Vt;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const n=e[i++],s=!!(n&128);let o=0;if(!s)o=n;else{const c=n&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(i,i+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(i+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=Vt;if(t<Wt)throw new e("integer: negative integers are not allowed");let r=gn(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Vt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return ns(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=Vt,n=ke("signature",t),{v:s,l:o}=i.decode(48,n);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,s),{v:u,l}=i.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=Vt,i=e.encode(2,r.encode(t.r)),n=e.encode(2,r.encode(t.s)),s=i+n;return e.encode(48,s)}},Wt=BigInt(0),ti=BigInt(1),cd=BigInt(2),wn=BigInt(3),Gx=BigInt(4);function Zr(t,e){const{BYTES:r}=t;let i;if(typeof e=="bigint")i=e;else{let n=ke("private key",e);try{i=t.fromBytes(n)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(i))throw new Error("invalid private key: out of range [1..N-1]");return i}function Yx(t,e={}){const r=Ux("weierstrass",t,e),{Fp:i,Fn:n}=r;let s=r.CURVE;const{h:o,n:a}=s;ss(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!i.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const u=ld(i,n);function l(){if(!i.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(C,D,T){const{x:E,y:v}=D.toAffine(),O=i.toBytes(E);if(Ln(T,"isCompressed"),T){l();const R=!i.isOdd(v);return hr(ud(R),O)}else return hr(Uint8Array.of(4),O,i.toBytes(v))}function f(C){Br(C,void 0,"Point");const{publicKey:D,publicKeyUncompressed:T}=u,E=C.length,v=C[0],O=C.subarray(1);if(E===D&&(v===2||v===3)){const R=i.fromBytes(O);if(!i.isValid(R))throw new Error("bad point: is not on curve, wrong x");const S=g(R);let P;try{P=i.sqrt(S)}catch(L){const K=L instanceof Error?": "+L.message:"";throw new Error("bad point: is not on curve, sqrt error"+K)}l();const k=i.isOdd(P);return(v&1)===1!==k&&(P=i.neg(P)),{x:R,y:P}}else if(E===T&&v===4){const R=i.BYTES,S=i.fromBytes(O.subarray(0,R)),P=i.fromBytes(O.subarray(R,R*2));if(!y(S,P))throw new Error("bad point: is not on curve");return{x:S,y:P}}else throw new Error(`bad point: got length ${E}, expected compressed=${D} or uncompressed=${T}`)}const p=e.toBytes||h,d=e.fromBytes||f;function g(C){const D=i.sqr(C),T=i.mul(D,C);return i.add(i.add(T,i.mul(C,s.a)),s.b)}function y(C,D){const T=i.sqr(D),E=g(C);return i.eql(T,E)}if(!y(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const x=i.mul(i.pow(s.a,wn),Gx),I=i.mul(i.sqr(s.b),BigInt(27));if(i.is0(i.add(x,I)))throw new Error("bad curve params: a or b");function w(C,D,T=!1){if(!i.isValid(D)||T&&i.is0(D))throw new Error(`bad point coordinate ${C}`);return D}function b(C){if(!(C instanceof $))throw new Error("ProjectivePoint expected")}function m(C){if(!c||!c.basises)throw new Error("no endo");return Hx(C,c.basises,n.ORDER)}const _=Fu((C,D)=>{const{X:T,Y:E,Z:v}=C;if(i.eql(v,i.ONE))return{x:T,y:E};const O=C.is0();D==null&&(D=O?i.ONE:i.inv(v));const R=i.mul(T,D),S=i.mul(E,D),P=i.mul(v,D);if(O)return{x:i.ZERO,y:i.ZERO};if(!i.eql(P,i.ONE))throw new Error("invZ was invalid");return{x:R,y:S}}),A=Fu(C=>{if(C.is0()){if(e.allowInfinityPoint&&!i.is0(C.Y))return;throw new Error("bad point: ZERO")}const{x:D,y:T}=C.toAffine();if(!i.isValid(D)||!i.isValid(T))throw new Error("bad point: x or y not field elements");if(!y(D,T))throw new Error("bad point: equation left != right");if(!C.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function B(C,D,T,E,v){return T=new $(i.mul(T.X,C),T.Y,T.Z),D=Mn(E,D),T=Mn(v,T),D.add(T)}class ${constructor(D,T,E){this.X=w("x",D),this.Y=w("y",T,!0),this.Z=w("z",E),Object.freeze(this)}static CURVE(){return s}static fromAffine(D){const{x:T,y:E}=D||{};if(!D||!i.isValid(T)||!i.isValid(E))throw new Error("invalid affine point");if(D instanceof $)throw new Error("projective point not allowed");return i.is0(T)&&i.is0(E)?$.ZERO:new $(T,E,i.ONE)}static fromBytes(D){const T=$.fromAffine(d(Br(D,void 0,"point")));return T.assertValidity(),T}static fromHex(D){return $.fromBytes(ke("pointHex",D))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(D=8,T=!0){return U.createCache(this,D),T||this.multiply(wn),this}assertValidity(){A(this)}hasEvenY(){const{y:D}=this.toAffine();if(!i.isOdd)throw new Error("Field doesn't support isOdd");return!i.isOdd(D)}equals(D){b(D);const{X:T,Y:E,Z:v}=this,{X:O,Y:R,Z:S}=D,P=i.eql(i.mul(T,S),i.mul(O,v)),k=i.eql(i.mul(E,S),i.mul(R,v));return P&&k}negate(){return new $(this.X,i.neg(this.Y),this.Z)}double(){const{a:D,b:T}=s,E=i.mul(T,wn),{X:v,Y:O,Z:R}=this;let S=i.ZERO,P=i.ZERO,k=i.ZERO,L=i.mul(v,v),K=i.mul(O,O),z=i.mul(R,R),j=i.mul(v,O);return j=i.add(j,j),k=i.mul(v,R),k=i.add(k,k),S=i.mul(D,k),P=i.mul(E,z),P=i.add(S,P),S=i.sub(K,P),P=i.add(K,P),P=i.mul(S,P),S=i.mul(j,S),k=i.mul(E,k),z=i.mul(D,z),j=i.sub(L,z),j=i.mul(D,j),j=i.add(j,k),k=i.add(L,L),L=i.add(k,L),L=i.add(L,z),L=i.mul(L,j),P=i.add(P,L),z=i.mul(O,R),z=i.add(z,z),L=i.mul(z,j),S=i.sub(S,L),k=i.mul(z,K),k=i.add(k,k),k=i.add(k,k),new $(S,P,k)}add(D){b(D);const{X:T,Y:E,Z:v}=this,{X:O,Y:R,Z:S}=D;let P=i.ZERO,k=i.ZERO,L=i.ZERO;const K=s.a,z=i.mul(s.b,wn);let j=i.mul(T,O),H=i.mul(E,R),G=i.mul(v,S),Z=i.add(T,E),W=i.add(O,R);Z=i.mul(Z,W),W=i.add(j,H),Z=i.sub(Z,W),W=i.add(T,v);let X=i.add(O,S);return W=i.mul(W,X),X=i.add(j,G),W=i.sub(W,X),X=i.add(E,v),P=i.add(R,S),X=i.mul(X,P),P=i.add(H,G),X=i.sub(X,P),L=i.mul(K,W),P=i.mul(z,G),L=i.add(P,L),P=i.sub(H,L),L=i.add(H,L),k=i.mul(P,L),H=i.add(j,j),H=i.add(H,j),G=i.mul(K,G),W=i.mul(z,W),H=i.add(H,G),G=i.sub(j,G),G=i.mul(K,G),W=i.add(W,G),j=i.mul(H,W),k=i.add(k,j),j=i.mul(X,W),P=i.mul(Z,P),P=i.sub(P,j),j=i.mul(Z,H),L=i.mul(X,L),L=i.add(L,j),new $(P,k,L)}subtract(D){return this.add(D.negate())}is0(){return this.equals($.ZERO)}multiply(D){const{endo:T}=e;if(!n.isValidNot0(D))throw new Error("invalid scalar: out of range");let E,v;const O=R=>U.cached(this,R,S=>Ws($,S));if(T){const{k1neg:R,k1:S,k2neg:P,k2:k}=m(D),{p:L,f:K}=O(S),{p:z,f:j}=O(k);v=K.add(j),E=B(T.beta,L,z,R,P)}else{const{p:R,f:S}=O(D);E=R,v=S}return Ws($,[E,v])[0]}multiplyUnsafe(D){const{endo:T}=e,E=this;if(!n.isValid(D))throw new Error("invalid scalar: out of range");if(D===Wt||E.is0())return $.ZERO;if(D===ti)return E;if(U.hasCache(this))return this.multiply(D);if(T){const{k1neg:v,k1:O,k2neg:R,k2:S}=m(D),{p1:P,p2:k}=Cx($,E,O,S);return B(T.beta,P,k,v,R)}else return U.unsafe(E,D)}multiplyAndAddUnsafe(D,T,E){const v=this.multiplyUnsafe(T).add(D.multiplyUnsafe(E));return v.is0()?void 0:v}toAffine(D){return _(this,D)}isTorsionFree(){const{isTorsionFree:D}=e;return o===ti?!0:D?D($,this):U.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:D}=e;return o===ti?this:D?D($,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(D=!0){return Ln(D,"isCompressed"),this.assertValidity(),p($,this,D)}toHex(D=!0){return ei(this.toBytes(D))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(D=!0){return this.toBytes(D)}_setWindowSize(D){this.precompute(D)}static normalizeZ(D){return Ws($,D)}static msm(D,T){return Nx($,n,D,T)}static fromPrivateKey(D){return $.BASE.multiply(Zr(n,D))}}$.BASE=new $(s.Gx,s.Gy,i.ONE),$.ZERO=new $(i.ZERO,i.ONE,i.ZERO),$.Fp=i,$.Fn=n;const N=n.BITS,U=new Rx($,e.endo?Math.ceil(N/2):N);return $.BASE.precompute(8),$}function ud(t){return Uint8Array.of(t?2:3)}function ld(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function Zx(t,e={}){const{Fn:r}=t,i=e.randomBytes||Mr,n=Object.assign(ld(t.Fp,r),{seed:nd(r.ORDER)});function s(f){try{return!!Zr(r,f)}catch{return!1}}function o(f,p){const{publicKey:d,publicKeyUncompressed:g}=n;try{const y=f.length;return p===!0&&y!==d||p===!1&&y!==g?!1:!!t.fromBytes(f)}catch{return!1}}function a(f=i(n.seed)){return Bx(Br(f,n.seed,"seed"),r.ORDER)}function c(f,p=!0){return t.BASE.multiply(Zr(r,f)).toBytes(p)}function u(f){const p=a(f);return{secretKey:p,publicKey:c(p)}}function l(f){if(typeof f=="bigint")return!1;if(f instanceof t)return!0;const{secretKey:p,publicKey:d,publicKeyUncompressed:g}=n;if(r.allowedLengths||p===d)return;const y=ke("key",f).length;return y===d||y===g}function h(f,p,d=!0){if(l(f)===!0)throw new Error("first arg must be private key");if(l(p)===!1)throw new Error("second arg must be public key");const g=Zr(r,f);return t.fromHex(p).multiply(g).toBytes(d)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:u,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:f=>Zr(r,f),precompute(f=8,p=t.BASE){return p.precompute(f,!1)}},lengths:n})}function Xx(t,e,r={}){Jn(e),ss(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const i=r.randomBytes||Mr,n=r.hmac||((T,...E)=>rs(e,T,hr(...E))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:u,getPublicKey:l,getSharedSecret:h,utils:f,lengths:p}=Zx(t,r),d={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},g="compact";function y(T){const E=a>>ti;return T>E}function x(T,E){if(!o.isValidNot0(E))throw new Error(`invalid signature ${T}: out of range 1..Point.Fn.ORDER`);return E}function I(T,E){Mo(E);const v=p.signature,O=E==="compact"?v:E==="recovered"?v+1:void 0;return Br(T,O,`${E} signature`)}class w{constructor(E,v,O){this.r=x("r",E),this.s=x("s",v),O!=null&&(this.recovery=O),Object.freeze(this)}static fromBytes(E,v=g){I(E,v);let O;if(v==="der"){const{r:k,s:L}=Vt.toSig(Br(E));return new w(k,L)}v==="recovered"&&(O=E[0],v="compact",E=E.subarray(1));const R=o.BYTES,S=E.subarray(0,R),P=E.subarray(R,R*2);return new w(o.fromBytes(S),o.fromBytes(P),O)}static fromHex(E,v){return this.fromBytes(Un(E),v)}addRecoveryBit(E){return new w(this.r,this.s,E)}recoverPublicKey(E){const v=s.ORDER,{r:O,s:R,recovery:S}=this;if(S==null||![0,1,2,3].includes(S))throw new Error("recovery id invalid");if(a*cd<v&&S>1)throw new Error("recovery id is ambiguous for h>1 curve");const P=S===2||S===3?O+a:O;if(!s.isValid(P))throw new Error("recovery id 2 or 3 invalid");const k=s.toBytes(P),L=t.fromBytes(hr(ud((S&1)===0),k)),K=o.inv(P),z=m(ke("msgHash",E)),j=o.create(-z*K),H=o.create(R*K),G=t.BASE.multiplyUnsafe(j).add(L.multiplyUnsafe(H));if(G.is0())throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return y(this.s)}toBytes(E=g){if(Mo(E),E==="der")return Un(Vt.hexFromSig(this));const v=o.toBytes(this.r),O=o.toBytes(this.s);if(E==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return hr(Uint8Array.of(this.recovery),v,O)}return hr(v,O)}toHex(E){return ei(this.toBytes(E))}assertValidity(){}static fromCompact(E){return w.fromBytes(ke("sig",E),"compact")}static fromDER(E){return w.fromBytes(ke("sig",E),"der")}normalizeS(){return this.hasHighS()?new w(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return ei(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return ei(this.toBytes("compact"))}}const b=r.bits2int||function(T){if(T.length>8192)throw new Error("input is too large");const E=ns(T),v=T.length*8-c;return v>0?E>>BigInt(v):E},m=r.bits2int_modN||function(T){return o.create(b(T))},_=Zi(c);function A(T){return Lo("num < 2^"+c,T,Wt,_),o.toBytes(T)}function B(T,E){return Br(T,void 0,"message"),E?Br(e(T),void 0,"prehashed message"):T}function $(T,E,v){if(["recovered","canonical"].some(H=>H in v))throw new Error("sign() legacy options not supported");const{lowS:O,prehash:R,extraEntropy:S}=Xs(v,d);T=B(T,R);const P=m(T),k=Zr(o,E),L=[A(k),A(P)];if(S!=null&&S!==!1){const H=S===!0?i(p.secretKey):S;L.push(ke("extraEntropy",H))}const K=hr(...L),z=P;function j(H){const G=b(H);if(!o.isValidNot0(G))return;const Z=o.inv(G),W=t.BASE.multiply(G).toAffine(),X=o.create(W.x);if(X===Wt)return;const ue=o.create(Z*o.create(z+X*k));if(ue===Wt)return;let ge=(W.x===X?0:2)|Number(W.y&ti),me=ue;return O&&y(ue)&&(me=o.neg(ue),ge^=1),new w(X,me,ge)}return{seed:K,k2sig:j}}function N(T,E,v={}){T=ke("message",T);const{seed:O,k2sig:R}=$(T,E,v);return Ex(e.outputLen,o.BYTES,n)(O,R)}function U(T){let E;const v=typeof T=="string"||Xn(T),O=!v&&T!==null&&typeof T=="object"&&typeof T.r=="bigint"&&typeof T.s=="bigint";if(!v&&!O)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(O)E=new w(T.r,T.s);else if(v){try{E=w.fromBytes(ke("sig",T),"der")}catch(R){if(!(R instanceof Vt.Err))throw R}if(!E)try{E=w.fromBytes(ke("sig",T),"compact")}catch{return!1}}return E||!1}function C(T,E,v,O={}){const{lowS:R,prehash:S,format:P}=Xs(O,d);if(v=ke("publicKey",v),E=B(ke("message",E),S),"strict"in O)throw new Error("options.strict was renamed to lowS");const k=P===void 0?U(T):w.fromBytes(ke("sig",T),P);if(k===!1)return!1;try{const L=t.fromBytes(v);if(R&&k.hasHighS())return!1;const{r:K,s:z}=k,j=m(E),H=o.inv(z),G=o.create(j*H),Z=o.create(K*H),W=t.BASE.multiplyUnsafe(G).add(L.multiplyUnsafe(Z));return W.is0()?!1:o.create(W.x)===K}catch{return!1}}function D(T,E,v={}){const{prehash:O}=Xs(v,d);return E=B(E,O),w.fromBytes(T,"recovered").recoverPublicKey(E).toBytes()}return Object.freeze({keygen:u,getPublicKey:l,getSharedSecret:h,utils:f,lengths:p,Point:t,sign:N,verify:C,recoverPublicKey:D,Signature:w,hash:e})}function Jx(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let i=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const n=mr(e.n,{BITS:t.nBitLength,allowedLengths:i,modFromBytes:t.wrapPrivateKey}),s={Fp:r,Fn:n,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function Qx(t){const{CURVE:e,curveOpts:r}=Jx(t),i={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:i}}function e3(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,rd(r.Fn.ORDER,r.Fn.BITS))})}function t3(t){const{CURVE:e,curveOpts:r,hash:i,ecdsaOpts:n}=Qx(t),s=Yx(e,r),o=Xx(s,i,n);return e3(t,o)}function qo(t,e){const r=i=>t3({...t,hash:i});return{...r(e),create:r}}const hd={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},fd={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},dd={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},r3=mr(hd.p),i3=mr(fd.p),n3=mr(dd.p),s3=qo({...hd,Fp:r3,lowS:!1},es);qo({...fd,Fp:i3,lowS:!1},lE),qo({...dd,Fp:n3,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},uE);const o3=s3,pd="base10",qe="base16",Ge="base64pad",fr="base64url",Xi="utf8",gd=0,Yt=1,Ji=2,a3=0,Wu=1,Ai=12,Ba=32;function c3(){const t=Fo.utils.randomPrivateKey(),e=Fo.getPublicKey(t);return{privateKey:Xe(t,qe),publicKey:Xe(e,qe)}}function jo(){const t=Mr(Ba);return Xe(t,qe)}function u3(t,e){const r=Fo.getSharedSecret(ft(t,qe),ft(e,qe)),i=mx(is,r,void 0,void 0,Ba);return Xe(i,qe)}function In(t){const e=is(ft(t,qe));return Xe(e,qe)}function lt(t){const e=is(ft(t,Xi));return Xe(e,qe)}function yd(t){return ft(`${t}`,pd)}function Ur(t){return Number(Xe(t,pd))}function wd(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function bd(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function l3(t){const e=yd(typeof t.type<"u"?t.type:gd);if(Ur(e)===Yt&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?ft(t.senderPublicKey,qe):void 0,i=typeof t.iv<"u"?ft(t.iv,qe):Mr(Ai),n=ft(t.symKey,qe),s=Vf(n,i).encrypt(ft(t.message,Xi)),o=md({type:e,sealed:s,iv:i,senderPublicKey:r});return t.encoding===fr?wd(o):o}function h3(t){const e=ft(t.symKey,qe),{sealed:r,iv:i}=Li({encoded:t.encoded,encoding:t.encoding}),n=Vf(e,i).decrypt(r);if(n===null)throw new Error("Failed to decrypt");return Xe(n,Xi)}function f3(t,e){const r=yd(Ji),i=Mr(Ai),n=ft(t,Xi),s=md({type:r,sealed:n,iv:i});return e===fr?wd(s):s}function d3(t,e){const{sealed:r}=Li({encoded:t,encoding:e});return Xe(r,Xi)}function md(t){if(Ur(t.type)===Ji)return Xe(Oi([t.type,t.sealed]),Ge);if(Ur(t.type)===Yt){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Xe(Oi([t.type,t.senderPublicKey,t.iv,t.sealed]),Ge)}return Xe(Oi([t.type,t.iv,t.sealed]),Ge)}function Li(t){const e=(t.encoding||Ge)===fr?bd(t.encoded):t.encoded,r=ft(e,Ge),i=r.slice(a3,Wu),n=Wu;if(Ur(i)===Yt){const c=n+Ba,u=c+Ai,l=r.slice(n,c),h=r.slice(c,u),f=r.slice(u);return{type:i,sealed:f,iv:h,senderPublicKey:l}}if(Ur(i)===Ji){const c=r.slice(n),u=Mr(Ai);return{type:i,sealed:c,iv:u}}const s=n+Ai,o=r.slice(n,s),a=r.slice(s);return{type:i,sealed:a,iv:o}}function p3(t,e){const r=Li({encoded:t,encoding:e?.encoding});return vd({type:Ur(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Xe(r.senderPublicKey,qe):void 0,receiverPublicKey:e?.receiverPublicKey})}function vd(t){const e=t?.type||gd;if(e===Yt){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function Gu(t){return t.type===Yt&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Yu(t){return t.type===Ji}function g3(t){const e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return Oi([new Uint8Array([4]),e,r])}function y3(t,e){const[r,i,n]=t.split("."),s=Buffer.from(bd(n),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${r}.${i}`,u=is(c),l=g3(e);if(!o3.verify(Oi([o,a]),u,l))throw new Error("Invalid signature");return Eo(t).payload}const w3="irn";function qn(t){return t?.relay||{protocol:w3}}function Xr(t){const e=Xv[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var b3=Object.defineProperty,m3=Object.defineProperties,v3=Object.getOwnPropertyDescriptors,Zu=Object.getOwnPropertySymbols,E3=Object.prototype.hasOwnProperty,x3=Object.prototype.propertyIsEnumerable,Xu=(t,e,r)=>e in t?b3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Js=(t,e)=>{for(var r in e||(e={}))E3.call(e,r)&&Xu(t,r,e[r]);if(Zu)for(var r of Zu(e))x3.call(e,r)&&Xu(t,r,e[r]);return t},_3=(t,e)=>m3(t,v3(e));function I3(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(n=>{if(n.startsWith(i)){const s=n.replace(i,""),o=t[n];r[s]=o}}),r}function Ju(t){if(!t.includes("wc:")){const u=_f(t);u!=null&&u.includes("wc:")&&(t=u)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),n=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(s),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:i,topic:S3(n[0]),version:parseInt(n[1],10),symKey:a.symKey,relay:I3(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function S3(t){return t.startsWith("//")?t.substring(2):t}function D3(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(n=>{const s=n,o=r+e+s;t[s]&&(i[o]=t[s])}),i}function Qu(t){const e=new URLSearchParams,r=Js(Js(_3(Js({},D3(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(r).sort(([i],[n])=>i.localeCompare(n)).forEach(([i,n])=>{n!==void 0&&e.append(i,String(n))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function bn(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var O3=Object.defineProperty,A3=Object.defineProperties,$3=Object.getOwnPropertyDescriptors,el=Object.getOwnPropertySymbols,B3=Object.prototype.hasOwnProperty,P3=Object.prototype.propertyIsEnumerable,tl=(t,e,r)=>e in t?O3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,T3=(t,e)=>{for(var r in e||(e={}))B3.call(e,r)&&tl(t,r,e[r]);if(el)for(var r of el(e))P3.call(e,r)&&tl(t,r,e[r]);return t},R3=(t,e)=>A3(t,$3(e));function ci(t){const e=[];return t.forEach(r=>{const[i,n]=r.split(":");e.push(`${i}:${n}`)}),e}function Ed(t){const e=[];return Object.values(t).forEach(r=>{e.push(...ci(r.accounts))}),[...new Set(e)]}function C3(t){const e=[];return Object.values(t).forEach(r=>{e.push(...r.methods)}),[...new Set(e)]}function N3(t){const e=[];return Object.values(t).forEach(r=>{e.push(...r.events)}),[...new Set(e)]}function U3(t,e){const r=[];return Object.values(t).forEach(i=>{ci(i.accounts).includes(e)&&r.push(...i.methods)}),r}function k3(t,e){const r=[];return Object.values(t).forEach(i=>{ci(i.accounts).includes(e)&&r.push(...i.events)}),r}function xd(t){return t.includes(":")}function L3(t){return xd(t)?t.split(":")[0]:t}function rl(t){var e,r,i;const n={};if(!Fi(t))return n;for(const[s,o]of Object.entries(t)){const a=xd(s)?[s]:o.chains,c=o.methods||[],u=o.events||[],l=L3(s);n[l]=R3(T3({},n[l]),{chains:Cr(a,(e=n[l])==null?void 0:e.chains),methods:Cr(c,(r=n[l])==null?void 0:r.methods),events:Cr(u,(i=n[l])==null?void 0:i.events)})}return n}function F3(t){const e={};return t?.forEach(r=>{var i;const[n,s]=r.split(":");e[n]||(e[n]={accounts:[],chains:[],events:[],methods:[]}),e[n].accounts.push(r),(i=e[n].chains)==null||i.push(`${n}:${s}`)}),e}function il(t,e){e=e.map(i=>i.replace("did:pkh:",""));const r=F3(e);for(const[i,n]of Object.entries(r))n.methods?n.methods=Cr(n.methods,t):n.methods=t,n.events=["chainChanged","accountsChanged"];return r}function M3(t,e){var r,i,n,s,o,a;const c=rl(t),u=rl(e),l={},h=Object.keys(c).concat(Object.keys(u));for(const f of h)l[f]={chains:Cr((r=c[f])==null?void 0:r.chains,(i=u[f])==null?void 0:i.chains),methods:Cr((n=c[f])==null?void 0:n.methods,(s=u[f])==null?void 0:s.methods),events:Cr((o=c[f])==null?void 0:o.events,(a=u[f])==null?void 0:a.events)};return l}const q3={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},j3={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function q(t,e){const{message:r,code:i}=j3[t];return{message:e?`${r} ${e}`:r,code:i}}function le(t,e){const{message:r,code:i}=q3[t];return{message:e?`${r} ${e}`:r,code:i}}function si(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Fi(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Ie(t){return typeof t>"u"}function pe(t,e){return e&&Ie(t)?!0:typeof t=="string"&&!!t.trim().length}function Pa(t,e){return typeof t=="number"&&!isNaN(t)}function z3(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),n=Object.keys(r);let s=!0;return $r(n,i)?(i.forEach(o=>{const{accounts:a,methods:c,events:u}=t.namespaces[o],l=ci(a),h=r[o];(!$r(bf(o,h),l)||!$r(h.methods,c)||!$r(h.events,u))&&(s=!1)}),s):!1}function jn(t){return pe(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function V3(t){if(pe(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&jn(r)}}return!1}function K3(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(pe(t,!1)){if(e(t))return!0;const r=_f(t);return e(r)}}catch{}return!1}function H3(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function W3(t){return t?.topic}function G3(t,e){let r=null;return pe(t?.publicKey,!1)||(r=q("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function nl(t){let e=!0;return si(t)?t.length&&(e=t.every(r=>pe(r,!1))):e=!1,e}function Y3(t,e,r){let i=null;return si(e)&&e.length?e.forEach(n=>{i||jn(n)||(i=le("UNSUPPORTED_CHAINS",`${r}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):jn(t)||(i=le("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function Z3(t,e,r){let i=null;return Object.entries(t).forEach(([n,s])=>{if(i)return;const o=Y3(n,bf(n,s),`${e} ${r}`);o&&(i=o)}),i}function X3(t,e){let r=null;return si(t)?t.forEach(i=>{r||V3(i)||(r=le("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=le("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function J3(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=X3(i?.accounts,`${e} namespace`);n&&(r=n)}),r}function Q3(t,e){let r=null;return nl(t?.methods)?nl(t?.events)||(r=le("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=le("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function _d(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=Q3(i,`${e}, namespace`);n&&(r=n)}),r}function e_(t,e,r){let i=null;if(t&&Fi(t)){const n=_d(t,e);n&&(i=n);const s=Z3(t,e,r);s&&(i=s)}else i=q("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function Qs(t,e){let r=null;if(t&&Fi(t)){const i=_d(t,e);i&&(r=i);const n=J3(t,e);n&&(r=n)}else r=q("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function Id(t){return pe(t.protocol,!0)}function t_(t,e){let r=!1;return t?t&&si(t)&&t.length&&t.forEach(i=>{r=Id(i)}):r=!0,r}function r_(t){return typeof t=="number"}function Ke(t){return typeof t<"u"&&typeof t!==null}function i_(t){return!(!t||typeof t!="object"||!t.code||!Pa(t.code)||!t.message||!pe(t.message,!1))}function n_(t){return!(Ie(t)||!pe(t.method,!1))}function s_(t){return!(Ie(t)||Ie(t.result)&&Ie(t.error)||!Pa(t.id)||!pe(t.jsonrpc,!1))}function o_(t){return!(Ie(t)||!pe(t.name,!1))}function sl(t,e){return!(!jn(e)||!Ed(t).includes(e))}function a_(t,e,r){return pe(r,!1)?U3(t,e).includes(r):!1}function c_(t,e,r){return pe(r,!1)?k3(t,e).includes(r):!1}function ol(t,e,r){let i=null;const n=u_(t),s=l_(e),o=Object.keys(n),a=Object.keys(s),c=al(Object.keys(t)),u=al(Object.keys(e)),l=c.filter(h=>!u.includes(h));return l.length&&(i=q("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${l.toString()}
      Received: ${Object.keys(e).toString()}`)),$r(o,a)||(i=q("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||i)return;const f=ci(e[h].accounts);f.includes(h)||(i=q("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${f.toString()}`))}),o.forEach(h=>{i||($r(n[h].methods,s[h].methods)?$r(n[h].events,s[h].events)||(i=q("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${h}`)):i=q("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${h}`))}),i}function u_(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(n=>{e[n]={methods:t[r].methods,events:t[r].events}})}),e}function al(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function l_(t){const e={};return Object.keys(t).forEach(r=>{r.includes(":")?e[r]=t[r]:ci(t[r].accounts)?.forEach(n=>{e[n]={accounts:t[r].accounts.filter(s=>s.includes(`${n}:`)),methods:t[r].methods,events:t[r].events}})}),e}function h_(t,e){return Pa(t)&&t<=e.max&&t>=e.min}function cl(){const t=Gi();return new Promise(e=>{switch(t){case it.browser:e(f_());break;case it.reactNative:e(d_());break;case it.node:e(p_());break;default:e(!0)}})}function f_(){return ai()&&navigator?.onLine}async function d_(){return br()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function p_(){return!0}function g_(t){switch(Gi()){case it.browser:y_(t);break;case it.reactNative:w_(t);break}}function y_(t){!br()&&ai()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function w_(t){br()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function b_(){var t;return ai()&&Zt.getDocument()?((t=Zt.getDocument())==null?void 0:t.visibilityState)==="visible":!0}const eo={};class bi{static get(e){return eo[e]}static set(e,r){eo[e]=r}static delete(e){delete eo[e]}}function m_(t){const e=Hi.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function v_({publicKey:t,signature:e,payload:r}){var i;const n=zo(r.method),s=128|parseInt(((i=r.version)==null?void 0:i.toString())||"4"),o=__(r.address),a=r.era==="00"?new Uint8Array([0]):zo(r.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(r.nonce,16),u=new Uint8Array([c&255,c>>8&255]),l=BigInt(`0x${x_(r.tip)}`),h=S_(l),f=new Uint8Array([0,...t,o,...e,...a,...u,...h,...n]),p=I_(f.length+1);return new Uint8Array([...p,s,...f])}function E_(t){const e=zo(t),r=t2.blake2b(e,void 0,32);return"0x"+Buffer.from(r).toString("hex")}function zo(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function x_(t){return t.startsWith("0x")?t.slice(2):t}function __(t){const e=Hi.decode(t)[0];return e===42?0:e===60?2:1}function I_(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function S_(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function D_(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),r=m_(t.transaction.address),i=v_({publicKey:r,signature:e,payload:t.transaction}),n=Buffer.from(i).toString("hex");return E_(n)}function Sd({logger:t,name:e}){const r=typeof t=="string"?Jl({opts:{level:t,name:e}}).logger:t;return r.level=typeof t=="string"?t:t.level,r}const O_="PARSE_ERROR",A_="INVALID_REQUEST",$_="METHOD_NOT_FOUND",B_="INVALID_PARAMS",Dd="INTERNAL_ERROR",Ta="SERVER_ERROR",P_=[-32700,-32600,-32601,-32602,-32603],$i={[O_]:{code:-32700,message:"Parse error"},[A_]:{code:-32600,message:"Invalid Request"},[$_]:{code:-32601,message:"Method not found"},[B_]:{code:-32602,message:"Invalid params"},[Dd]:{code:-32603,message:"Internal error"},[Ta]:{code:-32e3,message:"Server error"}},Od=Ta;function T_(t){return P_.includes(t)}function ul(t){return Object.keys($i).includes(t)?$i[t]:$i[Od]}function R_(t){const e=Object.values($i).find(r=>r.code===t);return e||$i[Od]}function C_(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var to={},Lt={},ll;function N_(){if(ll)return Lt;ll=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.isBrowserCryptoAvailable=Lt.getSubtleCrypto=Lt.getBrowerCrypto=void 0;function t(){return(jr===null||jr===void 0?void 0:jr.crypto)||(jr===null||jr===void 0?void 0:jr.msCrypto)||{}}Lt.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}Lt.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return Lt.isBrowserCryptoAvailable=r,Lt}var Ft={},hl;function U_(){if(hl)return Ft;hl=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.isBrowser=Ft.isNode=Ft.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Ft.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Ft.isNode=e;function r(){return!t()&&!e()}return Ft.isBrowser=r,Ft}var fl;function k_(){return fl||(fl=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Mi;e.__exportStar(N_(),t),e.__exportStar(U_(),t)})(to)),to}var L_=k_();function At(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function pr(t=6){return BigInt(At(t))}function Kt(t,e,r){return{id:r||At(),jsonrpc:"2.0",method:t,params:e}}function zn(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Ra(t,e,r){return{id:t,jsonrpc:"2.0",error:F_(e)}}function F_(t,e){return typeof t>"u"?ul(Dd):(typeof t=="string"&&(t=Object.assign(Object.assign({},ul(Ta)),{message:t})),T_(t.code)&&(t=R_(t.code)),t)}class M_{}class q_ extends M_{constructor(){super()}}class j_ extends q_{constructor(e){super()}}const z_="^wss?:";function V_(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function K_(t,e){const r=V_(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function dl(t){return K_(t,z_)}function H_(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Ad(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function Ca(t){return Ad(t)&&"method"in t}function os(t){return Ad(t)&&($t(t)||ht(t))}function $t(t){return"result"in t}function ht(t){return"error"in t}class W_ extends j_{constructor(e){super(e),this.events=new Et.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(Kt(e.method,e.params||[],e.id||pr().toString()),r)}async requestStrict(e,r){return new Promise(async(i,n)=>{if(!this.connection.connected)try{await this.open()}catch(s){n(s)}this.events.on(`${e.id}`,s=>{ht(s)?n(s.error):i(s.result)});try{await this.connection.send(e,r)}catch(s){n(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),os(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const G_=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Y_=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",pl=t=>t.split("?")[0],gl=10,Z_=G_();let X_=class{constructor(e){if(this.url=e,this.events=new Et.EventEmitter,this.registering=!1,!dl(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(ji(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!dl(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),n(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const n=L_.isReactNative()?void 0:{rejectUnauthorized:!H_(e)},s=new Z_(e,[],n);Y_()?s.onerror=o=>{const a=o;i(this.emitError(a.error))}:s.on("error",o=>{i(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),r(s)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?ri(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),s=Ra(e,n);this.events.emit("payload",s)}parseError(e,r=this.url){return C_(e,pl(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>gl&&this.events.setMaxListeners(gl)}emitError(e){const r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${pl(this.url)}`));return this.events.emit("register_error",r),r}};var J_={};const $d="wc",Bd=2,Vo="core",Tt=`${$d}@2:${Vo}:`,Q_={logger:"error"},eI={database:":memory:"},tI="crypto",yl="client_ed25519_seed",rI=M.ONE_DAY,iI="keychain",nI="0.3",sI="messages",oI="0.3",aI=M.SIX_HOURS,cI="publisher",Pd="irn",uI="error",Td="wss://relay.walletconnect.org",lI="relayer",de={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},hI="_subscription",ot={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},fI=.1,Ko="2.23.1",ae={link_mode:"link_mode",relay:"relay"},Sn={inbound:"inbound",outbound:"outbound"},dI="0.3",pI="WALLETCONNECT_CLIENT_ID",wl="WALLETCONNECT_LINK_MODE_APPS",et={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},gI="subscription",yI="0.3",wI="pairing",bI="0.3",mi={wc_pairingDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:M.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:M.ONE_DAY,prompt:!1,tag:0},res:{ttl:M.ONE_DAY,prompt:!1,tag:0}}},Or={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},gt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},mI="history",vI="0.3",EI="expirer",ct={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},xI="0.3",_I="verify-api",II="https://verify.walletconnect.com",Rd="https://verify.walletconnect.org",Bi=Rd,SI=`${Bi}/v3`,DI=[II,Rd],OI="echo",AI="https://echo.walletconnect.com",Ot={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},qt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},yt={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},_r={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},Ir={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},vi={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},$I=.1,BI="event-client",PI=86400,TI="https://pulse.walletconnect.org/batch";function RI(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,y=0,x=0,I=d.length;x!==I&&d[x]===0;)x++,g++;for(var w=(I-x)*l+1>>>0,b=new Uint8Array(w);x!==I;){for(var m=d[x],_=0,A=w-1;(m!==0||_<y)&&A!==-1;A--,_++)m+=256*b[A]>>>0,b[A]=m%a>>>0,m=m/a>>>0;if(m!==0)throw new Error("Non-zero carry");y=_,x++}for(var B=w-y;B!==w&&b[B]===0;)B++;for(var $=c.repeat(g);B<w;++B)$+=t.charAt(b[B]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var y=0,x=0;d[g]===c;)y++,g++;for(var I=(d.length-g)*u+1>>>0,w=new Uint8Array(I);d[g];){var b=r[d.charCodeAt(g)];if(b===255)return;for(var m=0,_=I-1;(b!==0||m<x)&&_!==-1;_--,m++)b+=a*w[_]>>>0,w[_]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");x=m,g++}if(d[g]!==" "){for(var A=I-x;A!==I&&w[A]===0;)A++;for(var B=new Uint8Array(y+(I-A)),$=y;A!==I;)B[$++]=w[A++];return B}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var CI=RI,NI=CI;const Cd=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},UI=t=>new TextEncoder().encode(t),kI=t=>new TextDecoder().decode(t);class LI{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class FI{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Nd(this,e)}}class MI{constructor(e){this.decoders=e}or(e){return Nd(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Nd=(t,e)=>new MI({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class qI{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new LI(e,r,i),this.decoder=new FI(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const as=({name:t,prefix:e,encode:r,decode:i})=>new qI(t,e,r,i),Qi=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=NI(r,e);return as({prefix:t,name:e,encode:i,decode:s=>Cd(n(s))})},jI=(t,e,r,i)=>{const n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=n[t[l]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},zI=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[n&a>>o];if(o&&(s+=e[n&a<<r-o]),i)for(;s.length*r&7;)s+="=";return s},Te=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>as({prefix:e,name:t,encode(n){return zI(n,i,r)},decode(n){return jI(n,i,r,t)}}),VI=as({prefix:"\0",name:"identity",encode:t=>kI(t),decode:t=>UI(t)});var KI=Object.freeze({__proto__:null,identity:VI});const HI=Te({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var WI=Object.freeze({__proto__:null,base2:HI});const GI=Te({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var YI=Object.freeze({__proto__:null,base8:GI});const ZI=Qi({prefix:"9",name:"base10",alphabet:"0123456789"});var XI=Object.freeze({__proto__:null,base10:ZI});const JI=Te({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),QI=Te({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var e8=Object.freeze({__proto__:null,base16:JI,base16upper:QI});const t8=Te({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),r8=Te({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),i8=Te({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),n8=Te({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),s8=Te({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),o8=Te({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),a8=Te({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),c8=Te({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),u8=Te({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var l8=Object.freeze({__proto__:null,base32:t8,base32upper:r8,base32pad:i8,base32padupper:n8,base32hex:s8,base32hexupper:o8,base32hexpad:a8,base32hexpadupper:c8,base32z:u8});const h8=Qi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),f8=Qi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var d8=Object.freeze({__proto__:null,base36:h8,base36upper:f8});const p8=Qi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),g8=Qi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var y8=Object.freeze({__proto__:null,base58btc:p8,base58flickr:g8});const w8=Te({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),b8=Te({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),m8=Te({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),v8=Te({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var E8=Object.freeze({__proto__:null,base64:w8,base64pad:b8,base64url:m8,base64urlpad:v8});const Ud=Array.from(""),x8=Ud.reduce((t,e,r)=>(t[r]=e,t),[]),_8=Ud.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function I8(t){return t.reduce((e,r)=>(e+=x8[r],e),"")}function S8(t){const e=[];for(const r of t){const i=_8[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const D8=as({prefix:"",name:"base256emoji",encode:I8,decode:S8});var O8=Object.freeze({__proto__:null,base256emoji:D8}),A8=kd,bl=128,$8=-128,B8=Math.pow(2,31);function kd(t,e,r){e=e||[],r=r||0;for(var i=r;t>=B8;)e[r++]=t&255|bl,t/=128;for(;t&$8;)e[r++]=t&255|bl,t>>>=7;return e[r]=t|0,kd.bytes=r-i+1,e}var P8=Ho,T8=128,ml=127;function Ho(t,i){var r=0,i=i||0,n=0,s=i,o,a=t.length;do{if(s>=a)throw Ho.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=n<28?(o&ml)<<n:(o&ml)*Math.pow(2,n),n+=7}while(o>=T8);return Ho.bytes=s-i,r}var R8=Math.pow(2,7),C8=Math.pow(2,14),N8=Math.pow(2,21),U8=Math.pow(2,28),k8=Math.pow(2,35),L8=Math.pow(2,42),F8=Math.pow(2,49),M8=Math.pow(2,56),q8=Math.pow(2,63),j8=function(t){return t<R8?1:t<C8?2:t<N8?3:t<U8?4:t<k8?5:t<L8?6:t<F8?7:t<M8?8:t<q8?9:10},z8={encode:A8,decode:P8,encodingLength:j8},Ld=z8;const vl=(t,e,r=0)=>(Ld.encode(t,e,r),e),El=t=>Ld.encodingLength(t),Wo=(t,e)=>{const r=e.byteLength,i=El(t),n=i+El(r),s=new Uint8Array(n+r);return vl(t,s,0),vl(r,s,i),s.set(e,n),new V8(t,r,e,s)};class V8{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const Fd=({name:t,code:e,encode:r})=>new K8(t,e,r);class K8{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Wo(this.code,r):r.then(i=>Wo(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Md=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),H8=Fd({name:"sha2-256",code:18,encode:Md("SHA-256")}),W8=Fd({name:"sha2-512",code:19,encode:Md("SHA-512")});var G8=Object.freeze({__proto__:null,sha256:H8,sha512:W8});const qd=0,Y8="identity",jd=Cd,Z8=t=>Wo(qd,jd(t)),X8={code:qd,name:Y8,encode:jd,digest:Z8};var J8=Object.freeze({__proto__:null,identity:X8});new TextEncoder,new TextDecoder;const xl={...KI,...WI,...YI,...XI,...e8,...l8,...d8,...y8,...E8,...O8};({...G8,...J8});function zd(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Q8(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?zd(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Vd(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const _l=Vd("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),ro=Vd("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Q8(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),eS={utf8:_l,"utf-8":_l,hex:xl.base16,latin1:ro,ascii:ro,binary:ro,...xl};function tS(t,e="utf8"){const r=eS[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?zd(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var rS=Object.defineProperty,iS=(t,e,r)=>e in t?rS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,St=(t,e,r)=>iS(t,typeof e!="symbol"?e+"":e,r);class nS{constructor(e,r){this.core=e,this.logger=r,St(this,"keychain",new Map),St(this,"name",iI),St(this,"version",nI),St(this,"initialized",!1),St(this,"storagePrefix",Tt),St(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),St(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),St(this,"set",async(i,n)=>{this.isInitialized(),this.keychain.set(i,n),await this.persist()}),St(this,"get",i=>{this.isInitialized();const n=this.keychain.get(i);if(typeof n>"u"){const{message:s}=q("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return n}),St(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=nt(r,this.name)}get context(){return Je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Bo(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Po(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var sS=Object.defineProperty,oS=(t,e,r)=>e in t?sS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ve=(t,e,r)=>oS(t,typeof e!="symbol"?e+"":e,r);class aS{constructor(e,r,i){this.core=e,this.logger=r,ve(this,"name",tI),ve(this,"keychain"),ve(this,"randomSessionIdentifier",jo()),ve(this,"initialized",!1),ve(this,"clientId"),ve(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),ve(this,"hasKeys",n=>(this.isInitialized(),this.keychain.has(n))),ve(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;const n=await this.getClientSeed(),s=kc(n),o=Oh(s.publicKey);return this.clientId=o,o}),ve(this,"generateKeyPair",()=>{this.isInitialized();const n=c3();return this.setPrivateKey(n.publicKey,n.privateKey)}),ve(this,"signJWT",async n=>{this.isInitialized();const s=await this.getClientSeed(),o=kc(s),a=this.randomSessionIdentifier;return await Ib(a,n,rI,o)}),ve(this,"generateSharedKey",(n,s,o)=>{this.isInitialized();const a=this.getPrivateKey(n),c=u3(a,s);return this.setSymKey(c,o)}),ve(this,"setSymKey",async(n,s)=>{this.isInitialized();const o=s||In(n);return await this.keychain.set(o,n),o}),ve(this,"deleteKeyPair",async n=>{this.isInitialized(),await this.keychain.del(n)}),ve(this,"deleteSymKey",async n=>{this.isInitialized(),await this.keychain.del(n)}),ve(this,"encode",async(n,s,o)=>{this.isInitialized();const a=vd(o),c=ji(s);if(Yu(a))return f3(c,o?.encoding);if(Gu(a)){const f=a.senderPublicKey,p=a.receiverPublicKey;n=await this.generateSharedKey(f,p)}const u=this.getSymKey(n),{type:l,senderPublicKey:h}=a;return l3({type:l,symKey:u,message:c,senderPublicKey:h,encoding:o?.encoding})}),ve(this,"decode",async(n,s,o)=>{this.isInitialized();const a=p3(s,o);if(Yu(a)){const c=d3(s,o?.encoding);return ri(c)}if(Gu(a)){const c=a.receiverPublicKey,u=a.senderPublicKey;n=await this.generateSharedKey(c,u)}try{const c=this.getSymKey(n),u=h3({symKey:c,encoded:s,encoding:o?.encoding});return ri(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${n}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),ve(this,"getPayloadType",(n,s=Ge)=>{const o=Li({encoded:n,encoding:s});return Ur(o.type)}),ve(this,"getPayloadSenderPublicKey",(n,s=Ge)=>{const o=Li({encoded:n,encoding:s});return o.senderPublicKey?Xe(o.senderPublicKey,qe):void 0}),this.core=e,this.logger=nt(r,this.name),this.keychain=i||new nS(this.core,this.logger)}get context(){return Je(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(yl)}catch{e=jo(),await this.keychain.set(yl,e)}return tS(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var cS=Object.defineProperty,uS=Object.defineProperties,lS=Object.getOwnPropertyDescriptors,Il=Object.getOwnPropertySymbols,hS=Object.prototype.hasOwnProperty,fS=Object.prototype.propertyIsEnumerable,Go=(t,e,r)=>e in t?cS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,dS=(t,e)=>{for(var r in e||(e={}))hS.call(e,r)&&Go(t,r,e[r]);if(Il)for(var r of Il(e))fS.call(e,r)&&Go(t,r,e[r]);return t},pS=(t,e)=>uS(t,lS(e)),Qe=(t,e,r)=>Go(t,typeof e!="symbol"?e+"":e,r);class gS extends xy{constructor(e,r){super(e,r),this.logger=e,this.core=r,Qe(this,"messages",new Map),Qe(this,"messagesWithoutClientAck",new Map),Qe(this,"name",sI),Qe(this,"version",oI),Qe(this,"initialized",!1),Qe(this,"storagePrefix",Tt),Qe(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i);const n=await this.getRelayerMessagesWithoutClientAck();typeof n<"u"&&(this.messagesWithoutClientAck=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),Qe(this,"set",async(i,n,s)=>{this.isInitialized();const o=lt(n);let a=this.messages.get(i);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=n,this.messages.set(i,a),s===Sn.inbound){const c=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,pS(dS({},c),{[o]:n}))}return await this.persist(),o}),Qe(this,"get",i=>{this.isInitialized();let n=this.messages.get(i);return typeof n>"u"&&(n={}),n}),Qe(this,"getWithoutAck",i=>{this.isInitialized();const n={};for(const s of i){const o=this.messagesWithoutClientAck.get(s)||{};n[s]=Object.values(o)}return n}),Qe(this,"has",(i,n)=>{this.isInitialized();const s=this.get(i),o=lt(n);return typeof s[o]<"u"}),Qe(this,"ack",async(i,n)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(i);if(typeof s>"u")return;const o=lt(n);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,s),await this.persist()}),Qe(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),await this.persist()}),this.logger=nt(e,this.name),this.core=r}get context(){return Je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Bo(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Bo(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Po(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Po(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var yS=Object.defineProperty,wS=Object.defineProperties,bS=Object.getOwnPropertyDescriptors,Sl=Object.getOwnPropertySymbols,mS=Object.prototype.hasOwnProperty,vS=Object.prototype.propertyIsEnumerable,Yo=(t,e,r)=>e in t?yS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Wr=(t,e)=>{for(var r in e||(e={}))mS.call(e,r)&&Yo(t,r,e[r]);if(Sl)for(var r of Sl(e))vS.call(e,r)&&Yo(t,r,e[r]);return t},Dl=(t,e)=>wS(t,bS(e)),at=(t,e,r)=>Yo(t,typeof e!="symbol"?e+"":e,r);class ES extends _y{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,at(this,"events",new Et.EventEmitter),at(this,"name",cI),at(this,"queue",new Map),at(this,"publishTimeout",M.toMiliseconds(M.ONE_MINUTE)),at(this,"initialPublishTimeout",M.toMiliseconds(M.ONE_SECOND*15)),at(this,"needsTransportRestart",!1),at(this,"publish",async(i,n,s)=>{var o,a,c,u,l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:s}});const h=s?.ttl||aI,f=s?.prompt||!1,p=s?.tag||0,d=s?.id||pr().toString(),g=Xr(qn().protocol),y={id:d,method:s?.publishMethod||g.publish,params:Wr({topic:i,message:n,ttl:h,prompt:f,tag:p,attestation:s?.attestation},s?.tvf)},x=`Failed to publish payload, please try again. id:${d} tag:${p}`;try{Ie((o=y.params)==null?void 0:o.prompt)&&((a=y.params)==null||delete a.prompt),Ie((c=y.params)==null?void 0:c.tag)&&((u=y.params)==null||delete u.tag);const I=new Promise(async w=>{const b=({id:_})=>{var A;((A=y.id)==null?void 0:A.toString())===_.toString()&&(this.removeRequestFromQueue(_),this.relayer.events.removeListener(de.publish,b),w())};this.relayer.events.on(de.publish,b);const m=Pt(new Promise((_,A)=>{this.rpcPublish(y,s).then(_).catch(B=>{this.logger.warn(B,B?.message),A(B)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${d} tag:${p}`);try{await m,this.events.removeListener(de.publish,b)}catch(_){this.queue.set(d,{request:y,opts:s,attempt:1}),this.logger.warn(_,_?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:d,topic:i,message:n,opts:s}}),await Pt(I,this.publishTimeout,x)}catch(I){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(I),(l=s?.internal)!=null&&l.throwOnFailedPublish)throw I}finally{this.queue.delete(d)}}),at(this,"publishCustom",async i=>{var n,s,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:i});const{payload:u,opts:l={}}=i,{attestation:h,tvf:f,publishMethod:p,prompt:d,tag:g,ttl:y=M.FIVE_MINUTES}=l,x=l.id||pr().toString(),I=Xr(qn().protocol),w=p||I.publish,b={id:x,method:w,params:Wr(Dl(Wr({},u),{ttl:y,prompt:d,tag:g,attestation:h}),f)},m=`Failed to publish custom payload, please try again. id:${x} tag:${g}`;try{Ie((n=b.params)==null?void 0:n.prompt)&&((s=b.params)==null||delete s.prompt),Ie((o=b.params)==null?void 0:o.tag)&&((a=b.params)==null||delete a.tag);const _=new Promise(async A=>{const B=({id:N})=>{var U;((U=b.id)==null?void 0:U.toString())===N.toString()&&(this.removeRequestFromQueue(N),this.relayer.events.removeListener(de.publish,B),A())};this.relayer.events.on(de.publish,B);const $=Pt(new Promise((N,U)=>{this.rpcPublish(b,l).then(N).catch(C=>{this.logger.warn(C,C?.message),U(C)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${w} id:${x} tag:${g}`);try{await $,this.events.removeListener(de.publish,B)}catch(N){this.queue.set(x,{request:b,opts:l,attempt:1}),this.logger.warn(N,N?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:x,payload:u,opts:l}}),await Pt(_,this.publishTimeout,m)}catch(_){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(_),(c=l?.internal)!=null&&c.throwOnFailedPublish)throw _}finally{this.queue.delete(x)}}),at(this,"on",(i,n)=>{this.events.on(i,n)}),at(this,"once",(i,n)=>{this.events.once(i,n)}),at(this,"off",(i,n)=>{this.events.off(i,n)}),at(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),this.relayer=e,this.logger=nt(r,this.name),this.registerEventListeners()}get context(){return Je(this.logger)}async rpcPublish(e,r){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const i=await this.relayer.request(e);return this.relayer.events.emit(de.publish,Wr(Wr({},e),r)),this.logger.debug("Successfully Published Payload"),i}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{var i;const n=e.attempt+1;this.queue.set(r,Dl(Wr({},e),{attempt:n})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(i=e.request.params)==null?void 0:i.tag}, attempt: ${n}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Lr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(de.connection_stalled);return}this.checkQueue()}),this.relayer.on(de.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var xS=Object.defineProperty,_S=(t,e,r)=>e in t?xS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Gr=(t,e,r)=>_S(t,typeof e!="symbol"?e+"":e,r);class IS{constructor(){Gr(this,"map",new Map),Gr(this,"set",(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])}),Gr(this,"get",e=>this.map.get(e)||[]),Gr(this,"exists",(e,r)=>this.get(e).includes(r)),Gr(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const n=i.filter(s=>s!==r);if(!n.length){this.map.delete(e);return}this.map.set(e,n)}),Gr(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var SS=Object.defineProperty,DS=Object.defineProperties,OS=Object.getOwnPropertyDescriptors,Ol=Object.getOwnPropertySymbols,AS=Object.prototype.hasOwnProperty,$S=Object.prototype.propertyIsEnumerable,Zo=(t,e,r)=>e in t?SS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ei=(t,e)=>{for(var r in e||(e={}))AS.call(e,r)&&Zo(t,r,e[r]);if(Ol)for(var r of Ol(e))$S.call(e,r)&&Zo(t,r,e[r]);return t},io=(t,e)=>DS(t,OS(e)),se=(t,e,r)=>Zo(t,typeof e!="symbol"?e+"":e,r);class BS extends Dy{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,se(this,"subscriptions",new Map),se(this,"topicMap",new IS),se(this,"events",new Et.EventEmitter),se(this,"name",gI),se(this,"version",yI),se(this,"pending",new Map),se(this,"cached",[]),se(this,"initialized",!1),se(this,"storagePrefix",Tt),se(this,"subscribeTimeout",M.toMiliseconds(M.ONE_MINUTE)),se(this,"initialSubscribeTimeout",M.toMiliseconds(M.ONE_SECOND*15)),se(this,"clientId"),se(this,"batchSubscribeTopicsLimit",500),se(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),se(this,"subscribe",async(i,n)=>{var s;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}});try{const o=qn(n),a={topic:i,relay:o,transportType:n?.transportType};(s=n?.internal)!=null&&s.skipSubscribe||this.pending.set(i,a);const c=await this.rpcSubscribe(i,o,n);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),se(this,"unsubscribe",async(i,n)=>{this.isInitialized(),typeof n?.id<"u"?await this.unsubscribeById(i,n.id,n):await this.unsubscribeByTopic(i,n)}),se(this,"isSubscribed",i=>new Promise(n=>{n(this.topicMap.topics.includes(i))})),se(this,"isKnownTopic",i=>new Promise(n=>{n(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(s=>s.topic===i))})),se(this,"on",(i,n)=>{this.events.on(i,n)}),se(this,"once",(i,n)=>{this.events.once(i,n)}),se(this,"off",(i,n)=>{this.events.off(i,n)}),se(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),se(this,"start",async()=>{await this.onConnect()}),se(this,"stop",async()=>{await this.onDisconnect()}),se(this,"restart",async()=>{await this.restore(),await this.onRestart()}),se(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(n=>{i.push(n)}),await this.batchSubscribe(i)}),se(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Lr.pulse,async()=>{await this.checkPending()}),this.events.on(et.created,async i=>{const n=et.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:i}),await this.persist()}),this.events.on(et.deleted,async i=>{const n=et.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:i}),await this.persist()})}),this.relayer=e,this.logger=nt(r,this.name),this.clientId=""}get context(){return Je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async n=>await this.unsubscribeById(e,n,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const n=qn(i);await this.restartToComplete({topic:e,id:r,relay:n}),await this.rpcUnsubscribe(e,r,n);const s=le("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,r,i){var n,s;const o=await this.getSubscriptionId(e);if((n=i?.internal)!=null&&n.skipSubscribe)return o;(!i||i?.transportType===ae.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const a={method:Xr(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(s=i?.internal)==null?void 0:s.throwOnFailedPublish;try{if(i?.transportType===ae.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},M.toMiliseconds(M.ONE_SECOND)),o;const u=new Promise(async h=>{const f=p=>{p.topic===e&&(this.events.removeListener(et.created,f),h(p.id))};this.events.on(et.created,f);try{const p=await Pt(new Promise((d,g)=>{this.relayer.request(a).catch(y=>{this.logger.warn(y,y?.message),g(y)}).then(d)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(et.created,f),h(p)}catch{}}),l=await Pt(u,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return l?o:null}catch(u){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(de.connection_stalled),c)throw u}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:Xr(r.protocol).batchSubscribe,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await Pt(new Promise(n=>{this.relayer.request(i).catch(s=>this.logger.warn(s)).then(n)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(de.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,i={method:Xr(r.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let n;try{n=await await Pt(new Promise((s,o)=>{this.relayer.request(i).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(de.connection_stalled)}return n}rpcUnsubscribe(e,r,i){const n={method:Xr(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}onSubscribe(e,r){this.setSubscription(e,io(Ei({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Ei({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,Ei({},r)),this.topicMap.set(r.topic,e),this.events.emit(et.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(et.deleted,io(Ei({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(et.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const n=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(et.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(r=>{var i;return r.topic===((i=this.subscriptions.get(r.id))==null?void 0:i.topic)})){const{message:r}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>io(Ei({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await A2(M.toMiliseconds(M.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return lt(e+await this.getClientId())}}var PS=Object.defineProperty,Al=Object.getOwnPropertySymbols,TS=Object.prototype.hasOwnProperty,RS=Object.prototype.propertyIsEnumerable,Xo=(t,e,r)=>e in t?PS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$l=(t,e)=>{for(var r in e||(e={}))TS.call(e,r)&&Xo(t,r,e[r]);if(Al)for(var r of Al(e))RS.call(e,r)&&Xo(t,r,e[r]);return t},te=(t,e,r)=>Xo(t,typeof e!="symbol"?e+"":e,r);class CS extends Iy{constructor(e){var r;super(e),te(this,"protocol","wc"),te(this,"version",2),te(this,"core"),te(this,"logger"),te(this,"events",new Et.EventEmitter),te(this,"provider"),te(this,"messages"),te(this,"subscriber"),te(this,"publisher"),te(this,"name",lI),te(this,"transportExplicitlyClosed",!1),te(this,"initialized",!1),te(this,"connectionAttemptInProgress",!1),te(this,"relayUrl"),te(this,"projectId"),te(this,"packageName"),te(this,"bundleId"),te(this,"hasExperiencedNetworkDisruption",!1),te(this,"pingTimeout"),te(this,"heartBeatTimeout",M.toMiliseconds(M.THIRTY_SECONDS+M.FIVE_SECONDS)),te(this,"reconnectTimeout"),te(this,"connectPromise"),te(this,"reconnectInProgress",!1),te(this,"requestsInFlight",[]),te(this,"connectTimeout",M.toMiliseconds(M.ONE_SECOND*15)),te(this,"request",async i=>{var n,s;this.logger.debug("Publishing Request Payload");const o=i.id||pr().toString();await this.toEstablishConnection();try{this.logger.trace({id:o,method:i.method,topic:(n=i.params)==null?void 0:n.topic},"relayer.request - publishing...");const a=`${o}:${((s=i.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(a);const c=await this.provider.request(i);return this.requestsInFlight=this.requestsInFlight.filter(u=>u!==a),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}}),te(this,"resetPingTimeout",()=>{Nn()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var i,n,s,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(s=(n=(i=this.provider)==null?void 0:i.connection)==null?void 0:n.socket)==null?void 0:s.terminate)==null||o.call(s)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),te(this,"onPayloadHandler",i=>{this.onProviderPayload(i),this.resetPingTimeout()}),te(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(de.connect)}),te(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),te(this,"onProviderErrorHandler",i=>{this.logger.fatal(`Fatal socket error: ${i.message}`),this.events.emit(de.error,i),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),te(this,"registerProviderListeners",()=>{this.provider.on(ot.payload,this.onPayloadHandler),this.provider.on(ot.connect,this.onConnectHandler),this.provider.on(ot.disconnect,this.onDisconnectHandler),this.provider.on(ot.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=Sd({logger:(r=e.logger)!=null?r:uI,name:this.name}),this.messages=new gS(this.logger,e.core),this.subscriber=new BS(this,this.logger),this.publisher=new ES(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Td,f2()?this.packageName=yu():d2()&&(this.bundleId=yu()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return Je(this.logger)}get connected(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:ae.relay},Sn.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,r){var i,n,s;this.isInitialized(),(!(r!=null&&r.transportType)||r?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((i=r?.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(n=r?.internal)==null?void 0:n.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const u=l=>{l.topic===e&&(this.subscriber.off(et.created,u),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on(et.created,u)}),new Promise(async(l,h)=>{a=await this.subscriber.subscribe(e,$l({internal:{throwOnFailedPublish:o}},r)).catch(f=>{o&&h(f)})||a,l()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Pt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,i)=>{await this.connect(e).then(r).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await cl())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((i,n)=>i.publishedAt-n.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const i of r)try{await this.onMessageEvent(i)}catch(n){this.logger.warn(n,"Error while processing batch message event: "+n?.message)}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:i}=e;if(!r.sessionExists){const n=we(M.FIVE_MINUTES),s={topic:i,expiry:n,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,s)}this.events.emit(de.message,e),await this.recordMessageEvent(e,Sn.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(i,n)=>{const s=()=>{n(new Error("Connection interrupted while trying to connect"))};this.provider.once(ot.disconnect,s),await Pt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{n(o)}).finally(()=>{this.provider.off(ot.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{n(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(ot.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(ot.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const n=i;this.logger.warn({},n.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(i=>setTimeout(i,M.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,i,n,s;if(Nn())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((s=(n=(i=this.provider)==null?void 0:i.connection)==null?void 0:n.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new W_(new X_(b2({sdkVersion:Ko,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:i,message:n}=e;await this.messages.set(i,n,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const n=this.messages.has(r,i);return n&&this.logger.warn(`Ignoring duplicate message: ${i}`),n}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Ca(e)){if(!e.method.endsWith(hI))return;const r=e.params,{topic:i,message:n,publishedAt:s,attestation:o}=r.data,a={topic:i,message:n,publishedAt:s,transportType:ae.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace($l({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else os(e)&&this.events.emit(de.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Sn.inbound),this.events.emit(de.message,e))}async acknowledgePayload(e){const r=zn(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ot.payload,this.onPayloadHandler),this.provider.off(ot.connect,this.onConnectHandler),this.provider.off(ot.disconnect,this.onDisconnectHandler),this.provider.off(ot.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await cl();g_(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(i=>this.logger.error(i,i?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Lr.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&b_())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(de.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},M.toMiliseconds(fI)))))}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function NS(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function Bl(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Pl(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const US="[object RegExp]",kS="[object String]",LS="[object Number]",FS="[object Boolean]",Tl="[object Arguments]",MS="[object Symbol]",qS="[object Date]",jS="[object Map]",zS="[object Set]",VS="[object Array]",KS="[object Function]",HS="[object ArrayBuffer]",no="[object Object]",WS="[object Error]",GS="[object DataView]",YS="[object Uint8Array]",ZS="[object Uint8ClampedArray]",XS="[object Uint16Array]",JS="[object Uint32Array]",QS="[object BigUint64Array]",eD="[object Int8Array]",tD="[object Int16Array]",rD="[object Int32Array]",iD="[object BigInt64Array]",nD="[object Float32Array]",sD="[object Float64Array]";function oD(){}function Rl(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function aD(t,e,r){return Si(t,e,void 0,void 0,void 0,void 0,r)}function Si(t,e,r,i,n,s,o){const a=o(t,e,r,i,n,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Pi(t,e,s,o)}return Pi(t,e,s,o)}function Pi(t,e,r,i){if(Object.is(t,e))return!0;let n=Pl(t),s=Pl(e);if(n===Tl&&(n=no),s===Tl&&(s=no),n!==s)return!1;switch(n){case kS:return t.toString()===e.toString();case LS:{const c=t.valueOf(),u=e.valueOf();return NS(c,u)}case FS:case qS:case MS:return Object.is(t.valueOf(),e.valueOf());case US:return t.source===e.source&&t.flags===e.flags;case KS:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(n){case jS:{if(t.size!==e.size)return!1;for(const[c,u]of t.entries())if(!e.has(c)||!Si(u,e.get(c),c,t,e,r,i))return!1;return!0}case zS:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),u=Array.from(e.values());for(let l=0;l<c.length;l++){const h=c[l],f=u.findIndex(p=>Si(h,p,void 0,t,e,r,i));if(f===-1)return!1;u.splice(f,1)}return!0}case VS:case YS:case ZS:case XS:case JS:case QS:case eD:case tD:case rD:case iD:case nD:case sD:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Si(t[c],e[c],c,t,e,r,i))return!1;return!0}case HS:return t.byteLength!==e.byteLength?!1:Pi(new Uint8Array(t),new Uint8Array(e),r,i);case GS:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Pi(new Uint8Array(t),new Uint8Array(e),r,i);case WS:return t.name===e.name&&t.message===e.message;case no:{if(!(Pi(t.constructor,e.constructor,r,i)||Rl(t)&&Rl(e)))return!1;const c=[...Object.keys(t),...Bl(t)],u=[...Object.keys(e),...Bl(e)];if(c.length!==u.length)return!1;for(let l=0;l<c.length;l++){const h=c[l],f=t[h];if(!Object.hasOwn(e,h))return!1;const p=e[h];if(!Si(f,p,h,t,e,r,i))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function cD(t,e){return aD(t,e,oD)}var uD=Object.defineProperty,Cl=Object.getOwnPropertySymbols,lD=Object.prototype.hasOwnProperty,hD=Object.prototype.propertyIsEnumerable,Jo=(t,e,r)=>e in t?uD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Nl=(t,e)=>{for(var r in e||(e={}))lD.call(e,r)&&Jo(t,r,e[r]);if(Cl)for(var r of Cl(e))hD.call(e,r)&&Jo(t,r,e[r]);return t},ze=(t,e,r)=>Jo(t,typeof e!="symbol"?e+"":e,r);class qr extends Sy{constructor(e,r,i,n=Tt,s=void 0){super(e,r,i,n),this.core=e,this.logger=r,this.name=i,ze(this,"map",new Map),ze(this,"version",dI),ze(this,"cached",[]),ze(this,"initialized",!1),ze(this,"getKey"),ze(this,"storagePrefix",Tt),ze(this,"recentlyDeleted",[]),ze(this,"recentlyDeletedLimit",200),ze(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Ie(o)?this.map.set(this.getKey(o),o):H3(o)?this.map.set(o.id,o):W3(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),ze(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),ze(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),ze(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>cD(a[c],o[c]))):this.values)),ze(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=Nl(Nl({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),ze(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=nt(r,this.name),this.storagePrefix=n,this.getKey=s}get context(){return Je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:n}=q("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}const{message:i}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var fD=Object.defineProperty,dD=(t,e,r)=>e in t?fD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,J=(t,e,r)=>dD(t,typeof e!="symbol"?e+"":e,r);class pD{constructor(e,r){this.core=e,this.logger=r,J(this,"name",wI),J(this,"version",bI),J(this,"events",new Vl),J(this,"pairings"),J(this,"initialized",!1),J(this,"storagePrefix",Tt),J(this,"ignoredPayloadTypes",[Yt]),J(this,"registeredMethods",[]),J(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),J(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),J(this,"create",async i=>{this.isInitialized();const n=jo(),s=await this.core.crypto.setSymKey(n),o=we(M.FIVE_MINUTES),a={protocol:Pd},c={topic:s,expiry:o,relay:a,active:!1,methods:i?.methods},u=Qu({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:n,relay:a,expiryTimestamp:o,methods:i?.methods});return this.events.emit(Or.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:i?.transportType,internal:i?.internal}),{topic:s,uri:u}}),J(this,"pair",async i=>{this.isInitialized();const n=this.core.eventClient.createEvent({properties:{topic:i?.uri,trace:[Ot.pairing_started]}});this.isValidPair(i,n);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:u}=Ju(i.uri);n.props.properties.topic=s,n.addTrace(Ot.pairing_uri_validation_success),n.addTrace(Ot.pairing_uri_not_expired);let l;if(this.pairings.keys.includes(s)){if(l=this.pairings.get(s),n.addTrace(Ot.existing_pairing),l.active)throw n.setError(qt.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);n.addTrace(Ot.pairing_not_expired)}const h=c||we(M.FIVE_MINUTES),f={topic:s,relay:a,expiry:h,active:!1,methods:u};this.core.expirer.set(s,h),await this.pairings.set(s,f),n.addTrace(Ot.store_new_pairing),i.activatePairing&&await this.activate({topic:s}),this.events.emit(Or.create,f),n.addTrace(Ot.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),n.addTrace(Ot.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{n.setError(qt.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(p){throw n.setError(qt.subscribe_pairing_topic_failure),p}return n.addTrace(Ot.subscribe_pairing_topic_success),f}),J(this,"activate",async({topic:i})=>{this.isInitialized();const n=we(M.FIVE_MINUTES);this.core.expirer.set(i,n),await this.pairings.update(i,{active:!0,expiry:n})}),J(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:n}=i;if(this.pairings.keys.includes(n)){const s=await this.sendRequest(n,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Sr();this.events.once(ie("pairing_ping",s),({error:u})=>{u?c(u):a()}),await o()}}),J(this,"updateExpiry",async({topic:i,expiry:n})=>{this.isInitialized(),await this.pairings.update(i,{expiry:n})}),J(this,"updateMetadata",async({topic:i,metadata:n})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:n})}),J(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),J(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",le("USER_DISCONNECTED")),await this.deletePairing(n))}),J(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:n,relay:s,expiry:o,methods:a}=i,c=this.core.crypto.keychain.get(n);return Qu({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),J(this,"sendRequest",async(i,n,s)=>{const o=Kt(n,s),a=await this.core.crypto.encode(i,o),c=mi[n].req;return this.core.history.set(i,o),this.core.relayer.publish(i,a,c),o.id}),J(this,"sendResult",async(i,n,s)=>{const o=zn(i,s),a=await this.core.crypto.encode(n,o),c=(await this.core.history.get(n,i)).request.method,u=mi[c].res;await this.core.relayer.publish(n,a,u),await this.core.history.resolve(o)}),J(this,"sendError",async(i,n,s)=>{const o=Ra(i,s),a=await this.core.crypto.encode(n,o),c=(await this.core.history.get(n,i)).request.method,u=mi[c]?mi[c].res:mi.unregistered_method.res;await this.core.relayer.publish(n,a,u),await this.core.history.resolve(o)}),J(this,"deletePairing",async(i,n)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,le("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),n?Promise.resolve():this.core.expirer.del(i)])}),J(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(n=>or(n.expiry));await Promise.all(i.map(n=>this.deletePairing(n.topic)))}),J(this,"onRelayEventRequest",async i=>{const{topic:n,payload:s}=i;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(n,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(n,s);default:return await this.onUnknownRpcMethodRequest(n,s)}}),J(this,"onRelayEventResponse",async i=>{const{topic:n,payload:s}=i,o=(await this.core.history.get(n,s.id)).request.method;return o==="wc_pairingPing"?this.onPairingPingResponse(n,s):this.onUnknownRpcMethodResponse(o)}),J(this,"onPairingPingRequest",async(i,n)=>{const{id:s}=n;try{this.isValidPing({topic:i}),await this.sendResult(s,i,!0),this.events.emit(Or.ping,{id:s,topic:i})}catch(o){await this.sendError(s,i,o),this.logger.error(o)}}),J(this,"onPairingPingResponse",(i,n)=>{const{id:s}=n;setTimeout(()=>{$t(n)?this.events.emit(ie("pairing_ping",s),{}):ht(n)&&this.events.emit(ie("pairing_ping",s),{error:n.error})},500)}),J(this,"onPairingDeleteRequest",async(i,n)=>{const{id:s}=n;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(Or.delete,{id:s,topic:i})}catch(o){await this.sendError(s,i,o),this.logger.error(o)}}),J(this,"onUnknownRpcMethodRequest",async(i,n)=>{const{id:s,method:o}=n;try{if(this.registeredMethods.includes(o))return;const a=le("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,i,a),this.logger.error(a)}catch(a){await this.sendError(s,i,a),this.logger.error(a)}}),J(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(le("WC_METHOD_UNSUPPORTED",i))}),J(this,"isValidPair",(i,n)=>{var s;if(!Ke(i)){const{message:a}=q("MISSING_OR_INVALID",`pair() params: ${i}`);throw n.setError(qt.malformed_pairing_uri),new Error(a)}if(!K3(i.uri)){const{message:a}=q("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw n.setError(qt.malformed_pairing_uri),new Error(a)}const o=Ju(i?.uri);if(!((s=o?.relay)!=null&&s.protocol)){const{message:a}=q("MISSING_OR_INVALID","pair() uri#relay-protocol");throw n.setError(qt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=q("MISSING_OR_INVALID","pair() uri#symKey");throw n.setError(qt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&M.toMiliseconds(o?.expiryTimestamp)<Date.now()){n.setError(qt.pairing_expired);const{message:a}=q("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),J(this,"isValidPing",async i=>{if(!Ke(i)){const{message:s}=q("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)}),J(this,"isValidDisconnect",async i=>{if(!Ke(i)){const{message:s}=q("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)}),J(this,"isValidPairingTopic",async i=>{if(!pe(i,!1)){const{message:n}=q("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(n)}if(!this.pairings.keys.includes(i)){const{message:n}=q("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(n)}if(or(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:n}=q("EXPIRED",`pairing topic: ${i}`);throw new Error(n)}}),this.core=e,this.logger=nt(r,this.name),this.pairings=new qr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Je(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(de.message,async e=>{const{topic:r,message:i,transportType:n}=e;if(this.pairings.keys.includes(r)&&n!==ae.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const s=await this.core.crypto.decode(r,i);Ca(s)?(this.core.history.set(r,s),await this.onRelayEventRequest({topic:r,payload:s})):os(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.core.history.delete(r,s.id)),await this.core.relayer.messages.ack(r,i)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(ct.expired,async e=>{const{topic:r}=xf(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Or.expire,{topic:r}))})}}var gD=Object.defineProperty,yD=(t,e,r)=>e in t?gD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Oe=(t,e,r)=>yD(t,typeof e!="symbol"?e+"":e,r);class wD extends Ey{constructor(e,r){super(e,r),this.core=e,this.logger=r,Oe(this,"records",new Map),Oe(this,"events",new Et.EventEmitter),Oe(this,"name",mI),Oe(this,"version",vI),Oe(this,"cached",[]),Oe(this,"initialized",!1),Oe(this,"storagePrefix",Tt),Oe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Oe(this,"set",(i,n,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:n,chainId:s}),this.records.has(n.id))return;const o={id:n.id,topic:i,request:{method:n.method,params:n.params||null},chainId:s,expiry:we(M.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(gt.created,o)}),Oe(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const n=await this.getRecord(i.id);typeof n.response>"u"&&(n.response=ht(i)?{error:i.error}:{result:i.result},this.records.set(n.id,n),this.persist(),this.events.emit(gt.updated,n))}),Oe(this,"get",async(i,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:n}),await this.getRecord(n))),Oe(this,"delete",(i,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(s=>{if(s.topic===i){if(typeof n<"u"&&s.id!==n)return;this.records.delete(s.id),this.events.emit(gt.deleted,s)}}),this.persist()}),Oe(this,"exists",async(i,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===i:!1)),Oe(this,"on",(i,n)=>{this.events.on(i,n)}),Oe(this,"once",(i,n)=>{this.events.once(i,n)}),Oe(this,"off",(i,n)=>{this.events.off(i,n)}),Oe(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),this.logger=nt(r,this.name)}get context(){return Je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:Kt(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(gt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(gt.created,e=>{const r=gt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(gt.updated,e=>{const r=gt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(gt.deleted,e=>{const r=gt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(Lr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{M.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(gt.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var bD=Object.defineProperty,mD=(t,e,r)=>e in t?bD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ue=(t,e,r)=>mD(t,typeof e!="symbol"?e+"":e,r);class vD extends Oy{constructor(e,r){super(e,r),this.core=e,this.logger=r,Ue(this,"expirations",new Map),Ue(this,"events",new Et.EventEmitter),Ue(this,"name",EI),Ue(this,"version",xI),Ue(this,"cached",[]),Ue(this,"initialized",!1),Ue(this,"storagePrefix",Tt),Ue(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ue(this,"has",i=>{try{const n=this.formatTarget(i);return typeof this.getExpiration(n)<"u"}catch{return!1}}),Ue(this,"set",(i,n)=>{this.isInitialized();const s=this.formatTarget(i),o={target:s,expiry:n};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(ct.created,{target:s,expiration:o})}),Ue(this,"get",i=>{this.isInitialized();const n=this.formatTarget(i);return this.getExpiration(n)}),Ue(this,"del",i=>{if(this.isInitialized(),this.has(i)){const n=this.formatTarget(i),s=this.getExpiration(n);this.expirations.delete(n),this.events.emit(ct.deleted,{target:n,expiration:s})}}),Ue(this,"on",(i,n)=>{this.events.on(i,n)}),Ue(this,"once",(i,n)=>{this.events.once(i,n)}),Ue(this,"off",(i,n)=>{this.events.off(i,n)}),Ue(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),this.logger=nt(r,this.name)}get context(){return Je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return m2(e);if(typeof e=="number")return v2(e);const{message:r}=q("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(ct.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;M.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(ct.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Lr.pulse,()=>this.checkExpirations()),this.events.on(ct.created,e=>{const r=ct.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ct.expired,e=>{const r=ct.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ct.deleted,e=>{const r=ct.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var ED=Object.defineProperty,xD=(t,e,r)=>e in t?ED(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fe=(t,e,r)=>xD(t,typeof e!="symbol"?e+"":e,r);class _D extends Ay{constructor(e,r,i){super(e,r,i),this.core=e,this.logger=r,this.store=i,fe(this,"name",_I),fe(this,"abortController"),fe(this,"isDevEnv"),fe(this,"verifyUrlV3",SI),fe(this,"storagePrefix",Tt),fe(this,"version",Bd),fe(this,"publicKey"),fe(this,"fetchPromise"),fe(this,"init",async()=>{var n;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&M.toMiliseconds((n=this.publicKey)==null?void 0:n.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),fe(this,"register",async n=>{if(!ai()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=n,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const u=Zt.getDocument(),l=this.startAbortTimer(M.ONE_SECOND*5),h=await new Promise((f,p)=>{const d=()=>{window.removeEventListener("message",y),u.body.removeChild(g),p("attestation aborted")};this.abortController.signal.addEventListener("abort",d);const g=u.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",d,{signal:this.abortController.signal});const y=x=>{if(x.data&&typeof x.data=="string")try{const I=JSON.parse(x.data);if(I.type==="verify_attestation"){if(Eo(I.attestation).payload.id!==o)return;clearInterval(l),u.body.removeChild(g),this.abortController.signal.removeEventListener("abort",d),window.removeEventListener("message",y),f(I.attestation===null?"":I.attestation)}}catch(I){this.logger.warn(I)}};u.body.appendChild(g),window.addEventListener("message",y,{signal:this.abortController.signal})});return this.logger.debug(h,"jwt attestation"),h}catch(u){this.logger.warn(u)}return""}),fe(this,"resolve",async n=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=n;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(Eo(s).payload.id!==a)return;const u=await this.isValidJwtAttestation(s);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;const c=this.getVerifyUrl(n?.verifyUrl);return this.fetchAttestation(o,c)}),fe(this,"fetchAttestation",async(n,s)=>{this.logger.debug(`resolving attestation: ${n} from url: ${s}`);const o=this.startAbortTimer(M.ONE_SECOND*5),a=await fetch(`${s}/attestation/${n}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),fe(this,"getVerifyUrl",n=>{let s=n||Bi;return DI.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${Bi}`),s=Bi),s}),fe(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const n=this.startAbortTimer(M.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(n),await s.json()}catch(n){this.logger.warn(n)}}),fe(this,"persistPublicKey",async n=>{this.logger.debug(n,"persisting public key to local storage"),await this.store.setItem(this.storeKey,n),this.publicKey=n}),fe(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),fe(this,"isValidJwtAttestation",async n=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(n,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(n,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),fe(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),fe(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const n=await this.fetchPromise;return this.fetchPromise=void 0,n}),fe(this,"validateAttestation",(n,s)=>{const o=y3(n,s.publicKey),a={hasExpired:M.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=nt(r,this.name),this.abortController=new AbortController,this.isDevEnv=Ea(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Je(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),M.toMiliseconds(e))}}var ID=Object.defineProperty,SD=(t,e,r)=>e in t?ID(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ul=(t,e,r)=>SD(t,typeof e!="symbol"?e+"":e,r);class DD extends $y{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,Ul(this,"context",OI),Ul(this,"registerDeviceToken",async i=>{const{clientId:n,token:s,notificationType:o,enableEncrypted:a=!1}=i,c=`${AI}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:n,type:o,token:s,always_raw:a})})}),this.logger=nt(r,this.context)}}var OD=Object.defineProperty,kl=Object.getOwnPropertySymbols,AD=Object.prototype.hasOwnProperty,$D=Object.prototype.propertyIsEnumerable,Qo=(t,e,r)=>e in t?OD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xi=(t,e)=>{for(var r in e||(e={}))AD.call(e,r)&&Qo(t,r,e[r]);if(kl)for(var r of kl(e))$D.call(e,r)&&Qo(t,r,e[r]);return t},Ee=(t,e,r)=>Qo(t,typeof e!="symbol"?e+"":e,r);class BD extends By{constructor(e,r,i=!0){super(e,r,i),this.core=e,this.logger=r,Ee(this,"context",BI),Ee(this,"storagePrefix",Tt),Ee(this,"storageVersion",$I),Ee(this,"events",new Map),Ee(this,"shouldPersist",!1),Ee(this,"init",async()=>{if(!Ea())try{const n={eventId:bu(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:vf(this.core.relayer.protocol,this.core.relayer.version,Ko)}}};await this.sendEvent([n])}catch(n){this.logger.warn(n)}}),Ee(this,"createEvent",n=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=n,u=bu(),l=this.core.projectId||"",h=Date.now(),f=xi({eventId:u,timestamp:h,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,f),this.shouldPersist=!0),f}),Ee(this,"getEvent",n=>{const{eventId:s,topic:o}=n;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return xi(xi({},a),this.setMethods(a.eventId))}),Ee(this,"deleteEvent",n=>{const{eventId:s}=n;this.events.delete(s),this.shouldPersist=!0}),Ee(this,"setEventListeners",()=>{this.core.heartbeat.on(Lr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(n=>{M.fromMiliseconds(Date.now())-M.fromMiliseconds(n.timestamp)>PI&&(this.events.delete(n.eventId),this.shouldPersist=!0)})})}),Ee(this,"setMethods",n=>({addTrace:s=>this.addTrace(n,s),setError:s=>this.setError(n,s)})),Ee(this,"addTrace",(n,s)=>{const o=this.events.get(n);o&&(o.props.properties.trace.push(s),this.events.set(n,o),this.shouldPersist=!0)}),Ee(this,"setError",(n,s)=>{const o=this.events.get(n);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(n,o),this.shouldPersist=!0)}),Ee(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Ee(this,"restore",async()=>{try{const n=await this.core.storage.getItem(this.storageKey)||[];if(!n.length)return;n.forEach(s=>{this.events.set(s.eventId,xi(xi({},s),this.setMethods(s.eventId)))})}catch(n){this.logger.warn(n)}}),Ee(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const n=[];for(const[s,o]of this.events)o.props.type&&n.push(o);if(n.length!==0)try{if((await this.sendEvent(n)).ok)for(const s of n)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),Ee(this,"sendEvent",async n=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${TI}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Ko}${s}`,{method:"POST",body:JSON.stringify(n)})}),Ee(this,"getAppDomain",()=>mf().url),this.logger=nt(r,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var PD=Object.defineProperty,Ll=Object.getOwnPropertySymbols,TD=Object.prototype.hasOwnProperty,RD=Object.prototype.propertyIsEnumerable,ea=(t,e,r)=>e in t?PD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Fl=(t,e)=>{for(var r in e||(e={}))TD.call(e,r)&&ea(t,r,e[r]);if(Ll)for(var r of Ll(e))RD.call(e,r)&&ea(t,r,e[r]);return t},oe=(t,e,r)=>ea(t,typeof e!="symbol"?e+"":e,r);class Na extends wy{constructor(e){var r;super(e),oe(this,"protocol",$d),oe(this,"version",Bd),oe(this,"name",Vo),oe(this,"relayUrl"),oe(this,"projectId"),oe(this,"customStoragePrefix"),oe(this,"events",new Et.EventEmitter),oe(this,"logger"),oe(this,"heartbeat"),oe(this,"relayer"),oe(this,"crypto"),oe(this,"storage"),oe(this,"history"),oe(this,"expirer"),oe(this,"pairing"),oe(this,"verify"),oe(this,"echoClient"),oe(this,"linkModeSupportedApps"),oe(this,"eventClient"),oe(this,"initialized",!1),oe(this,"logChunkController"),oe(this,"on",(a,c)=>this.events.on(a,c)),oe(this,"once",(a,c)=>this.events.once(a,c)),oe(this,"off",(a,c)=>this.events.off(a,c)),oe(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),oe(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:u})=>{if(!a||!c)return;const l={topic:a,message:c,publishedAt:Date.now(),transportType:ae.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:u})});const i=this.getGlobalCore(e?.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Td,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const n=ly({level:typeof e?.logger=="string"&&e.logger?e.logger:Q_.logger,name:Vo}),{logger:s,chunkLoggerController:o}=Jl({opts:n,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=nt(s,this.name),this.heartbeat=new Gp,this.crypto=new aS(this,this.logger,e?.keychain),this.history=new wD(this,this.logger),this.expirer=new vD(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Sg(Fl(Fl({},eI),e?.storageOptions)),this.relayer=new CS({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new pD(this,this.logger),this.verify=new _D(this,this.logger,this.storage),this.echoClient=new DD(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new BD(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new Na(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(pI,i),r}get context(){return Je(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(wl,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(wl)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,i=`${r}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&J_.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const CD=Na,Kd="wc",Hd=2,Wd="client",Ua=`${Kd}@${Hd}:${Wd}:`,so={name:Wd,logger:"error"},Ml="WALLETCONNECT_DEEPLINK_CHOICE",ND="proposal",ql="Proposal expired",UD="session",Yr=M.SEVEN_DAYS,kD="engine",Ae={wc_sessionPropose:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1104},res:{ttl:M.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1106},res:{ttl:M.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1112},res:{ttl:M.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1114},res:{ttl:M.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:M.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:M.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1119}}},oo={min:M.FIVE_MINUTES,max:M.SEVEN_DAYS},Dt={idle:"IDLE",active:"ACTIVE"},LD={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},FD="request",MD=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],qD="wc",jD="auth",zD="authKeys",VD="pairingTopics",KD="requests",cs=`${qD}@${1.5}:${jD}:`,Dn=`${cs}:PUB_KEY`;var HD=Object.defineProperty,WD=Object.defineProperties,GD=Object.getOwnPropertyDescriptors,jl=Object.getOwnPropertySymbols,YD=Object.prototype.hasOwnProperty,ZD=Object.prototype.propertyIsEnumerable,ta=(t,e,r)=>e in t?HD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,re=(t,e)=>{for(var r in e||(e={}))YD.call(e,r)&&ta(t,r,e[r]);if(jl)for(var r of jl(e))ZD.call(e,r)&&ta(t,r,e[r]);return t},$e=(t,e)=>WD(t,GD(e)),F=(t,e,r)=>ta(t,typeof e!="symbol"?e+"":e,r);class XD extends Cy{constructor(e){super(e),F(this,"name",kD),F(this,"events",new Vl),F(this,"initialized",!1),F(this,"requestQueue",{state:Dt.idle,queue:[]}),F(this,"sessionRequestQueue",{state:Dt.idle,queue:[]}),F(this,"emittedSessionRequests",new $2({limit:500})),F(this,"requestQueueDelay",M.ONE_SECOND),F(this,"expectedPairingMethodMap",new Map),F(this,"recentlyDeletedMap",new Map),F(this,"recentlyDeletedLimit",200),F(this,"relayMessageCache",[]),F(this,"pendingSessions",new Map),F(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Ae)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},M.toMiliseconds(this.requestQueueDelay)))}),F(this,"connect",async r=>{var i;this.isInitialized(),await this.confirmOnlineStateOrThrow();const n=$e(re({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n),n.optionalNamespaces=M3(n.requiredNamespaces,n.optionalNamespaces),n.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:a,sessionProperties:c,scopedProperties:u,relays:l,authentication:h,walletPay:f}=n,p=((i=h?.[0])==null?void 0:i.ttl)||Ae.wc_sessionPropose.req.ttl||M.FIVE_MINUTES;this.validateRequestExpiry(p);let d=s,g,y=!1;try{if(d){const $=this.client.core.pairing.pairings.get(d);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),y=$.active}}catch($){throw this.client.logger.error(`connect() -> pairing.get(${d}) failed`),$}if(!d||!y){const{topic:$,uri:N}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});d=$,g=N}if(!d){const{message:$}=q("NO_MATCHING_KEY",`connect() pairing topic: ${d}`);throw new Error($)}const x=await this.client.core.crypto.generateKeyPair(),I=we(p),w=re($e(re(re({requiredNamespaces:o,optionalNamespaces:a,relays:l??[{protocol:Pd}],proposer:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:I,pairingTopic:d},c&&{sessionProperties:c}),u&&{scopedProperties:u}),{id:At()}),(h||f)&&{requests:{authentication:h?.map($=>{const{domain:N,chains:U,nonce:C,uri:D,exp:T,nbf:E,type:v,statement:O,requestId:R,resources:S,signatureTypes:P}=$;return{domain:N,chains:U,nonce:C,type:v??"caip122",aud:D,version:"1",iat:new Date().toISOString(),exp:T,nbf:E,statement:O,requestId:R,resources:S,signatureTypes:P}}),walletPay:f}}),b=ie("session_connect",w.id),{reject:m,resolve:_,done:A}=Sr(p,ql),B=({id:$})=>{$===w.id&&(this.client.events.off("proposal_expire",B),this.pendingSessions.delete(w.id),this.events.emit(b,{error:{message:ql,code:0}}))};return this.client.events.on("proposal_expire",B),this.events.once(b,({error:$,session:N})=>{this.client.events.off("proposal_expire",B),$?m($):N&&_(N)}),await this.setProposal(w.id,w),await this.sendProposeSession({proposal:w,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:w.id}}}).catch($=>{throw this.deleteProposal(w.id),$}),{uri:g,approval:A}}),F(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(i){throw this.client.logger.error("pair() failed"),i}}),F(this,"approve",async r=>{var i,n,s;const o=this.client.core.eventClient.createEvent({properties:{topic:(i=r?.id)==null?void 0:i.toString(),trace:[yt.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(N){throw o.setError(_r.no_internet_connection),N}try{await this.isValidProposalId(r?.id)}catch(N){throw this.client.logger.error(`approve() -> proposal.get(${r?.id}) failed`),o.setError(_r.proposal_not_found),N}try{await this.isValidApprove(r)}catch(N){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(_r.session_approve_namespace_validation_failure),N}const{id:a,relayProtocol:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:f,proposalRequestsResponses:p}=r,d=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:g,proposer:y,requiredNamespaces:x,optionalNamespaces:I}=d;let w=(n=this.client.core.eventClient)==null?void 0:n.getEvent({topic:g});w||(w=(s=this.client.core.eventClient)==null?void 0:s.createEvent({type:yt.session_approve_started,properties:{topic:g,trace:[yt.session_approve_started,yt.session_namespaces_validation_success]}}));const b=await this.client.core.crypto.generateKeyPair(),m=y.publicKey,_=await this.client.core.crypto.generateSharedKey(b,m),A=$e(re(re(re({relay:{protocol:c??"irn"},namespaces:u,controller:{publicKey:b,metadata:this.client.metadata},expiry:we(Yr)},l&&{sessionProperties:l}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{proposalRequestsResponses:p}),B=ae.relay;w.addTrace(yt.subscribing_session_topic);try{await this.client.core.relayer.subscribe(_,{transportType:B,internal:{skipSubscribe:!0}})}catch(N){throw w.setError(_r.subscribe_session_topic_failure),N}w.addTrace(yt.subscribe_session_topic_success);const $=$e(re({},A),{topic:_,requiredNamespaces:x,optionalNamespaces:I,pairingTopic:g,acknowledged:!1,self:A.controller,peer:{publicKey:y.publicKey,metadata:y.metadata},controller:b,transportType:ae.relay,authentication:p?.authentication,walletPayResult:p?.walletPay});await this.client.session.set(_,$),w.addTrace(yt.store_session);try{await this.sendApproveSession({sessionTopic:_,proposal:d,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:b},sessionSettleRequest:A,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:re({correlationId:a},this.getTVFApproveParams($))}}),w.addTrace(yt.session_approve_publish_success)}catch(N){throw this.client.logger.error(N),this.client.session.delete(_,le("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(_),N}return this.client.core.eventClient.deleteEvent({eventId:w.eventId}),await this.client.core.pairing.updateMetadata({topic:g,metadata:y.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:g}),await this.setExpiry(_,we(Yr)),{topic:_,acknowledged:()=>Promise.resolve(this.client.session.get(_))}}),F(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:i,reason:n}=r;let s;try{s=this.client.proposal.get(i).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),o}s&&await this.sendError({id:i,topic:s,error:n,rpcOpts:Ae.wc_sessionPropose.reject}),await this.deleteProposal(i)}),F(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:i,namespaces:n}=r,{done:s,resolve:o,reject:a}=Sr(M.FIVE_MINUTES,"Session update request expired without receiving any acknowledgement"),c=At(),u=pr().toString(),l=this.client.session.get(i).namespaces;return this.events.once(ie("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(i,{namespaces:n}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:n},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:u}).catch(h=>{this.client.logger.error(h),this.client.session.update(i,{namespaces:l}),a(h)}),{acknowledged:s}}),F(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:i}=r,n=At(),{done:s,resolve:o,reject:a}=Sr(M.FIVE_MINUTES,"Session extend request expired without receiving any acknowledgement");return this.events.once(ie("session_extend",n),({error:c})=>{c?a(c):o()}),await this.setExpiry(i,we(Yr)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:n,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}}),F(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(y){throw this.client.logger.error("request() -> isValidRequest() failed"),y}const{chainId:i,request:n,topic:s,expiry:o=Ae.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(s);a?.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const c=At(),u=pr().toString(),{done:l,resolve:h,reject:f}=Sr(o,"Request expired. Please try again.");this.events.once(ie("session_request",c),({error:y,result:x})=>{y?f(y):h(x)});const p="wc_sessionRequest",d=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(d)return await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:s,method:p,params:{request:$e(re({},n),{expiryTimestamp:we(o)}),chainId:i},expiry:o,throwOnFailedPublish:!0,appLink:d}).catch(y=>f(y)),this.client.events.emit("session_request_sent",{topic:s,request:n,chainId:i,id:c}),await l();const g={request:$e(re({},n),{expiryTimestamp:we(o)}),chainId:i};return await Promise.all([new Promise(async y=>{await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:s,method:p,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch(x=>f(x)),this.client.events.emit("session_request_sent",{topic:s,request:n,chainId:i,id:c}),y()}),new Promise(async y=>{var x;if(!((x=a.sessionConfig)!=null&&x.disableDeepLink)){const I=await I2(this.client.core.storage,Ml);await E2({id:c,topic:s,wcDeepLink:I})}y()}),l()]).then(y=>y[2])}),F(this,"respond",async r=>{var i,n;this.isInitialized();const s=this.client.core.eventClient.createEvent({properties:{topic:r?.topic||((n=(i=r?.response)==null?void 0:i.id)==null?void 0:n.toString()),trace:[yt.session_request_response_started]}});try{await this.isValidRespond(r)}catch(h){throw s.addTrace(h?.message),s.setError(_r.session_request_response_validation_failure),h}s.addTrace(yt.session_request_response_validation_success);const{topic:o,response:a}=r,{id:c}=a,u=this.client.session.get(o);u.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const l=this.getAppLinkIfEnabled(u.peer.metadata,u.transportType);try{s.addTrace(yt.session_request_response_publish_started),$t(a)?await this.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:l}):ht(a)&&await this.sendError({id:c,topic:o,error:a.error,appLink:l}),this.cleanupAfterResponse(r)}catch(h){throw s.addTrace(h?.message),s.setError(_r.session_request_response_publish_failure),h}}),F(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(n){throw this.client.logger.error("ping() -> isValidPing() failed"),n}const{topic:i}=r;if(this.client.session.keys.includes(i)){const n=At(),s=pr().toString(),{done:o,resolve:a,reject:c}=Sr(M.FIVE_MINUTES,"Ping request expired without receiving any acknowledgement");this.events.once(ie("session_ping",n),({error:u})=>{u?c(u):a()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:n,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),F(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:i,event:n,chainId:s}=r,o=pr().toString(),a=At();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:n,chainId:s},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),F(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:i}=r;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:le("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:n}=q("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(n)}}),F(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(i=>z3(i,r)))),F(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),F(this,"authenticate",async(r,i)=>{var n;this.isInitialized(),this.isValidAuthenticate(r);const s=i&&this.client.core.linkModeSupportedApps.includes(i)&&((n=this.client.metadata.redirect)==null?void 0:n.linkMode),o=s?ae.link_mode:ae.relay;o===ae.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:u,domain:l,nonce:h,type:f,exp:p,nbf:d,methods:g=[],expiry:y}=r,x=[...r.resources||[]],{topic:I,uri:w}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:I,uri:w}});const b=await this.client.core.crypto.generateKeyPair(),m=In(b);if(await Promise.all([this.client.auth.authKeys.set(Dn,{responseTopic:m,publicKey:b}),this.client.auth.pairingTopics.set(m,{topic:m,pairingTopic:I})]),await this.client.core.relayer.subscribe(m,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${I}`),g.length>0){const{namespace:S}=xn(a[0]);let P=jE(S,"request",g);_n(x)&&(P=VE(P,x.pop())),x.push(P)}const _=y&&y>Ae.wc_sessionAuthenticate.req.ttl?y:Ae.wc_sessionAuthenticate.req.ttl,A={authPayload:{type:f??"caip122",chains:a,statement:c,aud:u,domain:l,version:"1",nonce:h,iat:new Date().toISOString(),exp:p,nbf:d,resources:x},requester:{publicKey:b,metadata:this.client.metadata},expiryTimestamp:we(_)},B={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},$={requiredNamespaces:{},optionalNamespaces:B,relays:[{protocol:"irn"}],pairingTopic:I,proposer:{publicKey:b,metadata:this.client.metadata},expiryTimestamp:we(Ae.wc_sessionPropose.req.ttl),id:At()},{done:N,resolve:U,reject:C}=Sr(_,"Request expired"),D=At(),T=ie("session_connect",$.id),E=ie("session_request",D),v=async({error:S,session:P})=>{this.events.off(E,O),S?C(S):P&&U({session:P})},O=async S=>{var P,k,L;if(await this.deletePendingAuthRequest(D,{message:"fulfilled",code:0}),S.error){const W=le("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return S.error.code===W.code?void 0:(this.events.off(T,v),C(S.error.message))}await this.deleteProposal($.id),this.events.off(T,v);const{cacaos:K,responder:z}=S.result,j=[],H=[];for(const W of K){await $u({cacao:W,projectId:this.client.core.projectId})||(this.client.logger.error(W,"Signature verification failed"),C(le("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:X}=W,ue=_n(X.resources),ge=[To(X.iss)],me=kn(X.iss);if(ue){const Le=Bu(ue),xt=Pu(ue);j.push(...Le),ge.push(...xt)}for(const Le of ge)H.push(`${Le}:${me}`)}const G=await this.client.core.crypto.generateSharedKey(b,z.publicKey);let Z;j.length>0&&(Z={topic:G,acknowledged:!0,self:{publicKey:b,metadata:this.client.metadata},peer:z,controller:z.publicKey,expiry:we(Yr),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:I,namespaces:il([...new Set(j)],[...new Set(H)]),transportType:o},await this.client.core.relayer.subscribe(G,{transportType:o}),await this.client.session.set(G,Z),I&&await this.client.core.pairing.updateMetadata({topic:I,metadata:z.metadata}),Z=this.client.session.get(G)),(P=this.client.metadata.redirect)!=null&&P.linkMode&&(k=z.metadata.redirect)!=null&&k.linkMode&&(L=z.metadata.redirect)!=null&&L.universal&&i&&(this.client.core.addLinkModeSupportedApp(z.metadata.redirect.universal),this.client.session.update(G,{transportType:ae.link_mode})),U({auths:K,session:Z})};this.events.once(T,v),this.events.once(E,O);let R;try{if(s){const S=Kt("wc_sessionAuthenticate",A,D);this.client.core.history.set(I,S);const P=await this.client.core.crypto.encode("",S,{type:Ji,encoding:fr});R=bn(i,I,P)}else await Promise.all([this.sendRequest({topic:I,method:"wc_sessionAuthenticate",params:A,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:D}),this.sendRequest({topic:I,method:"wc_sessionPropose",params:$,expiry:Ae.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:$.id})])}catch(S){throw this.events.off(T,v),this.events.off(E,O),S}return await this.setProposal($.id,$),await this.setAuthRequest(D,{request:$e(re({},A),{verifyContext:{}}),pairingTopic:I,transportType:o}),{uri:R??w,response:N}}),F(this,"approveSessionAuthenticate",async r=>{const{id:i,auths:n}=r,s=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[Ir.authenticated_session_approve_started]}});try{this.isInitialized()}catch(y){throw s.setError(vi.no_internet_connection),y}const o=this.getPendingAuthRequest(i);if(!o)throw s.setError(vi.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const a=o.transportType||ae.relay;a===ae.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),l=In(c),h={type:Yt,receiverPublicKey:c,senderPublicKey:u},f=[],p=[];for(const y of n){if(!await $u({cacao:y,projectId:this.client.core.projectId})){s.setError(vi.invalid_cacao);const m=le("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:l,error:m,encodeOpts:h}),new Error(m.message)}s.addTrace(Ir.cacaos_verified);const{p:x}=y,I=_n(x.resources),w=[To(x.iss)],b=kn(x.iss);if(I){const m=Bu(I),_=Pu(I);f.push(...m),w.push(..._)}for(const m of w)p.push(`${m}:${b}`)}const d=await this.client.core.crypto.generateSharedKey(u,c);s.addTrace(Ir.create_authenticated_session_topic);let g;if(f?.length>0){g={topic:d,acknowledged:!0,self:{publicKey:u,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:we(Yr),authentication:n,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:il([...new Set(f)],[...new Set(p)]),transportType:a},s.addTrace(Ir.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(d,{transportType:a})}catch(y){throw s.setError(vi.subscribe_authenticated_session_topic_failure),y}s.addTrace(Ir.subscribe_authenticated_session_topic_success),await this.client.session.set(d,g),s.addTrace(Ir.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}s.addTrace(Ir.publishing_authenticated_session_approve);try{await this.sendResult({topic:l,id:i,result:{cacaos:n,responder:{publicKey:u,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(y){throw s.setError(vi.authenticated_session_approve_publish_failure),y}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:g}}),F(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:i,reason:n}=r,s=this.getPendingAuthRequest(i);if(!s)throw new Error(`Could not find pending auth request with id ${i}`);s.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=In(o),u={type:Yt,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:i,topic:c,error:n,encodeOpts:u,rpcOpts:Ae.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.deleteProposal(i)}),F(this,"formatAuthMessage",r=>{this.isInitialized();const{request:i,iss:n}=r;return Ff(i,n)}),F(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),F(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&s.topic&&s.topic!==i.topic});if(n.length===0)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),await Promise.all(n.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),F(this,"deleteSession",async r=>{var i;const{topic:n,expirerHasDeleted:s=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(n);await this.client.core.relayer.unsubscribe(n),await this.client.session.delete(n,le("USER_DISCONNECTED")),this.addToRecentlyDeleted(n,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(n)&&await this.client.core.crypto.deleteSymKey(n),s||this.client.core.expirer.del(n),this.client.core.storage.removeItem(Ml).catch(u=>this.client.logger.warn(u)),n===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=Dt.idle),await Promise.all(this.getPendingSessionRequests().filter(u=>u.topic===n).map(u=>this.deletePendingSessionRequest(u.id,le("USER_DISCONNECTED")))),o&&this.client.events.emit("session_delete",{id:a,topic:n})}),F(this,"deleteProposal",async(r,i)=>{if(i)try{const n=this.client.proposal.get(r);this.client.core.eventClient.getEvent({topic:n.pairingTopic})?.setError(_r.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,le("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),F(this,"deletePendingSessionRequest",async(r,i,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==r),n&&(this.sessionRequestQueue.state=Dt.idle,this.client.events.emit("session_request_expire",{id:r}))}),F(this,"deletePendingAuthRequest",async(r,i,n=!1)=>{await Promise.all([this.client.auth.requests.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)])}),F(this,"setExpiry",async(r,i)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,i),await this.client.session.update(r,{expiry:i}))}),F(this,"setProposal",async(r,i)=>{this.client.core.expirer.set(r,we(Ae.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,i)}),F(this,"setAuthRequest",async(r,i)=>{const{request:n,pairingTopic:s,transportType:o=ae.relay}=i;this.client.core.expirer.set(r,n.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:n.authPayload,requester:n.requester,expiryTimestamp:n.expiryTimestamp,id:r,pairingTopic:s,verifyContext:n.verifyContext,transportType:o})}),F(this,"setPendingSessionRequest",async r=>{const{id:i,topic:n,params:s,verifyContext:o}=r,a=s.request.expiryTimestamp||we(Ae.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,a),await this.client.pendingRequest.set(i,{id:i,topic:n,params:s,verifyContext:o})}),F(this,"sendRequest",async r=>{const{topic:i,method:n,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:u,appLink:l,tvf:h,publishOpts:f={}}=r,p=Kt(n,s,c);let d;const g=!!l;try{const I=g?fr:Ge;d=await this.client.core.crypto.encode(i,p,{encoding:I})}catch(I){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),I}let y;if(MD.includes(n)){const I=lt(JSON.stringify(p)),w=lt(d);y=await this.client.core.verify.register({id:w,decryptedId:I})}const x=re(re({},Ae[n].req),f);if(x.attestation=y,o&&(x.ttl=o),a&&(x.id=a),this.client.core.history.set(i,p),g){const I=bn(l,i,d);await global.Linking.openURL(I,this.client.name)}else x.tvf=$e(re({},h),{correlationId:p.id}),u?(x.internal=$e(re({},x.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,d,x)):this.client.core.relayer.publish(i,d,x).catch(I=>this.client.logger.error(I));return p.id}),F(this,"sendProposeSession",async r=>{const{proposal:i,publishOpts:n}=r,s=Kt("wc_sessionPropose",i,i.id);this.client.core.history.set(i.pairingTopic,s);const o=await this.client.core.crypto.encode(i.pairingTopic,s,{encoding:Ge}),a=lt(JSON.stringify(s)),c=lt(o),u=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:i.pairingTopic,sessionProposal:o},opts:$e(re({},n),{publishMethod:"wc_proposeSession",attestation:u})})}),F(this,"sendApproveSession",async r=>{const{sessionTopic:i,pairingProposalResponse:n,proposal:s,sessionSettleRequest:o,publishOpts:a}=r,c=zn(s.id,n),u=await this.client.core.crypto.encode(s.pairingTopic,c,{encoding:Ge}),l=Kt("wc_sessionSettle",o,a?.id),h=await this.client.core.crypto.encode(i,l,{encoding:Ge});this.client.core.history.set(i,l),await this.client.core.relayer.publishCustom({payload:{sessionTopic:i,pairingTopic:s.pairingTopic,sessionProposalResponse:u,sessionSettlementRequest:h},opts:$e(re({},a),{publishMethod:"wc_approveSession"})})}),F(this,"sendResult",async r=>{const{id:i,topic:n,result:s,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,u=zn(i,s);let l;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const d=h?fr:Ge;l=await this.client.core.crypto.encode(n,u,$e(re({},a||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${n} failed`),d}let f,p;try{f=await this.client.core.history.get(n,i);const d=f.request;try{p=this.getTVFParams(i,d.params,s)}catch(g){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${g?.message}`)}}catch(d){throw this.client.logger.error(`sendResult() -> history.get(${n}, ${i}) failed`),d}if(h){const d=bn(c,n,l);await global.Linking.openURL(d,this.client.name)}else{const d=f.request.method,g=Ae[d].res;g.tvf=$e(re({},p),{correlationId:i}),o?(g.internal=$e(re({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,l,g)):this.client.core.relayer.publish(n,l,g).catch(y=>this.client.logger.error(y))}await this.client.core.history.resolve(u)}),F(this,"sendError",async r=>{const{id:i,topic:n,error:s,encodeOpts:o,rpcOpts:a,appLink:c}=r,u=Ra(i,s);let l;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=h?fr:Ge;l=await this.client.core.crypto.encode(n,u,$e(re({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${n} failed`),p}let f;try{f=await this.client.core.history.get(n,i)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${n}, ${i}) failed`),p}if(h){const p=bn(c,n,l);await global.Linking.openURL(p,this.client.name)}else{const p=f.request.method,d=a||Ae[p].res;this.client.core.relayer.publish(n,l,d)}await this.client.core.history.resolve(u)}),F(this,"cleanup",async()=>{const r=[],i=[];this.client.session.getAll().forEach(n=>{let s=!1;or(n.expiry)&&(s=!0),this.client.core.crypto.keychain.has(n.topic)||(s=!0),s&&r.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{or(n.expiryTimestamp)&&i.push(n.id)}),await Promise.all([...r.map(n=>this.deleteSession({topic:n})),...i.map(n=>this.deleteProposal(n))])}),F(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),F(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),F(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===Dt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Dt.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=Dt.idle}),F(this,"processRequest",async r=>{const{topic:i,payload:n,attestation:s,transportType:o,encryptedId:a}=r,c=n.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:n,attestation:s,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,n);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,n);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,n);case"wc_sessionPing":return await this.onSessionPingRequest(i,n);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,n);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:n,attestation:s,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(i,n);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:n,attestation:s,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),F(this,"onRelayEventResponse",async r=>{const{topic:i,payload:n,transportType:s}=r,o=(await this.client.core.history.get(i,n.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,n,s);case"wc_sessionSettle":return this.onSessionSettleResponse(i,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,n);case"wc_sessionExtend":return this.onSessionExtendResponse(i,n);case"wc_sessionPing":return this.onSessionPingResponse(i,n);case"wc_sessionRequest":return this.onSessionRequestResponse(i,n);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,n);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),F(this,"onRelayEventUnknownPayload",r=>{const{topic:i}=r,{message:n}=q("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(n)}),F(this,"shouldIgnorePairingRequest",r=>{const{topic:i,requestMethod:n}=r,s=this.expectedPairingMethodMap.get(i);return!s||s.includes(n)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),F(this,"onSessionProposeRequest",async r=>{const{topic:i,payload:n,attestation:s,encryptedId:o}=r,{params:a,id:c}=n;try{const u=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),u?.setError(qt.proposal_listener_not_found)),this.isValidConnect(re({},n.params));const l=a.expiryTimestamp||we(Ae.wc_sessionPropose.req.ttl),h=re({id:c,pairingTopic:i,expiryTimestamp:l,attestation:s,encryptedId:o},a);await this.setProposal(c,h);const f=await this.getVerifyContext({attestationId:s,hash:lt(JSON.stringify(n)),encryptedId:o,metadata:h.proposer.metadata});u?.addTrace(Ot.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:f})}catch(u){await this.sendError({id:c,topic:i,error:u,rpcOpts:Ae.wc_sessionPropose.autoReject}),this.client.logger.error(u)}}),F(this,"onSessionProposeResponse",async(r,i,n)=>{const{id:s}=i;if($t(i)){const{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const u=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u});const l=await this.client.core.crypto.generateSharedKey(c,u);this.pendingSessions.set(s,{sessionTopic:l,pairingTopic:r,proposalId:s,publicKey:c});const h=await this.client.core.relayer.subscribe(l,{transportType:n});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:r})}else if(ht(i)){await this.deleteProposal(s);const o=ie("session_connect",s);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:i.error})}}),F(this,"onSessionSettleRequest",async(r,i)=>{const{id:n,params:s}=i;try{this.isValidSessionSettleRequest(s);const{relay:o,controller:a,expiry:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:f,proposalRequestsResponses:p}=i.params,d=[...this.pendingSessions.values()].find(x=>x.sessionTopic===r);if(!d)return this.client.logger.error(`Pending session not found for topic ${r}`);const g=this.client.proposal.get(d.proposalId),y=$e(re(re(re({topic:r,relay:o,expiry:c,namespaces:u,acknowledged:!0,pairingTopic:d.pairingTopic,requiredNamespaces:g.requiredNamespaces,optionalNamespaces:g.optionalNamespaces,controller:a.publicKey,self:{publicKey:d.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},l&&{sessionProperties:l}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{transportType:ae.relay,authentication:p?.authentication,walletPayResult:p?.walletPay});await this.client.session.set(y.topic,y),await this.setExpiry(y.topic,y.expiry),await this.client.core.pairing.updateMetadata({topic:d.pairingTopic,metadata:y.peer.metadata}),this.pendingSessions.delete(d.proposalId),this.deleteProposal(d.proposalId,!1),this.cleanupDuplicatePairings(y),await this.sendResult({id:i.id,topic:r,throwOnFailedPublish:!0,result:!0}),this.client.events.emit("session_connect",{session:y}),this.events.emit(ie("session_connect",d.proposalId),{session:y})}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"onSessionSettleResponse",async(r,i)=>{const{id:n}=i;$t(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(ie("session_approve",n),{})):ht(i)&&(await this.client.session.delete(r,le("USER_DISCONNECTED")),this.events.emit(ie("session_approve",n),{error:i.error}))}),F(this,"onSessionUpdateRequest",async(r,i)=>{const{params:n,id:s}=i;try{const o=`${r}_session_update`,a=bi.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.warn(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:r,error:le("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(re({topic:r},n));try{bi.set(o,s),await this.client.session.update(r,{namespaces:n.namespaces}),await this.sendResult({id:s,topic:r,result:!0})}catch(c){throw bi.delete(o),c}this.client.events.emit("session_update",{id:s,topic:r,params:n})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"isRequestOutOfSync",(r,i)=>i.toString().slice(0,-3)<r.toString().slice(0,-3)),F(this,"onSessionUpdateResponse",(r,i)=>{const{id:n}=i,s=ie("session_update",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);$t(i)?this.events.emit(ie("session_update",n),{}):ht(i)&&this.events.emit(ie("session_update",n),{error:i.error})}),F(this,"onSessionExtendRequest",async(r,i)=>{const{id:n}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,we(Yr)),await this.sendResult({id:n,topic:r,result:!0}),this.client.events.emit("session_extend",{id:n,topic:r})}catch(s){await this.sendError({id:n,topic:r,error:s}),this.client.logger.error(s)}}),F(this,"onSessionExtendResponse",(r,i)=>{const{id:n}=i,s=ie("session_extend",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);$t(i)?this.events.emit(ie("session_extend",n),{}):ht(i)&&this.events.emit(ie("session_extend",n),{error:i.error})}),F(this,"onSessionPingRequest",async(r,i)=>{const{id:n}=i;try{this.isValidPing({topic:r}),await this.sendResult({id:n,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:n,topic:r})}catch(s){await this.sendError({id:n,topic:r,error:s}),this.client.logger.error(s)}}),F(this,"onSessionPingResponse",(r,i)=>{const{id:n}=i,s=ie("session_ping",n);setTimeout(()=>{if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners 2176`);$t(i)?this.events.emit(ie("session_ping",n),{}):ht(i)&&this.events.emit(ie("session_ping",n),{error:i.error})},500)}),F(this,"onSessionDeleteRequest",async(r,i)=>{const{id:n}=i;try{await this.isValidDisconnect({topic:r,reason:i.params}),this.cleanupPendingSentRequestsForTopic({topic:r,error:le("USER_DISCONNECTED")}),await this.deleteSession({topic:r,id:n})}catch(s){this.client.logger.error(s)}}),F(this,"onSessionRequest",async r=>{var i,n,s;const{topic:o,payload:a,attestation:c,encryptedId:u,transportType:l}=r,{id:h,params:f}=a;try{await this.isValidRequest(re({topic:o},f));const p=this.client.session.get(o),d=await this.getVerifyContext({attestationId:c,hash:lt(JSON.stringify(Kt("wc_sessionRequest",f,h))),encryptedId:u,metadata:p.peer.metadata,transportType:l}),g={id:h,topic:o,params:f,verifyContext:d};await this.setPendingSessionRequest(g),l===ae.link_mode&&(i=p.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((n=p.peer.metadata.redirect)==null?void 0:n.universal),(s=this.client.signConfig)!=null&&s.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(p){await this.sendError({id:h,topic:o,error:p}),this.client.logger.error(p)}}),F(this,"onSessionRequestResponse",(r,i)=>{const{id:n}=i,s=ie("session_request",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);$t(i)?this.events.emit(ie("session_request",n),{result:i.result}):ht(i)&&this.events.emit(ie("session_request",n),{error:i.error})}),F(this,"onSessionEventRequest",async(r,i)=>{const{id:n,params:s}=i;try{const o=`${r}_session_event_${s.event.name}`,a=bi.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.info(`Discarding out of sync request - ${n}`);return}this.isValidEmit(re({topic:r},s)),this.client.events.emit("session_event",{id:n,topic:r,params:s}),bi.set(o,n)}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"onSessionAuthenticateResponse",(r,i)=>{const{id:n}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:i}),$t(i)?this.events.emit(ie("session_request",n),{result:i.result}):ht(i)&&this.events.emit(ie("session_request",n),{error:i.error})}),F(this,"onSessionAuthenticateRequest",async r=>{var i;const{topic:n,payload:s,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:u,authPayload:l,expiryTimestamp:h}=s.params,f=await this.getVerifyContext({attestationId:o,hash:lt(JSON.stringify(s)),encryptedId:a,metadata:u.metadata,transportType:c}),p={requester:u,pairingTopic:n,id:s.id,authPayload:l,verifyContext:f,expiryTimestamp:h};await this.setAuthRequest(s.id,{request:p,pairingTopic:n,transportType:c}),c===ae.link_mode&&(i=u.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(u.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:n,params:s.params,id:s.id,verifyContext:f})}catch(u){this.client.logger.error(u);const l=s.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),f=this.getAppLinkIfEnabled(s.params.requester.metadata,c),p={type:Yt,receiverPublicKey:l,senderPublicKey:h};await this.sendError({id:s.id,topic:n,error:u,encodeOpts:p,rpcOpts:Ae.wc_sessionAuthenticate.autoReject,appLink:f})}}),F(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),F(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Dt.idle,this.processSessionRequestQueue()},M.toMiliseconds(this.requestQueueDelay))}),F(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:i})=>{const n=this.client.core.history.pending;n.length>0&&n.filter(s=>s.topic===r&&s.request.method==="wc_sessionRequest").forEach(s=>{this.events.emit(ie("session_request",s.request.id),{error:i})})}),F(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Dt.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(r)}catch(i){this.client.logger.error(i)}}),F(this,"emitSessionRequest",r=>{if(this.emittedSessionRequests.has(r.id)){this.client.logger.warn({id:r.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${r.id}`);return}this.sessionRequestQueue.state=Dt.active,this.emittedSessionRequests.add(r.id),this.client.events.emit("session_request",r)}),F(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const i=this.client.proposal.getAll().find(n=>n.pairingTopic===r.topic);i&&this.onSessionProposeRequest({topic:r.topic,payload:Kt("wc_sessionPropose",$e(re({},i),{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties,scopedProperties:i.scopedProperties}),i.id),attestation:i.attestation,encryptedId:i.encryptedId})}),F(this,"isValidConnect",async r=>{if(!Ke(r)){const{message:u}=q("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(u)}const{pairingTopic:i,requiredNamespaces:n,optionalNamespaces:s,sessionProperties:o,scopedProperties:a,relays:c}=r;if(Ie(i)||await this.isValidPairingTopic(i),!t_(c)){const{message:u}=q("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}if(n&&!Ie(n)&&Fi(n)!==0){const u="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(u):this.client.logger.warn(u),this.validateNamespaces(n,"requiredNamespaces")}if(s&&!Ie(s)&&Fi(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),o&&!Ie(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Ie(a)){this.validateSessionProps(a,"scopedProperties");const u=Object.keys(n||{}).concat(Object.keys(s||{}));if(!Object.keys(a).every(l=>u.includes(l.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(u)}`)}}),F(this,"validateNamespaces",(r,i)=>{const n=e_(r,"connect()",i);if(n)throw new Error(n.message)}),F(this,"isValidApprove",async r=>{if(!Ke(r))throw new Error(q("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:n,relayProtocol:s,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const c=this.client.proposal.get(i),u=Qs(n,"approve()");if(u)throw new Error(u.message);const l=ol(c.requiredNamespaces,n,"approve()");if(l)throw new Error(l.message);if(!pe(s,!0)){const{message:h}=q("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(h)}if(o&&!Ie(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Ie(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(n));if(!Object.keys(a).every(f=>h.has(f.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),F(this,"isValidReject",async r=>{if(!Ke(r)){const{message:s}=q("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(s)}const{id:i,reason:n}=r;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!i_(n)){const{message:s}=q("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(s)}}),F(this,"isValidSessionSettleRequest",r=>{if(!Ke(r)){const{message:u}=q("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(u)}const{relay:i,controller:n,namespaces:s,expiry:o}=r;if(!Id(i)){const{message:u}=q("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(u)}const a=G3(n,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=Qs(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(or(o)){const{message:u}=q("EXPIRED","onSessionSettleRequest()");throw new Error(u)}}),F(this,"isValidUpdate",async r=>{if(!Ke(r)){const{message:c}=q("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:i,namespaces:n}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const s=this.client.session.get(i),o=Qs(n,"update()");if(o)throw new Error(o.message);const a=ol(s.requiredNamespaces,n,"update()");if(a)throw new Error(a.message)}),F(this,"isValidExtend",async r=>{if(!Ke(r)){const{message:n}=q("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(n)}const{topic:i}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),F(this,"isValidRequest",async r=>{if(!Ke(r)){const{message:c}=q("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:i,request:n,chainId:s,expiry:o}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!sl(a,s)){const{message:c}=q("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!n_(n)){const{message:c}=q("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(c)}if(!a_(a,s,n.method)){const{message:c}=q("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(c)}this.validateRequestExpiry(o)}),F(this,"isValidRespond",async r=>{var i;if(!Ke(r)){const{message:a}=q("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(a)}const{topic:n,response:s}=r;try{await this.isValidSessionTopic(n)}catch(a){throw(i=r?.response)!=null&&i.id&&this.cleanupAfterResponse(r),a}if(!s_(s)){const{message:a}=q("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(a)}const o=this.client.pendingRequest.get(s.id);if(o.topic!==n){const{message:a}=q("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${s.id}, expected topic: ${o.topic}, received topic: ${n}`);throw new Error(a)}}),F(this,"isValidPing",async r=>{if(!Ke(r)){const{message:n}=q("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),F(this,"isValidEmit",async r=>{if(!Ke(r)){const{message:a}=q("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:i,event:n,chainId:s}=r;await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!sl(o,s)){const{message:a}=q("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!o_(n)){const{message:a}=q("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}if(!c_(o,s,n.name)){const{message:a}=q("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}}),F(this,"isValidDisconnect",async r=>{if(!Ke(r)){const{message:n}=q("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),F(this,"isValidAuthenticate",r=>{const{chains:i,uri:n,domain:s,nonce:o}=r;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!pe(n,!1))throw new Error("uri is required parameter");if(!pe(s,!1))throw new Error("domain is required parameter");if(!pe(o,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(c=>xn(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=xn(i[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),F(this,"getVerifyContext",async r=>{const{attestationId:i,hash:n,encryptedId:s,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||Bi,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ae.link_mode){const l=this.getAppLinkIfEnabled(o,a);return c.verified.validation=l&&new URL(l).origin===new URL(o.url).origin?"VALID":"INVALID",c}const u=await this.client.core.verify.resolve({attestationId:i,hash:n,encryptedId:s,verifyUrl:o.verifyUrl});u&&(c.verified.origin=u.origin,c.verified.isScam=u.isScam,c.verified.validation=u.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.warn(u)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),F(this,"validateSessionProps",(r,i)=>{Object.values(r).forEach((n,s)=>{if(n==null){const{message:o}=q("MISSING_OR_INVALID",`${i} must contain an existing value for each key. Received: ${n} for key ${Object.keys(r)[s]}`);throw new Error(o)}})}),F(this,"getPendingAuthRequest",r=>{const i=this.client.auth.requests.get(r);return typeof i=="object"?i:void 0}),F(this,"addToRecentlyDeleted",(r,i)=>{if(this.recentlyDeletedMap.set(r,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let n=0;const s=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(n++>=s)break;this.recentlyDeletedMap.delete(o)}}}),F(this,"checkRecentlyDeleted",r=>{const i=this.recentlyDeletedMap.get(r);if(i){const{message:n}=q("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${r}`);throw new Error(n)}}),F(this,"isLinkModeEnabled",(r,i)=>{var n,s,o,a,c,u,l,h,f;return!r||i!==ae.link_mode?!1:((s=(n=this.client.metadata)==null?void 0:n.redirect)==null?void 0:s.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((u=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:u.universal)!==""&&((l=r?.redirect)==null?void 0:l.universal)!==void 0&&((h=r?.redirect)==null?void 0:h.universal)!==""&&((f=r?.redirect)==null?void 0:f.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),F(this,"getAppLinkIfEnabled",(r,i)=>{var n;return this.isLinkModeEnabled(r,i)?(n=r?.redirect)==null?void 0:n.universal:void 0}),F(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const i=wu(r,"topic")||"",n=decodeURIComponent(wu(r,"wc_ev")||""),s=this.client.session.keys.includes(i);s&&this.client.session.update(i,{transportType:ae.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:n,sessionExists:s})}),F(this,"registerLinkModeListeners",async()=>{var r;if(Ea()||br()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const i=global==null?void 0:global.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const n=await i.getInitialURL();n&&setTimeout(()=>{this.handleLinkModeMessage({url:n})},50)}}}),F(this,"getTVFApproveParams",r=>{try{const i=Ed(r.namespaces),n=C3(r.namespaces),s=N3(r.namespaces),o=r.sessionProperties,a=r.scopedProperties;return{approvedChains:i,approvedMethods:n,approvedEvents:s,sessionProperties:o,scopedProperties:a}}catch(i){return this.client.logger.warn(i,"Error getting TVF approve params"),{}}}),F(this,"getTVFParams",(r,i,n)=>{var s,o,a;if(!((s=i.request)!=null&&s.method))return{};const c={correlationId:r,rpcMethods:[i.request.method],chainId:i.chainId};try{const u=this.extractTxHashesFromResult(i.request,n);c.txHashes=u,c.contractAddresses=this.isValidContractData(i.request.params)?[(a=(o=i.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(u){this.client.logger.warn(u,"Error getting TVF params")}return c}),F(this,"isValidContractData",r=>{var i;if(!r)return!1;try{const n=r?.data||((i=r?.[0])==null?void 0:i.data);if(!n.startsWith("0x"))return!1;const s=n.slice(2);return/^[0-9a-fA-F]*$/.test(s)?s.length%2===0:!1}catch{}return!1}),F(this,"extractTxHashesFromResult",(r,i)=>{var n;try{if(!i)return[];const s=r.method,o=LD[s];if(s==="sui_signTransaction")return[_E(i.transactionBytes)];if(s==="near_signTransaction")return[Su(i)];if(s==="near_signTransactions")return i.map(c=>Su(c));if(s==="xrpl_signTransactionFor"||s==="xrpl_signTransaction")return[(n=i.tx_json)==null?void 0:n.hash];if(s==="polkadot_signTransaction")return[D_({transaction:r.params.transactionPayload,signature:i.signature})];if(s==="algo_signTxn")return si(i)?i.map(c=>Du(c)):[Du(i)];if(s==="cosmos_signDirect")return[SE(i)];if(s==="wallet_sendCalls")return DE(i);if(typeof i=="string")return[i];const a=i[o.key];if(si(a))return s==="solana_signAllTransactions"?a.map(c=>xE(c)):a;if(typeof a=="string")return[a]}catch(s){this.client.logger.warn(s,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[i,n]of Object.entries(r))for(const s of n)try{await this.onProviderMessageEvent({topic:i,message:s,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${s}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(de.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:i,attestation:n,transportType:s}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Dn)?this.client.auth.authKeys.get(Dn):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,i,{receiverPublicKey:o,encoding:s===ae.link_mode?fr:Ge});Ca(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:n,transportType:s,encryptedId:lt(i)})):os(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:s}),this.client.core.history.delete(r,a.id)):(this.client.logger.error(`onRelayMessage() -> unknown payload: ${JSON.stringify(a)}`),await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:s})),await this.client.core.relayer.messages.ack(r,i)}catch(a){this.client.logger.error(`onRelayMessage() -> failed to process an inbound message: ${i}`),this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(ct.expired,async e=>{const{topic:r,id:i}=xf(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,q("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,q("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(Or.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Or.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!pe(e,!1)){const{message:r}=q("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=q("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(or(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=q("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!pe(e,!1)){const{message:r}=q("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=q("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(or(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=q("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=q("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(pe(e,!1)){const{message:r}=q("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=q("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!r_(e)){const{message:r}=q("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=q("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(or(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=q("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}validateRequestExpiry(e){if(e&&!h_(e,oo)){const{message:r}=q("MISSING_OR_INVALID",`request() expiry: ${e}. Expiry must be a number (in seconds) between ${oo.min} and ${oo.max}`);throw new Error(r)}}}class JD extends qr{constructor(e,r){super(e,r,ND,Ua),this.core=e,this.logger=r}}class QD extends qr{constructor(e,r){super(e,r,UD,Ua),this.core=e,this.logger=r}}class eO extends qr{constructor(e,r){super(e,r,FD,Ua,i=>i.id),this.core=e,this.logger=r}}class tO extends qr{constructor(e,r){super(e,r,zD,cs,()=>Dn),this.core=e,this.logger=r}}class rO extends qr{constructor(e,r){super(e,r,VD,cs),this.core=e,this.logger=r}}class iO extends qr{constructor(e,r){super(e,r,KD,cs,i=>i.id),this.core=e,this.logger=r}}var nO=Object.defineProperty,sO=(t,e,r)=>e in t?nO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ao=(t,e,r)=>sO(t,typeof e!="symbol"?e+"":e,r);class oO{constructor(e,r){this.core=e,this.logger=r,ao(this,"authKeys"),ao(this,"pairingTopics"),ao(this,"requests"),this.authKeys=new tO(this.core,this.logger),this.pairingTopics=new rO(this.core,this.logger),this.requests=new iO(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var aO=Object.defineProperty,cO=(t,e,r)=>e in t?aO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Q=(t,e,r)=>cO(t,typeof e!="symbol"?e+"":e,r);class ka extends Ry{constructor(e){super(e),Q(this,"protocol",Kd),Q(this,"version",Hd),Q(this,"name",so.name),Q(this,"metadata"),Q(this,"core"),Q(this,"logger"),Q(this,"events",new Et.EventEmitter),Q(this,"engine"),Q(this,"session"),Q(this,"proposal"),Q(this,"pendingRequest"),Q(this,"auth"),Q(this,"signConfig"),Q(this,"on",(i,n)=>this.events.on(i,n)),Q(this,"once",(i,n)=>this.events.once(i,n)),Q(this,"off",(i,n)=>this.events.off(i,n)),Q(this,"removeListener",(i,n)=>this.events.removeListener(i,n)),Q(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),Q(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"update",async i=>{try{return await this.engine.update(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"request",async i=>{try{return await this.engine.request(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"find",i=>{try{return this.engine.find(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),Q(this,"authenticate",async(i,n)=>{try{return await this.engine.authenticate(i,n)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(n){throw this.logger.error(n.message),n}}),this.name=e?.name||so.name,this.metadata=g2(e?.metadata),this.signConfig=e?.signConfig;const r=Sd({logger:e?.logger||so.logger,name:this.name});this.logger=r,this.core=e?.core||new CD(e),this.session=new QD(this.core,this.logger),this.proposal=new JD(this.core,this.logger),this.pendingRequest=new eO(this.core,this.logger),this.engine=new XD(this),this.auth=new oO(this.core,this.logger)}static async init(e){const r=new ka(e);return await r.initialize(),r}get context(){return Je(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const WO=ka;export{jD as AUTH_CONTEXT,zD as AUTH_KEYS_CONTEXT,VD as AUTH_PAIRING_TOPIC_CONTEXT,qD as AUTH_PROTOCOL,Dn as AUTH_PUBLIC_KEY_NAME,KD as AUTH_REQUEST_CONTEXT,cs as AUTH_STORAGE_PREFIX,kD as ENGINE_CONTEXT,Dt as ENGINE_QUEUE_STATES,Ae as ENGINE_RPC_OPTS,MD as METHODS_TO_VERIFY,ND as PROPOSAL_CONTEXT,ql as PROPOSAL_EXPIRY_MESSAGE,FD as REQUEST_CONTEXT,UD as SESSION_CONTEXT,Yr as SESSION_EXPIRY,oo as SESSION_REQUEST_EXPIRY_BOUNDARIES,Wd as SIGN_CLIENT_CONTEXT,so as SIGN_CLIENT_DEFAULT,Kd as SIGN_CLIENT_PROTOCOL,Ua as SIGN_CLIENT_STORAGE_PREFIX,Hd as SIGN_CLIENT_VERSION,WO as SignClient,LD as TVF_METHODS,Ml as WALLETCONNECT_DEEPLINK_CHOICE,ka as default};
