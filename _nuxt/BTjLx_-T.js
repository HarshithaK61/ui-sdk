import{SignClient as p}from"./Byf87tck.js";import{g as h,w as u}from"./r58-h6F_.js";import{_ as r,G as l,w as o}from"./C3yoewId.js";const d="8b6c46b9127ce91195745c124870244e";class S{wc_client;session=null;approval;uri="";onSessionApproved;async initClient(){this.wc_client=await p.init({projectId:d,metadata:{name:"3P Account Wallet",description:"dApp initiating connection",url:"http://localhost:3000",icons:["https://app-a.com/icon.png"]}}),this.wc_client.on("session_event",e=>{const{event:s}=e;console.log("ðŸŽ‰ Aaccount wallet received:"+s.data.message),alert("ðŸŽ‰ Aaccount wallet received:"+s.data.message)}),this.wc_client.on("session_authenticate",e=>{console.log("session_authenticate:",e)}),this.wc_client.on("session_delete",e=>{console.log("session_delete:",e),alert("Session was deleted from idapp, topic = "+e.topic),window.location.reload()}),this.wc_client.on("session_request_expire",e=>{console.log("session_request_expire:",e),alert("Session Request Expired, topic "+e.topic),window.location.reload()}),this.printPairing(),this.printSessions()}getListOfPairing(){return this.wc_client.pairing.getAll()}getListOfSessions(){return this.wc_client.session.getAll()}getMostNewSession(){const e=this.getListOfSessions();if(e&&e.length>0){const s=Math.floor(Date.now()/1e3),t=e.filter(n=>n.expiry>s);return t.length===0?null:(t.sort((n,i)=>i.expiry-n.expiry),t[0])}else return null}async connect(e){try{if(!this.wc_client)throw new Error("SDK not initialized");console.log("Before connecting...");const s=this.wc_client.getPendingSessionRequests();console.log("Pending requests: ",s),this.printSessions();const t=this.printPairing();console.log("Connecting to wallet..."),console.log("Using chainId for WC session proposal:",e);const n={ccd:{methods:[],chains:[e],events:[r.CREATE_ACCOUNT]}};console.log(JSON.stringify(n,null,2));const{uri:i,approval:g}=await this.wc_client.connect({optionalNamespaces:{...n},pairingTopic:void 0});return this.uri=i,console.log("Wallet connect URI: ",i),console.log("Waiting for approval..."),g().then(c=>{console.log("Session approved:",c),this.session=c,console.log("Session expires at:",this.formatExpiryIST(this.session.expiry)),this.printPairing(),this.printSessions(),l.closePopup(),this.onSessionApproved&&this.onSessionApproved(this.session)}).catch(c=>{console.log("Session rejected:",c),alert("Session rejected: "+c),l.closePopup()}),i}catch(s){console.log(s)}}print(e,s="Session"){e&&console.log({type:s,topic:e.topic,expiry:this.formatExpiryIST(e.expiry)})}async printSessions(){const e=this.wc_client.session.getAll();if(console.log("Existing sessions: ",e),e.length>0){console.log("Existing sessions found, lenght  "+e.length);for(const s of e)this.print(s,"Session");console.log(e[0])}}printPairing(){const s=this.wc_client.pairing.getAll().find(t=>t?.active);return s?(console.log("Pairing expires at:",this.formatExpiryIST(s.expiry)),this.print(s,"Pair")):console.log("no pairing found..."),s}formatExpiryIST=e=>new Date(e*1e3).toLocaleString("en-IN",{timeZone:"Asia/Kolkata",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});disconnection(e=this.session.topic){if(!this.wc_client)throw new Error("SDK not initialized");return console.log({topic:e}),this.wc_client.disconnect({topic:e,reason:new Error("User disconnected")})}async disconnectall(){const e=this.getListOfSessions();if(e.length>0){console.log("Existing sessions found, disconnecting them...");for(const s of e)console.log("disconnecting... "+s.topic),await this.disconnection(s.topic)}else console.log("No session found to disconnect...")}async request(e="custom_message",s,t){if(console.log("Inside request method:",{chainId:s}),!this.wc_client)throw new Error("SDK not initialized");return this.session||(this.session=this.getMostNewSession(),console.log("Retrived sessions being used... "+this.session.topic)),await this.wc_client.request({topic:this.session.topic,chainId:s,request:{method:e,params:t}})}}class m{accountWallet;seed;constructor(e,s){this.accountWallet=e,this.seed=s||h(u,256)}getWallet(e){return o.generateAccountWithSeedPhrase(this.seed,e,0)}async signTransaction(e,s){const t=this.getWallet(s);return await o.signCredentialTransaction(e,t.signingKey)}async submitTransaction(e,s,t){return await o.submitCCDTransaction(e,s,t)}async createCCDAccount(e){localStorage.removeItem("pk");const t=this.getWallet(e).publicKey;localStorage.setItem("pk",t);const n=o.getCreateAccountCreationRequest(t,"I want to create a new Concordium account");return console.log("Sending account creation request with public_key "+t),{create_acc_resp:await this.accountWallet.request(r.CREATE_ACCOUNT,e=="Mainnet"?o.chainId.Mainnet:o.chainId.Testnet,n),public_key:t}}async recoverCCDAccount(e,s="Mainnet"){return{account_address:"test"}}}export{S as A,m as a};
