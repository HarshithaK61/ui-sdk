import{_ as K}from"./vNnR1kqW.js";import{d as R,j as l,P as j,U as B,l as $,M as H,x as V,o as p,y as g,e as m,I as q,a as s,K as z,c as f,R as T,S as I,F as i,B as F,b as G,C as x}from"./CIKIahH0.js";import{A as M,a as Z}from"./BTjLx_-T.js";import{G as a,w as J,Z as Q}from"./C3yoewId.js";import"./DrY-ABih.js";import"./Byf87tck.js";import"./8NJXV5Ny.js";import"./r58-h6F_.js";const X={class:"flex justify-between items-center mb-2"},Y={class:"divide-y divide-gray-200",style:{"max-height":"300px","overflow-y":"auto"}},ee={class:"flex flex-col"},oe={class:"text-base font-medium text-white-800"},te={class:"text-sm text-gray-500 whitespace-nowrap"},ne={class:"text-sm text-gray-500 whitespace-nowrap"},se={class:"text-sm text-gray-600 whitespace-nowrap"},ae=["onClick"],C="Testnet",ve=R({__name:"enable-network-testnet",setup(le){const u=l(),t=l(),w=l(""),_=l(""),v=j("showLoader"),P=l(!1);l(localStorage.getItem("pk")),l(localStorage.getItem("accountAddress"));const D=async()=>{await t.value?.disconnectall(),window.location.reload()},h=["Ethereum","Concordium ("+C+")","Bitcoin"],A=B(h.reduce((o,e)=>(o[e]=!1,o),{}));function E(o,e){console.log(`${o} toggled to: ${e}`),S(),A[o]=e}const O=l([]),d=l([]),N=async o=>{console.log({topic:o}),await t.value?.disconnection(o),window.location.reload()};$(async()=>{v.value=!0,t.value=new M,await t.value.initClient(),v.value=!1,u.value=new Z(t.value),a.closePopup(),d.value=t.value.getListOfSessions(),O.value=t.value.getListOfPairing()}),H(()=>t.value?.session,(o,e)=>{console.log({oldVal:e,newVal:o}),(o!=null||o!=null)&&(console.log("Wallect Connect Session Establised "+o?.topic),w.value="",P.value=!0,S())});const S=async()=>{if(console.log(t.value?.session),t.value?.getListOfSessions().length==0){if(console.log("No Wallet Connect Session"),v.value=!0,await L(),v.value=!1,d.value=t.value.getListOfSessions(),!t.value.uri){alert("Could not connect to wallet connect server, please reload the page and try again in sometime. ");return}a.invokeIdAppDeepLinkPopup({walletConnectUri:t.value.uri});return}a.invokeIdAppActionsPopup({onCreateAccount:U,onRecoverAccount:W,walletConnectSessionTopic:t.value?.getListOfSessions()[0]?.topic})},L=async()=>{if(!t.value){console.error("WalletConnect client is not initialized"),a.closePopup();return}await t.value.connect(J.chainId.Testnet)},b=async()=>{console.log("Opening openIdapp.."),/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)?(console.log("Opening Idapp on mobile..."),window.location.href=_.value):console.log("Opening Idapp on desktop...")},U=async()=>{console.log("beefore calling createCCDAccount..."),u.value?.createCCDAccount(C).then(async o=>{if(!o){alert("Error: Could not create account from Idapp");return}const{create_acc_resp:e,public_key:y}=o;if(console.log(y),e.status==Q.SUCCESS){const c=e.message;if(console.log("Recieved account creation response account_address "+c.accountAddress),console.log("ConcordiumIDAppSDK.signCredentialTransaction ..."),console.log({resp:c}),confirm("Signature Request: Please approve to sign the transaction?")){const r=await u.value?.signTransaction(c.serializedCredentialDeploymentTransaction,C);if(!r){alert("Error: Could generate signature");return}console.log({signedCreddepTx:r}),console.log("ConcordiumIDAppSDK.submitCCDTransaction ...");try{const n=await u.value?.submitTransaction(r.credentialDeploymentTransaction,r.signature,C);console.log({txHash:n?.toString()}),console.log(o),alert(`Account created successfully with address: ${c?.accountAddress} 

Transaction Hash: ${n?.toString()}`),a.closePopup()}catch(n){alert(n?.message),a.closePopup()}}else alert("Signature request rejected"),a.closePopup()}else console.log(e),alert(`Request rejected : ${e?.message?.details} `),window.location.reload()}).catch(o=>{a.closePopup(),console.error("Error creating account:",o),alert("Error creating account: "+o.message),window.location.reload()}),setTimeout(()=>{console.log("after calling createCCDAccount..."),console.log("Opening Idapp..."),_.value="concordiumidapp://id-signup",w.value="http://localhost:5173/id-signup",b(),console.log("after calling createCCDAccount...")},2e3)},W=async()=>{const o=localStorage.getItem("pk");o?(u.value?.recoverCCDAccount(o).then(e=>{console.log(e),alert("Account recovered successfully with address: "+e?.account_address),localStorage.setItem("accountAddress",e?.account_address),a.closePopup()}).catch(e=>{a.closePopup(),console.error("Error recovering account:",e),alert("Error recovering account: "+e.message),window.location.reload()}),setTimeout(()=>{console.log("after calling onRecoverAccount..."),console.log("Opening Idapp..."),_.value="concordiumidapp://id-signup",w.value="http://localhost:5173/id-signup",b()},2e3)):alert("No pk found")};return(o,e)=>{const y=K,c=z,r=q;return p(),V(c,null,{default:g(()=>[m(r,null,{default:g(()=>[e[0]||(e[0]=s("h2",null,"CHOOSE NETWORK",-1)),m(c,null,{default:g(()=>[(p(),f(T,null,I(h,n=>s("div",{key:n,class:"flex items-center justify-between",style:{"margin-top":"10px"}},[s("span",null,i(n),1),m(y,{"model-value":F(A)[n],"onUpdate:modelValue":k=>E(n,k)},null,8,["model-value","onUpdate:modelValue"])])),64))]),_:1})]),_:1}),m(r,null,{default:g(()=>[s("div",X,[s("h2",null,"ACTIVE CONNECTIONS ("+i(d.value.length)+")",1),d.value.length>0?(p(),f("button",{key:0,class:"px-3 py-1 text-sm text-red-600 border border-red-600 rounded hover:bg-red-50",onClick:D}," Disconnect All ")):G("",!0)]),m(c,null,{default:g(()=>[s("ul",Y,[(p(!0),f(T,null,I(d.value,n=>(p(),f("li",{key:n.topic,class:"flex justify-between items-center py-3"},[s("div",ee,[s("span",oe,i(n.peer.metadata?.name||"Unknown App"),1),s("span",te,[e[1]||(e[1]=s("strong",null,"Topic:",-1)),x(" "+i(n.topic||"No Topic"),1)]),s("span",ne,[e[2]||(e[2]=s("strong",null,"Public Key:",-1)),x(" "+i(n.peer.publicKey||"No Publickey"),1)]),s("span",se,[e[3]||(e[3]=s("strong",null,"Expires on:",-1)),x(" "+i(t.value.formatExpiryIST(n.expiry)),1)])]),s("button",{class:"ml-4 px-3 py-1 text-sm text-red-600 border border-red-600 rounded hover:bg-red-50",onClick:k=>N(n.topic)}," Disconnect ",8,ae)]))),128))])]),_:1})]),_:1})]),_:1})}}});export{ve as default};
