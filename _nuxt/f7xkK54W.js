const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CaZJUk3F.js","./CIKIahH0.js","./entry.Bv58BlFP.css","./DQ1KZ1g8.js","./DcQm8KL9.js","./Byf87tck.js","./8NJXV5Ny.js","./F59h6q9d.js","./1-Zg5deT.js","./BABfCjG8.js","./UmyAeyn-.js"])))=>i.map(i=>d[i]);
import{D as h,j as I}from"./CIKIahH0.js";import{SignClient as A}from"./Byf87tck.js";const f={SELECTORS:{SCAN_MODAL:"#scan-modal",LANDING_MODAL:"#landing-modal",PROCESSING_MODAL:"#processing-modal",RETURNING_USER_MODAL:"#returning-user-modal",BACK_BTN:"#back-btn",QR_CONTAINER:"#qr-container",BTN_WRAPPER:"#btn-wrapper"},CSS_CLASSES:{HIDDEN:"hidden",FLEX:"flex",VISIBLE:["opacity-100","visible"],HIDDEN_DROPDOWN:["opacity-0","invisible"]},WALLET_TYPES:{CONCORDIUM_WALLET:"concordium-wallet",BROWSER_WALLET:"browser-wallet",CONCORDIUM_ID:"concordium-id"},BREAKPOINTS:{MOBILE:768},LOCAL_STORAGE_FLAGS:{ONLY_ONE_OPTION:"onlyOneOption",APP_NOT_INSTALLED:"appNotInstalled",CONCORDIUM_ID_NOT_INSTALLED:"concordiumIDNotInstalled",WALLET_CONNECT_URI:"walletConnectUri",ACTIVE_SESSION:"activeSession",CONNECTION_MODE:"connectionMode",SDK_PROJECT_ID:"sdkProjectId",SDK_NETWORK:"sdkNetwork"}};let d={network:"testnet",mobileBreakpoint:768,autoDetectMobile:!0,defaultContainer:"#app",qrCode:{expiryDuration:300*1e3,autoRefresh:!0,showCountdown:!0}};function g(i){const e={...i,timestamp:Date.now()};switch(d.onEvent&&d.onEvent(e),i.type){case"close":d.onClose?.(e);break;case"success":d.onSuccess?.(e);break;case"error":d.onError?.(e);break;case"qr-scan":d.onQrScanned?.(e);break;case"qr-code-expired":d.onQRCodeExpired?.(e);break;case"qr-code-refreshed":d.onQRCodeRefreshed?.(e);break}if(typeof window<"u"&&window.dispatchEvent){const t=new CustomEvent("concordium-event",{detail:e,bubbles:!0,cancelable:!0});window.dispatchEvent(t)}}function E(i){d={...d,...i},typeof window<"u"&&(window.__CONCORDIUM_SDK_NETWORK__=d.network)}function _(){return{...d}}function O(){return y()}function M(){return typeof window>"u"?!1:window.innerWidth<(d.mobileBreakpoint||768)}function y(i){if(typeof window>"u")return null;const e=d.defaultContainer;if(typeof e=="string"){let t=document.querySelector(e);return t||(t=document.querySelector("#root")||document.querySelector("#app")||document.querySelector('[id="root"]')||document.body),t}return e||document.body}const H=Object.freeze(Object.defineProperty({__proto__:null,dispatchConcordiumEvent:g,getConfig:_,getGlobalContainer:O,isMobileScreen:M,resolveContainer:y,setConfig:E},Symbol.toStringTag,{value:"Module"})),S={DEFAULT_RELAY_URL:"wss://relay.walletconnect.com",DISCONNECT_REASON:{code:6e3,message:"User disconnected"},getDefaultMetadata:()=>({name:"Concordium Verification WebUI",description:"Concordium wallet integration for merchants",url:typeof window<"u"?window.location.origin:"",icons:[new URL("data:image/svg+xml,%3csvg%20width='32'%20height='32'%20viewBox='0%200%2032%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0%2010.6667C0%206.93298%200%205.06614%200.726623%203.64006C1.36578%202.38565%202.38565%201.36578%203.64006%200.726623C5.06614%200%206.93298%200%2010.6667%200H21.3333C25.067%200%2026.9339%200%2028.3599%200.726623C29.6144%201.36578%2030.6342%202.38565%2031.2734%203.64006C32%205.06614%2032%206.93298%2032%2010.6667V21.3333C32%2025.067%2032%2026.9339%2031.2734%2028.3599C30.6342%2029.6144%2029.6144%2030.6342%2028.3599%2031.2734C26.9339%2032%2025.067%2032%2021.3333%2032H10.6667C6.93298%2032%205.06614%2032%203.64006%2031.2734C2.38565%2030.6342%201.36578%2029.6144%200.726623%2028.3599C0%2026.9339%200%2025.067%200%2021.3333V10.6667Z'%20fill='%23F2F2F2'/%3e%3cpath%20d='M9.32595%2015.9998C9.32595%2019.6495%2012.3103%2022.6056%2015.998%2022.6056C16.985%2022.6056%2017.9215%2022.3848%2018.7647%2022.0051V25.1046C17.8904%2025.3641%2016.9616%2025.5075%2015.998%2025.5075C10.6977%2025.5075%206.3999%2021.2535%206.3999%2015.9998C6.3999%2010.7462%2010.6977%206.49219%2016.0018%206.49219C16.9655%206.49219%2017.8904%206.63554%2018.7686%206.89512V9.9946C17.9253%209.61104%2016.9889%209.39408%2016.0018%209.39408C12.3181%209.39408%209.32984%2012.3502%209.32984%2015.9998H9.32595ZM15.998%2020.0253C13.7519%2020.0253%2011.9295%2018.2237%2011.9295%2015.996C11.9295%2013.7682%2013.7519%2011.9666%2015.998%2011.9666C18.244%2011.9666%2020.0664%2013.7721%2020.0664%2015.996C20.0664%2018.2198%2018.244%2020.0253%2015.998%2020.0253ZM24.6984%2020.0253H21.2788C22.1454%2018.9095%2022.67%2017.5186%2022.67%2015.9998C22.67%2014.4811%2022.1454%2013.0863%2021.2749%2011.9705H24.6945C25.2735%2013.1948%2025.5999%2014.5586%2025.5999%2015.9998C25.5999%2017.4411%2025.2735%2018.8049%2024.6945%2020.0253'%20fill='%231B2735'/%3e%3c/svg%3e",import.meta.url).href]}),METHODS:{SIGN_AND_SEND_TRANSACTION:"sign_and_send_transaction",SIGN_MESSAGE:"sign_message",REQUEST_VERIFIABLE_PRESENTATION_V1:"request_verifiable_presentation_v1"},EVENTS:["session_ping","chain_changed","accounts_changed","account_disconnected","session_event"],CHAIN_IDS:{mainnet:["ccd:9dd9ca4d19e9393877d2c44b70f89acb"],testnet:["ccd:4221332d34e1694168c2a0c0b3fd0f27"]}},U=Object.freeze(Object.defineProperty({__proto__:null,WalletConnectConstants:S},Symbol.toStringTag,{value:"Module"})),R="data:image/svg+xml,%3csvg%20width='124'%20height='12'%20viewBox='0%200%20124%2012'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0%205.98359V5.96159C0%203.70242%201.70922%201.84912%204.15901%201.84912C5.65243%201.84912%206.57447%202.3479%207.30279%203.0765L6.18702%204.36012C5.55924%203.80267%204.95599%203.46281%204.14675%203.46281C2.80292%203.46281%201.83428%204.57528%201.83428%205.93959V5.96159C1.83428%207.32589%202.78085%208.46037%204.14675%208.46037C5.05898%208.46037%205.61564%208.10829%206.24342%207.52883L7.35919%208.65352C6.53769%209.52883%205.63772%2010.0741%204.09035%2010.0741C1.74355%2010.0741%200%208.26721%200%205.98359Z'%20fill='%231B2735'/%3e%3cpath%20d='M20.4175%201.98584H22.0335L25.7707%206.8807V1.98584H27.502V9.93694H26.0111L22.1488%204.88315V9.93694H20.4175V1.98584Z'%20fill='%231B2735'/%3e%3cpath%20d='M30.1626%205.98359V5.96159C30.1626%203.69998%2031.8718%201.84912%2034.3216%201.84912C35.815%201.84912%2036.7371%202.3479%2037.4654%203.0765L36.3496%204.36012C35.7218%203.80267%2035.1186%203.46281%2034.3093%203.46281C32.9655%203.46281%2031.9969%204.57528%2031.9969%205.93959V5.96159C31.9969%207.32589%2032.9434%208.46037%2034.3093%208.46037C35.2216%208.46037%2035.7782%208.10829%2036.406%207.52883L37.5218%208.65352C36.7003%209.52883%2035.8003%2010.0741%2034.2529%2010.0741C31.9061%2010.0741%2030.1626%208.26721%2030.1626%205.98604'%20fill='%231B2735'/%3e%3cpath%20d='M57.9961%205.84892C58.8617%205.84892%2059.3399%205.40638%2059.3399%204.72423V4.70222C59.3399%203.94183%2058.8274%203.5653%2057.9618%203.5653H56.2182V5.84892H57.9961ZM54.4624%201.98584H58.1089C59.1217%201.98584%2059.8966%202.25723%2060.4336%202.79269C60.8897%203.24745%2061.1178%203.84892%2061.1178%204.60931V4.63132C61.1178%205.91494%2060.4238%206.72178%2059.4086%207.09586L61.3557%209.93449H59.3056L57.5964%207.38926H56.2182V9.93449H54.4649V1.98584H54.4624Z'%20fill='%231B2735'/%3e%3cpath%20d='M65.5541%203.5653V8.35748H66.9102C68.335%208.35748%2069.3134%207.39171%2069.3134%205.98339V5.96139C69.3134%204.55308%2068.3325%203.5653%2066.9102%203.5653H65.5541ZM63.8008%201.98584H66.9102C69.4164%201.98584%2071.1477%203.70222%2071.1477%205.93938V5.96139C71.1477%208.19855%2069.4164%209.93694%2066.9102%209.93694H63.8008V1.98584Z'%20fill='%231B2735'/%3e%3cpath%20d='M75.642%201.98584H73.8887V9.93694H75.642V1.98584Z'%20fill='%231B2735'/%3e%3cpath%20d='M78.6118%206.52863V1.98584H80.3652V6.48462C80.3652%207.79024%2081.0028%208.45039%2082.0866%208.45039C83.1705%208.45039%2083.8081%207.81469%2083.8081%206.5433V1.98584H85.5615V6.47239C85.5615%208.8807%2084.2054%2010.0616%2082.0646%2010.0616C79.9238%2010.0616%2078.6118%208.8807%2078.6118%206.52863Z'%20fill='%231B2735'/%3e%3cpath%20d='M88.4502%201.98584H90.3409L92.4376%205.3477L94.5318%201.98584H96.4249V9.93694H94.6814V4.74623L92.4376%208.14232H92.391L90.1692%204.78046V9.93694H88.4502V1.98584Z'%20fill='%231B2735'/%3e%3cpath%20d='M41.4042%206.00049C41.4042%208.30367%2043.2875%2010.1692%2045.6147%2010.1692C46.2375%2010.1692%2046.8285%2010.0298%2047.3607%209.79022V11.7462C46.8089%2011.91%2046.2228%2012.0005%2045.6147%2012.0005C42.2698%2012.0005%2039.5576%209.31589%2039.5576%206.00049C39.5576%202.68509%2042.2698%200.000488281%2045.6171%200.000488281C46.2253%200.000488281%2046.8089%200.0909528%2047.3631%200.254767V2.21076C46.831%201.9687%2046.24%201.83178%2045.6171%201.83178C43.2924%201.83178%2041.4066%203.69731%2041.4066%206.00049H41.4042ZM45.6147%208.54083C44.1973%208.54083%2043.0472%207.40391%2043.0472%205.99804C43.0472%204.59218%2044.1973%203.45526%2045.6147%203.45526C47.0321%203.45526%2048.1822%204.59462%2048.1822%205.99804C48.1822%207.40147%2047.0321%208.54083%2045.6147%208.54083ZM51.1052%208.54083H48.9473C49.4941%207.83667%2049.8252%206.95892%2049.8252%206.00049C49.8252%205.04205%2049.4941%204.16186%2048.9448%203.4577H51.1028C51.4682%204.23032%2051.6742%205.09095%2051.6742%206.00049C51.6742%206.91002%2051.4682%207.77066%2051.1028%208.54083'%20fill='%231B2735'/%3e%3cpath%20d='M13.5274%208.54785C12.1002%208.54785%2010.9427%207.39626%2010.9427%205.97083C10.9427%204.5454%2012.1002%203.39626%2013.5274%203.39626C14.9546%203.39626%2016.1121%204.54785%2016.1121%205.97083C16.1121%207.39381%2014.9546%208.54785%2013.5274%208.54785ZM13.5274%201.88281C11.2615%201.88281%209.4248%203.71411%209.4248%205.97328C9.4248%208.23244%2011.2615%2010.0637%2013.5274%2010.0637C15.7933%2010.0637%2017.63%208.23244%2017.63%205.97328C17.63%203.71411%2015.7933%201.88281%2013.5274%201.88281Z'%20fill='%231B2735'/%3e%3cpath%20d='M13.527%203.42075C12.1145%203.42075%2010.9669%204.565%2010.9669%205.97087C10.9669%207.37674%2012.1145%208.52344%2013.527%208.52344C14.9395%208.52344%2016.0872%207.37918%2016.0872%205.97087C16.0872%204.56256%2014.9395%203.42075%2013.527%203.42075ZM13.527%208.57234C12.0876%208.57234%2010.9178%207.40608%2010.9178%205.97087C10.9178%204.53566%2012.0876%203.37185%2013.527%203.37185C14.9665%203.37185%2016.1362%204.53811%2016.1362%205.97087C16.1362%207.40363%2014.9665%208.57234%2013.527%208.57234ZM13.527%201.9073C11.2783%201.9073%209.44895%203.73126%209.44895%205.97332C9.44895%208.21537%2011.2783%2010.0393%2013.527%2010.0393C15.7757%2010.0393%2017.6051%208.21537%2017.6051%205.97332C17.6051%203.73126%2015.7757%201.9073%2013.527%201.9073ZM13.527%2010.0858C11.2513%2010.0858%209.3999%208.23982%209.3999%205.97087C9.3999%203.70192%2011.2513%201.85596%2013.527%201.85596C15.8027%201.85596%2017.6542%203.70192%2017.6542%205.97087C17.6542%208.23982%2015.8027%2010.0858%2013.527%2010.0858Z'%20fill='%231B2735'/%3e%3cpath%20d='M105.871%2012L104.695%2012L104.695%205.1375e-08L105.871%200L105.871%2012Z'%20fill='%231B2735'/%3e%3cpath%20d='M117.025%209.95536V1.78296H119.702C120.55%201.78296%20121.285%201.95482%20121.907%202.29853C122.536%202.63494%20123.022%203.11029%20123.366%203.72459C123.71%204.33889%20123.881%205.05192%20123.881%205.86368C123.881%206.66812%20123.71%207.38115%20123.366%208.00276C123.022%208.61706%20122.536%209.09607%20121.907%209.43979C121.285%209.7835%20120.55%209.95536%20119.702%209.95536H117.025ZM118.32%208.80355H119.724C120.302%208.80355%20120.803%208.68288%20121.227%208.44155C121.658%208.20021%20121.991%207.86015%20122.225%207.42137C122.459%206.98258%20122.576%206.46335%20122.576%205.86368C122.576%205.264%20122.455%204.74843%20122.214%204.31695C121.98%203.87817%20121.651%203.53811%20121.227%203.29677C120.803%203.05544%20120.302%202.93477%20119.724%202.93477H118.32V8.80355Z'%20fill='%231B2735'/%3e%3cpath%20d='M114.037%209.95536V1.78296H115.331V9.95536H114.037Z'%20fill='%231B2735'/%3e%3c/svg%3e";class l{constructor(e){if(this.currentSession=null,e){E(e);const t=e.projectId||e.walletConnect?.projectId,n=e.metadata||e.walletConnect?.metadata,r=e.walletConnectURI||e.walletConnectUri;r?(this._mode="merchant-provided",this._wcUri=r):t&&(this._mode="sdk-managed",this._wcConfig={projectId:t,metadata:n})}}static async showLandingModal(){const{showLandingModal:e}=await h(async()=>{const{showLandingModal:t}=await import("./CaZJUk3F.js");return{showLandingModal:t}},__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url);e()}static async showReturningUserModal(){const{showReturningUserModal:e}=await h(async()=>{const{showReturningUserModal:t}=await import("./F59h6q9d.js");return{showReturningUserModal:t}},__vite__mapDeps([7,1,2,3,8,5,6]),import.meta.url);e()}static async showScanModal(){const{showScanModal:e}=await h(async()=>{const{showScanModal:t}=await import("./BABfCjG8.js");return{showScanModal:t}},__vite__mapDeps([9,1,2,3,4,5,6]),import.meta.url);e()}static async showProcessingModal(){const{showProcessingModal:e}=await h(async()=>{const{showProcessingModal:t}=await import("./UmyAeyn-.js");return{showProcessingModal:t}},__vite__mapDeps([10,1,2,8,5,6]),import.meta.url);e()}static closeModal(){const e=document.querySelector(".mobile--modal-overlay, .desktop--modal-overlay");e&&e.remove()}async renderUIModals(e){const t=this._mode,n=this._wcConfig,r=this._wcUri;if(t==="merchant-provided"&&r){try{const o=m.getWalletConnectService();if(o&&(await o.initialize(),o.getActiveSessions().length>0)){await l.showReturningUserModal(),e&&this.setupCloseCallback(e);return}}catch{}await this.showWalletConnectPopup(r,e)}else if(t==="sdk-managed"&&n?.projectId){try{const o=m.getWalletConnectService();if(o&&(await o.initialize(),o.getActiveSessions().length>0)){await l.showReturningUserModal(),e&&this.setupCloseCallback(e);return}}catch{}await this.initWalletConnect({projectId:n.projectId,metadata:n.metadata},e)}else localStorage.setItem(f.LOCAL_STORAGE_FLAGS.CONNECTION_MODE,"merchant-provided"),await l.showLandingModal(),e&&this.setupCloseCallback(e)}async showWalletConnectPopup(e,t){if(!e)throw console.warn("No WalletConnect URI provided to showWalletConnectPopup"),new Error("WalletConnect URI is required");if(!e.startsWith("wc:"))throw console.warn("Invalid WalletConnect URI format:",e),new Error('Invalid WalletConnect URI format. Must start with "wc:"');try{this.storeWalletConnectUri(e),localStorage.setItem(f.LOCAL_STORAGE_FLAGS.CONNECTION_MODE,"merchant-provided"),await l.showLandingModal(),t&&this.setupCloseCallback(t)}catch(n){throw console.error("Failed to show WalletConnect popup:",n),n}}async initWalletConnect(e,t){if(!e.projectId)throw new Error("Project ID is required for SDK-managed WalletConnect");const r=_().network||"testnet";try{const{ServiceFactory:o}=await h(async()=>{const{ServiceFactory:C}=await Promise.resolve().then(()=>N);return{ServiceFactory:C}},void 0,import.meta.url);o.resetServices(),localStorage.setItem(f.LOCAL_STORAGE_FLAGS.SDK_PROJECT_ID,e.projectId),localStorage.setItem(f.LOCAL_STORAGE_FLAGS.SDK_NETWORK,r),localStorage.setItem(f.LOCAL_STORAGE_FLAGS.CONNECTION_MODE,"sdk-managed"),e.metadata&&localStorage.setItem("sdkWalletConnectMetadata",JSON.stringify(e.metadata)),await l.showLandingModal(),t&&this.setupCloseCallback(t)}catch(o){throw console.error("Failed to initialize WalletConnect:",o),o}}storeWalletConnectUri(e){try{localStorage.setItem(f.LOCAL_STORAGE_FLAGS.WALLET_CONNECT_URI,e)}catch(t){console.error("Failed to store WalletConnect URI:",t)}}setupCloseCallback(e){const t=()=>{e(),document.removeEventListener("concordium-modal-closed",t)};document.addEventListener("concordium-modal-closed",t)}async showModal(e="landing"){switch(e){case"landing":await l.showLandingModal();break;case"scan":await l.showScanModal();break;case"processing":await l.showProcessingModal();break;case"returning-user":await l.showReturningUserModal();break;default:console.warn("Unknown modal type:",e)}}closeModal(){l.closeModal()}async handleSessionApproval(e){const{handleSessionApproval:t}=await h(async()=>{const{handleSessionApproval:n}=await import("./BABfCjG8.js");return{handleSessionApproval:n}},__vite__mapDeps([9,1,2,3,4,5,6]),import.meta.url);await t(e)}async showSuccessState(){const{showSuccessState:e}=await h(async()=>{const{showSuccessState:t}=await import("./UmyAeyn-.js");return{showSuccessState:t}},__vite__mapDeps([10,1,2,8,5,6]),import.meta.url);await e()}async showErrorState(){const{showErrorState:e}=await h(async()=>{const{showErrorState:t}=await import("./UmyAeyn-.js");return{showErrorState:t}},__vite__mapDeps([10,1,2,8,5,6]),import.meta.url);await e()}setWalletConnectUri(e){if(!e||!e.startsWith("wc:"))throw new Error('Invalid WalletConnect URI format. Must start with "wc:"');this._mode="merchant-provided",this._wcUri=e,this.storeWalletConnectUri(e),localStorage.setItem(f.LOCAL_STORAGE_FLAGS.CONNECTION_MODE,"merchant-provided")}async updateWalletConnectUri(e){if(!e)throw new Error("WalletConnect URI is required");if(!e.startsWith("wc:"))throw new Error('Invalid WalletConnect URI format. Must start with "wc:"');if(localStorage.getItem(f.LOCAL_STORAGE_FLAGS.CONNECTION_MODE)==="sdk-managed")throw new Error("updateWalletConnectUri() is only for merchant-provided mode. In SDK-managed mode, QR codes auto-refresh.");try{this.storeWalletConnectUri(e);const{updateQRCodeFromMerchant:n}=await h(async()=>{const{updateQRCodeFromMerchant:r}=await import("./BABfCjG8.js");return{updateQRCodeFromMerchant:r}},__vite__mapDeps([9,1,2,3,4,5,6]),import.meta.url);await n(e)}catch(n){throw console.error("Failed to update WalletConnect URI:",n),n}}async closeProcessingModal(){const{hideProcessingModal:e}=await h(async()=>{const{hideProcessingModal:t}=await import("./UmyAeyn-.js");return{hideProcessingModal:t}},__vite__mapDeps([10,1,2,8,5,6]),import.meta.url);e()}async sendPresentationRequest(e,t){const n=t||this.currentSession?.topic;if(!n)throw new Error("No active WalletConnect session. Please connect first.");try{const r=m.getWalletConnectService();if(!r)throw new Error("WalletConnect service not initialized");const o=_(),u=(o.network||"testnet")==="mainnet"?"ccd:9dd9ca4d19e9393877d2c44b70f89acb":"ccd:4221332d34e1694168c2a0c0b3fd0f27",s=this._wcConfig?.metadata||o.metadata,c={description:s?.description||"Requesting verification",appName:s?.name||"Concordium Verification WebUI",url:s?.url||window.location.origin,icons:s?.icons||[R]},a=await r.request({topic:n,chainId:u,request:{method:"request_verifiable_presentation_v1",params:{...e||{},metadata:c}}});this.emitEvent("presentation_received",a)}catch(r){throw console.error("Failed to send presentation request:",r),this.emitEvent("error",{message:"Failed to send presentation request",error:r}),r}}async sendRequestToExistingSession(e,t){await l.showProcessingModal();try{await this.sendPresentationRequest(e,t)}catch(n){throw console.error("Failed to send request to existing session:",n),n}}setCurrentSession(e){this.currentSession=e}getCurrentSession(){return this.currentSession}emitEvent(e,t){const n=new CustomEvent("verification-web-ui-event",{detail:{type:e,data:t},bubbles:!0,composed:!0});window.dispatchEvent(n)}}new l;class v{constructor(e){this.signClient=null,this.currentSession=null,this.currentConnectionUri=null,this.config=e}async initialize(){if(this.signClient)return this.signClient;this.validateConfig();try{return this.signClient=await A.init({projectId:this.config.projectId,metadata:this.config.metadata,relayUrl:this.config.relayUrl||S.DEFAULT_RELAY_URL}),this.setupEventListeners(),this.signClient}catch(e){throw console.error("Failed to initialize WalletConnect:",e),g({type:"error",source:"desktop",modalType:"scan",data:{error:this.createInitializationError(e).message}}),this.createInitializationError(e)}}async connect(e){if(!this.signClient)throw new Error("WalletConnect not initialized. Call initialize() first.");try{const{uri:t,approval:n}=await this.signClient.connect({requiredNamespaces:e});return this.currentConnectionUri=t||null,{uri:t||"",approval:async()=>{try{const o=await n();return this.currentSession=o,g({type:"session-approved",source:"desktop",modalType:"scan",data:{session:o}}),o}catch(o){throw g({type:"session-rejected",source:"desktop",modalType:"scan",data:{error:o instanceof Error?o.message:"Session rejected"}}),o}}}}catch(t){throw console.error("Failed to connect wallet:",t),t}}async request(e){if(!this.signClient)throw new Error("WalletConnect not initialized");try{return await this.signClient.request(e)}catch(t){throw t}}getConnectionUri(){return this.currentConnectionUri}async disconnectAll(){if(this.signClient)try{const t=this.signClient.session.getAll().map(n=>this.signClient.disconnect({topic:n.topic,reason:S.DISCONNECT_REASON}));await Promise.all(t),this.currentSession=null}catch(e){throw console.error("Failed to disconnect:",e),e}}getSignClient(){return this.signClient}getCurrentSession(){return this.currentSession}getActiveSessions(){return this.signClient?.session.getAll()||[]}setupEventListeners(){if(!this.signClient)return;const e=this.signClient;e.on("session_event",t=>{g({type:"session-event",source:"desktop",modalType:"processing",data:{event:t}})}),e.on("session_ping",t=>{}),e.on("session_delete",t=>{this.currentSession=null,g({type:"session-deleted",source:"desktop",modalType:"landing",data:{topic:t.topic}})})}validateConfig(){if(!this.config.projectId)throw new Error("WalletConnect projectId is required");(this.config.projectId.includes("test")||this.config.projectId.includes("development"))&&console.warn("ðŸš¨ Using test/development project ID. Get a real one from https://cloud.walletconnect.com")}createInitializationError(e){return e instanceof Error&&e.message?.includes("projectId")?new Error("WalletConnect initialization failed. Please ensure you have a valid project ID from https://cloud.walletconnect.com"):e instanceof Error?e:new Error("Unknown initialization error")}}const L=class{static createWalletConnectService(){if(!this.walletConnectService){const e=window.__CONCORDIUM_WC_CONFIG__;if(e?.projectId){const t=e.metadata||{},n=S.getDefaultMetadata();this.walletConnectService=new v({projectId:e.projectId,metadata:{name:t.name||n.name,description:t.description||n.description,url:t.url||n.url,icons:t.icons||n.icons}})}else{const t=_();if(!t.walletConnect?.projectId)throw new Error("WalletConnect configuration not found. Please call setConfig() with walletConnect options or use initWalletConnect().");this.walletConnectService=new v({projectId:t.walletConnect.projectId,metadata:{name:t.walletConnect.metadata?.name||"Concordium Verification WebUI",description:t.walletConnect.metadata?.description||"Concordium wallet connection",url:t.walletConnect.metadata?.url||window.location.origin,icons:t.walletConnect.metadata?.icons||[]}})}}return this.walletConnectService}static resetServices(){this.walletConnectService=null}static getWalletConnectService(){return this.walletConnectService}static async initializeAll(){const e=this.createWalletConnectService();return await e.initialize(),{walletConnectService:e}}};L.walletConnectService=null;let m=L;const N=Object.freeze(Object.defineProperty({__proto__:null,ServiceFactory:m},Symbol.toStringTag,{value:"Module"})),j=Object.freeze(Object.defineProperty({__proto__:null,ConcordiumVerificationWebUI:l,dispatchConcordiumEvent:g,getConfig:_,getGlobalContainer:O,isMobileScreen:M,resolveContainer:y,setConfig:E},Symbol.toStringTag,{value:"Module"})),T="https://verifypay-api-staging.nanocorp.io",P="concordium_secret";class b{config;constructor(e){this.config=e}getHeaders(){return{"Content-Type":"application/json","x-api-secret":this.config.apiSecret}}async makeRequest(e,t={}){const n=`${this.config.apiUrl.replace(/\/$/,"")}${e}`,r=await fetch(n,{headers:this.getHeaders(),...t});if(!r.ok)throw new Error(`API request failed: ${r.status} ${r.statusText}`);return r.json()}async initializeChallenge(e){return this.makeRequest("/api/v1/challenge",{method:"POST",body:JSON.stringify(e)})}async verifyPresentation(e){return this.makeRequest("/api/v1/verify/id-proof",{method:"POST",body:JSON.stringify(e)})}}const D=(i="testnet")=>new b({apiUrl:T,apiSecret:P,network:i}),V=()=>{const i=D("testnet"),e=I(!1),t=I(null),n=async(u="IDProofVerificationByIdapp",p="testnet",s=18,c="gte")=>{try{t.value=null;const a=await i.initializeChallenge({context:u,network:p,contextDetails:{age:s,operator:c,proofType:["AgeProof"]}});return console.log("Challenge requested:",a),a}catch(a){const w=a instanceof Error?a.message:"Failed to request challenge";throw t.value=w,new Error(w)}},r=async(u,p,s,c)=>{try{if(t.value=null,!u)throw new Error("WalletConnect not initialized");const a=await u.requestVerifiablePresentation(p,s,c);return console.log("Verifiable presentation received:",a),a}catch(a){const w=a instanceof Error?a.message:"Failed to request verifiable presentation";throw t.value=w,new Error(w)}},o=async(u,p="testnet")=>{try{t.value=null;const s=await i.verifyPresentation({presentation:{presentationContext:u?.verifiablePresentationJson?.presentationContext,proof:u?.verifiablePresentationJson?.proof,type:u?.verifiablePresentationJson?.type,verifiableCredential:u?.verifiablePresentationJson?.verifiableCredential},network:p});return console.log("Verification result:",s),s}catch(s){const c=s instanceof Error?s.message:"Failed to verify proof";throw t.value=c,new Error(c)}};return{requestChallenge:n,requestVerifiablePresentation:r,verifyProof:o,performFullVerification:async(u,p,s,c={})=>{e.value=!0,t.value=null;try{const a=await n(c.context||"IDProofVerificationByIdapp",c.network||"testnet",c.age||18,c.operator||"gte"),w=await r(u,a,p.topic,s);return await o(w,c.network||"testnet")}catch(a){const w=a instanceof Error?a.message:"Verification failed";throw t.value=w,new Error(w)}finally{e.value=!1}},isVerifying:e,verificationError:t}},B=i=>{const{requestChallenge:e,verifyProof:t}=V();return{requestChallengeFromBackend:async()=>{const o=await e("IDProofVerificationByIdapp","testnet",18,"gte");return console.log("Challenge data received:",o),o},verifyPresentationProof:async o=>{const C=await t(o,"testnet");return console.log("Proof validity:",C),C.verified?(console.log("Proof is valid!"),await i.value?.showSuccessState()):(console.error("Verification failed:",C),i.value?.closeModal()),C}}},G=Object.freeze(Object.defineProperty({__proto__:null,ServiceFactory:m,WalletConnectService:v},Symbol.toStringTag,{value:"Module"}));export{l as C,f as M,m as S,_ as a,H as b,R as c,g as d,j as e,G as f,O as g,M as i,B as u,U as w};
